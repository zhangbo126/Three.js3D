import{d as mn,_ as Le,e as _e,f as ee,g as te,r as w,h as fn,i as ae,o as H,j as q,k as l,l as r,w as u,m as F,v as le,F as me,n as ge,u as re,c as ne,p as X,E as ce,q as Fe,s as $e,t as Ue,x as Be,y as gn,z as it,A as xe,b as ye,B as _n,a as yn,C as $n,D as Un,G as Dn,H as Hn,I as On,J as zn,L as Nn,M as Gn,N as Bn,O as jn}from"./main-BacqxwQj.js";import{g as Ne,b as Yn,v as Xn,P as je,a as Ht,m as Yt,c as Wn,C as he,d as $t,e as Zn,I as Qn,f as bt,S as vn,U as qn,h as at,M as N,i as wn,j as Ge,W as xn,k as Kn,R as bn,V as Q,l as Ct,n as Jn,N as eo,o as Ut,p as Mn,D as rt,B as Ve,q as xt,r as to,s as Mt,t as no,u as oo,w as so,x as io,L as Se,y as ao,z as ro,A as lo,E as co,F as st,Q as be,G as uo,H as dt,J as Lt,K as ut,O as po,T as Ae,X as Ot,Y as ho,Z as mo,_ as zt,$ as Nt,a0 as Sn,a1 as Dt,a2 as fo,a3 as Cn,a4 as go,a5 as fe,a6 as pe,a7 as Xt,a8 as Wt,a9 as pt,aa as Te,ab as _o,ac as We,ad as Tt,ae as Gt,af as yo,ag as vo,ah as vt,ai as Ln,aj as Tn,ak as wo,al as xo,am as bo,an as Et,ao as Mo,ap as So,aq as Co,ar as Lo,as as To,at as Eo,au as Ao,av as At,aw as Io,ax as Po,ay as ko,az as Zt,aA as Ro,aB as Ze,aC as ht,aD as Vo,aE as Fo,aF as $o,aG as Uo,aH as Do,aI as Ho,aJ as Oo,aK as Qt,aL as qt,aM as Kt,aN as zo,aO as No,aP as Jt,aQ as Go,aR as Bo,aS as jo,aT as Yo,aU as mt,aV as Xo,aW as Wo}from"./CSS3DRenderer-CITJV_e9.js";const we=mn("useMeshEditStore",{state:()=>({modelApi:{},selectMesh:{},dragType:""}),getters:{selectMeshUuid:n=>n.selectMesh.uuid},actions:{setModelApi(n){this.modelApi=n},selectMeshAction(n){this.selectMesh=n},changeDragType(n){this.dragType=n}}});mn("useIndexedDBStore",{state:()=>({db:{}}),getters:{},actions:{setDbApi(n){this.db=n}}});const De=n=>(Fe("data-v-ce292eda"),n=n(),$e(),n),Zo={class:"edit-box"},Qo={class:"header"},qo=De(()=>l("span",null,"背景",-1)),Ko={class:"icon-name"},Jo=De(()=>l("span",null," 图片",-1)),es={class:"action-txt"},ts={class:"check"},ns={class:"icon-name"},os=De(()=>l("span",null," 颜色",-1)),ss={class:"action"},is={class:"check"},as={class:"icon-name"},rs=De(()=>l("span",null," 全景图",-1)),ls={class:"action-txt"},cs={class:"check"},ds={class:"option"},us={class:"icon-name"},ps=De(()=>l("span",null,"外部资源",-1)),hs={class:"texture-add"},ms={class:"icon"},fs=De(()=>l("span",null,"加载外部全景图",-1)),gs={class:"texture-add"},_s={class:"icon"},ys=De(()=>l("span",null,"加载外部视频",-1)),vs={class:"options"},ws={class:"option"},xs={class:"grid-txt"},bs={class:"grid-silder"},Ms={class:"option"},Ss={class:"grid-txt"},Cs={class:"grid-silder"},Ls={__name:"EditBackground",setup(n,{expose:e}){const o=we(),i=_e({visible:!0,type:3,image:Ne("image/model-bg-3.jpg"),viewImg:Ne("image/view-4.png"),color:"#000",blurriness:1,intensity:1}),t=ee(!1),a=ee(3),s=ee(3),c=te(()=>{const{visible:C}=i;return C?"":"disabled"}),d=je,p=C=>{switch(Object.assign(i,{type:C,intensity:1,blurriness:1}),C){case 1:o.modelApi.onSetSceneColor(i.color);break;case 2:o.modelApi.onSetSceneImage(i.image);break;case 3:o.modelApi.onSetSceneViewImage(i);break}},h=({id:C,url:I})=>{i.image=I,a.value=C,o.modelApi.onSetSceneImage(I)},m=async({id:C,url:I})=>{try{t.value=!0,i.viewImg=I,s.value=C,await o.modelApi.onSetSceneViewImage(i)}finally{t.value=!1,ce.success("操作成功")}},S=async C=>{const I=URL.createObjectURL(C.raw);await o.modelApi.onSetStorageViewImage(I,Ht(C.name)),URL.revokeObjectURL(I),ce.success("操作成功")},M=async C=>{await o.modelApi.onSetStorageViewVideo(C),ce.success("操作成功")},_=C=>{i.color=C,o.modelApi.onSetSceneColor(i.color)},v=()=>{o.modelApi.onSetSceneColor(i.color)},b=()=>{o.modelApi.onSetSceneViewConfig(i)},T=()=>{const{type:C,visible:I,image:P,viewImg:g}=i;if(!I)return o.modelApi.onSetSceneColor("#000");switch(C){case 1:o.modelApi.onSetSceneColor(i.color);break;case 2:o.modelApi.onSetSceneImage(P);break;case 3:o.modelApi.onSetSceneViewImage(i);break}};return e({config:i}),(C,I)=>{const P=w("el-switch"),g=w("Picture"),f=w("el-icon"),E=w("el-space"),x=w("el-button"),y=w("Check"),L=w("el-image"),V=w("el-col"),A=w("el-row"),G=w("el-scrollbar"),R=w("DataAnalysis"),U=w("el-color-picker"),D=w("CameraFilled"),Y=w("UploadFilled"),j=w("el-tooltip"),J=w("el-upload"),ie=w("VideoCameraFilled"),$=w("el-slider"),B=fn("zLoading");return ae((H(),q("div",Zo,[l("div",Qo,[qo,r(P,{modelValue:i.visible,"onUpdate:modelValue":I[0]||(I[0]=k=>i.visible=k),onChange:T},null,8,["modelValue"])]),l("div",{class:X(["options",c.value])},[l("div",{class:"option",onClick:I[1]||(I[1]=k=>p(2))},[r(E,null,{default:u(()=>[l("div",Ko,[r(E,null,{default:u(()=>[r(f,null,{default:u(()=>[r(g)]),_:1}),Jo]),_:1})]),l("div",es,[r(x,{type:"primary",link:""},{default:u(()=>[F("选择图片")]),_:1})]),ae(l("div",ts,[r(f,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(y)]),_:1})],512),[[le,i.type==2]])]),_:1})]),ae(r(G,{"max-height":"250px"},{default:u(()=>[r(A,null,{default:u(()=>[(H(!0),q(me,null,ge(re(Yn),k=>(H(),ne(V,{style:{textAlign:"center"},span:6,key:k.id},{default:u(()=>[r(L,{onClick:O=>h(k),class:X(["el-img",a.value==k.id?"active":""]),src:k.url,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1})]),_:1},512),[[le,i.type==2]])],2),l("div",{class:X(["options",c.value])},[l("div",{class:"option",onClick:I[3]||(I[3]=k=>p(1))},[r(E,null,{default:u(()=>[l("div",ns,[r(E,null,{default:u(()=>[r(f,null,{default:u(()=>[r(R)]),_:1}),os]),_:1})]),l("div",ss,[r(U,{predefine:re(d),onChange:v,onActiveChange:_,modelValue:i.color,"onUpdate:modelValue":I[2]||(I[2]=k=>i.color=k)},null,8,["predefine","modelValue"])]),ae(l("div",is,[r(f,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(y)]),_:1})],512),[[le,i.type==1]])]),_:1})])],2),l("div",{class:X(["options",c.value])},[l("div",{class:"option",onClick:I[4]||(I[4]=k=>p(3))},[r(E,null,{default:u(()=>[l("div",as,[r(E,null,{default:u(()=>[r(f,null,{default:u(()=>[r(D)]),_:1}),rs]),_:1})]),l("div",ls,[r(x,{type:"primary",link:""},{default:u(()=>[F("选择图片")]),_:1})]),ae(l("div",cs,[r(f,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(y)]),_:1})],512),[[le,i.type==3]])]),_:1})]),ae(r(G,{"max-height":"600px"},{default:u(()=>[r(A,null,{default:u(()=>[(H(!0),q(me,null,ge(re(Xn),k=>(H(),ne(V,{span:6,style:{textAlign:"center"},key:k.id},{default:u(()=>[r(L,{onClick:O=>m(k),class:X(["el-view",s.value==k.id?"active":""]),src:k.url,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1}),ae(r(A,null,{default:u(()=>[r(V,null,{default:u(()=>[l("div",ds,[l("div",us,[r(E,null,{default:u(()=>[ps]),_:1})])])]),_:1}),r(V,{span:10,offset:4},{default:u(()=>[r(E,{spacer:"20"},{default:u(()=>[r(J,{action:"",accept:".jpg,.png,.hdr","show-file-list":!1,"auto-upload":!1,"on-change":S},{default:u(()=>[l("div",hs,[l("div",ms,[r(j,{effect:"dark",content:"该功能仅作预览，数据无法保存",placement:"top"},{default:u(()=>[r(f,{size:"60"},{default:u(()=>[r(Y)]),_:1})]),_:1}),fs])])]),_:1}),r(J,{action:"",accept:".mp4","show-file-list":!1,"auto-upload":!1,"on-change":M},{default:u(()=>[l("div",gs,[l("div",_s,[r(j,{effect:"dark",content:"该功能仅作预览，数据无法保存",placement:"top"},{default:u(()=>[r(f,{size:"60"},{default:u(()=>[r(ie)]),_:1})]),_:1}),ys])])]),_:1})]),_:1})]),_:1})]),_:1},512),[[le,i.type==3]]),ae(r(A,null,{default:u(()=>[r(V,null,{default:u(()=>[l("div",vs,[l("div",ws,[r(E,null,{default:u(()=>[l("div",xs,[r(x,{type:"primary",link:""},{default:u(()=>[F("强度")]),_:1})])]),_:1}),l("div",bs,[r($,{"show-input":"",onInput:b,modelValue:i.intensity,"onUpdate:modelValue":I[5]||(I[5]=k=>i.intensity=k),min:0,max:1,step:.01},null,8,["modelValue"])])]),l("div",Ms,[r(E,null,{default:u(()=>[l("div",Ss,[r(x,{type:"primary",link:""},{default:u(()=>[F(" 模糊")]),_:1})])]),_:1}),l("div",Cs,[r($,{"show-input":"",onInput:b,modelValue:i.blurriness,"onUpdate:modelValue":I[6]||(I[6]=k=>i.blurriness=k),min:0,max:1,step:.01},null,8,["modelValue"])])])])]),_:1})]),_:1},512),[[le,i.type==3]])]),_:1},512),[[le,i.type==3]])],2)])),[[B,t.value]])}}},Ts=Le(Ls,[["__scopeId","data-v-ce292eda"]]),Ye=n=>(Fe("data-v-c0a4f58b"),n=n(),$e(),n),Es={class:"edit-box"},As={class:"header"},Is=Ye(()=>l("span",null,"材质类型",-1)),Ps={class:"options"},ks={class:"option"},Rs=Ye(()=>l("span",null,"当前材质类型：",-1)),Vs=Ye(()=>l("div",{class:"header"},[l("span",null,"材质")],-1)),Fs={class:"options"},$s=["onClick"],Us={class:"icon-name"},Ds={class:"check"},Hs=Ye(()=>l("div",{class:"header"},"材质属性",-1)),Os={class:"option space-between"},zs={class:"option"},Ns={class:"grid-txt"},Gs={class:"grid-silder"},Bs=Ye(()=>l("div",{class:"header"},"当前材质自带贴图",-1)),js={class:"options"},Ys={key:0,class:"select"},Xs=Ye(()=>l("div",{class:"header"},"系统贴图",-1)),Ws=["onClick"],Zs={key:0,class:"select"},Qs={__name:"EditMaterial",setup(n,{expose:e}){const o=we(),{$bus:i}=Ue().proxy,t=_e({meshName:null,color:null,wireframe:!1,depthWrite:!0,opacity:1}),a=ee(!1),s=ee(""),c=ee(null),d=ee(null),p=te(()=>(h.modelMaterialList.find(f=>f.uuid==h.selectMeshUuid)||{}).uuid?"":"disabled"),h=_e({modelMaterialList:te(()=>o.modelApi.modelMaterialList),originalMaterials:te(()=>o.modelApi.originalMaterials),modelApi:te(()=>o.modelApi),selectMeshUuid:te(()=>o.selectMeshUuid)});Be(()=>{i.on("model-update",()=>{Object.assign(t,{color:null,wireframe:!1,depthWrite:!0,opacity:1})})}),gn(()=>o.selectMeshUuid,g=>{const f=h.modelMaterialList.find(E=>E.uuid==g)||{};if(d.value=f.mapId,f.mapId){const{color:E,wireframe:x,depthWrite:y,opacity:L}=f.material,V=new he(E).getStyle();Object.assign(t,{color:V,wireframe:x,depthWrite:y,opacity:L});const A=h.originalMaterials.get(f.uuid);c.value={url:M(f),name:f.name,mapId:A.userData.mapId,material:f.material}}else c.value=null});const m=g=>{const f=Yt.find(E=>E.type==g);h.modelApi.onChangeModelMeshType(f)},S=g=>{const{name:f}=g;t.meshName=f;const E=h.modelApi.onChangeModelMeaterial(f),{color:x,wireframe:y,depthWrite:L,opacity:V}=E.material;Object.assign(t,{color:new he(x).getStyle(),wireframe:y,depthWrite:L,opacity:V});const A=h.originalMaterials.get(g.uuid);c.value={url:M(g),name:g.name,mapId:g.mapId,material:A}},M=g=>{const f=h.originalMaterials.get(g.uuid),E=Array.isArray(f)?f:[f];let x;return E.forEach(y=>{if(y.map&&y.map.image){const L=document.createElement("canvas"),{width:V,height:A}=y.map.image;L.width=V,L.height=A,L.getContext("2d").drawImage(y.map.image,0,0),x=L.toDataURL("image/png",.5),L.remove()}}),x},_=()=>{h.modelApi.onSetModelMaterial(t)},v=g=>{g.visible=!g.visible,h.modelApi.onSetMeshVisibe(g)},b=g=>{d.value=g.mapId,h.modelApi.onSetModelMap(g),ce.success("当前材质贴图修改成功")},T=async g=>{try{a.value=!0,d.value=g.id;const f=h.modelMaterialList.find(E=>E.uuid==o.selectMeshUuid)||{};f.mapId=g.id,h.modelApi.onSetSystemModelMap(g),ce.success("当前材质贴图修改成功")}finally{a.value=!1}},C=async g=>{const f=URL.createObjectURL(g.raw);await h.modelApi.onSetStorageModelMap(f,Ht(g.name)),URL.revokeObjectURL(f),ce.success("当前材质贴图修改成功")},I=()=>{Object.assign(t,{meshName:null,color:"#fff",wireframe:!1,depthWrite:!0,opacity:1}),s.value="",d.value=null,h.modelApi.initModelMaterial()};return e({getMeshConfig:()=>({materialType:s.value,meshList:h.modelApi.onGetEditMeshList()})}),(g,f)=>{const E=w("el-button"),x=w("el-option"),y=w("el-select"),L=w("el-space"),V=w("View"),A=w("el-icon"),G=w("Hide"),R=w("Check"),U=w("el-scrollbar"),D=w("el-color-picker"),Y=w("WarnTriangleFilled"),j=w("el-tooltip"),J=w("el-switch"),ie=w("el-slider"),$=w("el-image"),B=w("Select"),k=w("el-col"),O=w("el-upload"),W=w("el-row"),Z=fn("zLoading");return ae((H(),q("div",Es,[l("div",As,[Is,r(E,{type:"primary",icon:"Refresh",onClick:I},{default:u(()=>[F(" 重置 ")]),_:1})]),l("div",Ps,[l("div",ks,[r(L,null,{default:u(()=>[Rs,r(y,{modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=z=>s.value=z),onChange:m,placeholder:"请选择",size:"small",style:{width:"200px"}},{default:u(()=>[(H(!0),q(me,null,ge(re(Yt),z=>(H(),ne(x,{key:z.type,label:`${z.type?z.type:""}(${z.describe})`,value:z.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),Vs,l("div",Fs,[r(U,{"max-height":"200px"},{default:u(()=>[(H(!0),q(me,null,ge(h.modelMaterialList,z=>(H(),q("div",{class:X(["option",h.selectMeshUuid==z.uuid?"option-active":""]),onClick:it(ue=>S(z),["stop"]),key:z.uuid},[r(L,null,{default:u(()=>[z.visible?(H(),ne(A,{key:0,onClick:ue=>v(z),size:"18",color:"#409eff"},{default:u(()=>[r(V)]),_:2},1032,["onClick"])):(H(),ne(A,{key:1,size:"18",onClick:ue=>v(z)},{default:u(()=>[r(G)]),_:2},1032,["onClick"])),l("div",Us,xe(z.name),1),ae(l("div",Ds,[r(A,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(R)]),_:1})],512),[[le,h.selectMeshUuid==z.uuid]])]),_:2},1024)],10,$s))),128))]),_:1})]),Hs,l("div",{class:X(["options",p.value])},[l("div",Os,[r(L,null,{default:u(()=>[r(E,{type:"primary",link:""},{default:u(()=>[F("材质颜色")]),_:1}),r(D,{"color-format":"rgb",predefine:re(je),onChange:_,modelValue:t.color,"onUpdate:modelValue":f[1]||(f[1]=z=>t.color=z)},null,8,["predefine","modelValue"])]),_:1}),r(L,null,{default:u(()=>[r(j,{effect:"dark",content:"注意：深度写入属性不支持模型“导出” ",placement:"top"},{default:u(()=>[r(A,null,{default:u(()=>[r(Y,{size:20,color:"#ffb940"})]),_:1})]),_:1}),r(E,{type:"primary",link:""},{default:u(()=>[F("深度写入")]),_:1}),r(J,{onChange:_,modelValue:t.depthWrite,"onUpdate:modelValue":f[2]||(f[2]=z=>t.depthWrite=z)},null,8,["modelValue"])]),_:1}),r(L,null,{default:u(()=>[r(j,{effect:"dark",content:"注意：网格属性不支持模型“导出” ",placement:"top"},{default:u(()=>[r(A,null,{default:u(()=>[r(Y,{size:20,color:"#ffb940"})]),_:1})]),_:1}),r(E,{type:"primary",link:""},{default:u(()=>[F("网格")]),_:1}),r(J,{onChange:_,modelValue:t.wireframe,"onUpdate:modelValue":f[3]||(f[3]=z=>t.wireframe=z)},null,8,["modelValue"])]),_:1})]),l("div",zs,[l("div",Ns,[r(E,{type:"primary",link:""},{default:u(()=>[F("透明度 ")]),_:1})]),l("div",Gs,[r(ie,{"show-input":"",onInput:_,onChange:_,modelValue:t.opacity,"onUpdate:modelValue":f[4]||(f[4]=z=>t.opacity=z),min:0,max:1,step:.01},null,8,["modelValue"])])])],2),Bs,l("div",js,[r(U,{"max-height":"140px"},{default:u(()=>[r(W,{justify:"center",align:"middle",style:{minHeight:"120px"}},{default:u(()=>[c.value?(H(),ne(k,{key:0,span:10,offse:4,style:{textAlign:"center"}},{default:u(()=>[l("div",{onClick:f[5]||(f[5]=z=>b(c.value)),class:X([d.value==c.value.mapId?"active":"","mesh-image"])},[r($,{src:c.value.url,class:"mesh-map",fit:"cover"},null,8,["src"]),d.value==c.value.mapId?(H(),q("div",Ys,[r(A,{color:"#18c174",size:26},{default:u(()=>[r(B)]),_:1})])):ye("",!0)],2)]),_:1})):ye("",!0),c.value?(H(),ne(k,{key:1,span:8,style:{textAlign:"center"}},{default:u(()=>[r(O,{action:"",accept:".jpg,.png,.hdr","show-file-list":!1,"auto-upload":!1,"on-change":C},{default:u(()=>[r(j,{effect:"dark",content:"该功能仅仅作预览，数据无法保存 ",placement:"top"},{default:u(()=>[r(E,{type:"primary",icon:"UploadFilled"},{default:u(()=>[F("加载外部贴图")]),_:1})]),_:1})]),_:1})]),_:1})):ye("",!0)]),_:1})]),_:1})]),Xs,l("div",{class:X(["options",p.value])},[r(U,{"max-height":"230px"},{default:u(()=>[r(W,null,{default:u(()=>[(H(!0),q(me,null,ge(re(Wn),z=>(H(),ne(k,{span:6,style:{textAlign:"center"},key:z.id},{default:u(()=>[l("div",{onClick:ue=>T(z),class:X(["image-box",d.value==z.id?"active":""])},[r($,{src:z.url,class:"el-map",fit:"cover"},null,8,["src"]),d.value==z.id?(H(),q("div",Zs,[r(A,{color:"#18c174",size:26},{default:u(()=>[r(B)]),_:1})])):ye("",!0)],10,Ws)]),_:2},1024))),128))]),_:1})]),_:1})],2)])),[[Z,a.value]])}}},qs=Le(Qs,[["__scopeId","data-v-c0a4f58b"]]),Ks={class:"edit-box"},Js={class:"header"},ei=l("span",null,"模型动画",-1),ti=["onClick"],ni={class:"icon-name"},oi={class:"check"},si=l("div",{class:"header"},[l("span",null,"动画配置")],-1),ii={class:"option"},ai=l("span",null," 循环方式 ",-1),ri={class:"option"},li={class:"option"},ci=l("span",null," 播放速度 ",-1),di={class:"option"},ui={class:"option"},pi=l("span",null," 动作幅度 ",-1),hi={class:"option"},mi={class:"header"},fi=l("span",null,"轴动画",-1),gi={class:"options"},_i=l("span",null," 轴方向 ",-1),yi=l("span",null," 播放速度 ",-1),vi={__name:"EditAnimation",setup(n,{expose:e}){const o=we(),{$bus:i}=Ue().proxy,t=_e({visible:!1,animationName:null,loop:"LoopRepeat",timeScale:1,weight:1,rotationVisible:!1,rotationType:"y",rotationSpeed:1}),a=te(()=>t.visible?"":"disabled"),s=te(()=>t.rotationVisible?"":"disabled"),c=_e({modelAnimation:te(()=>o.modelApi?o.modelApi.modelAnimation:[])});Be(()=>{c.modelAnimation.length&&(t.animationName=c.modelAnimation[0].name),i.on("model-update",()=>{if(c.modelAnimation.length){const M=c.modelAnimation[0].name;t.animationName=M}Object.assign(t,{visible:!1,loop:"LoopRepeat",timeScale:1,weight:1,rotationVisible:!1,rotationType:"y",rotationSpeed:1})})});const d=()=>{const{visible:M}=t;M?h():o.modelApi.onClearAnimation()},p=({name:M})=>{t.animationName=M,o.modelApi.onStartModelAnimaion(t)},h=()=>{o.modelApi.onStartModelAnimaion(t)},m=()=>{o.modelApi.onSetRotation(t)},S=()=>{o.modelApi.onSetRotationType(t)};return e({config:t}),(M,_)=>{const v=w("el-switch"),b=w("Check"),T=w("el-icon"),C=w("el-space"),I=w("el-scrollbar"),P=w("el-empty"),g=w("Switch"),f=w("el-radio-button"),E=w("el-radio-group"),x=w("VideoPlay"),y=w("el-slider"),L=w("Sort");return H(),q("div",Ks,[l("div",Js,[ei,r(v,{modelValue:t.visible,"onUpdate:modelValue":_[0]||(_[0]=V=>t.visible=V),onChange:d},null,8,["modelValue"])]),l("div",{class:X(["options",a.value])},[c.modelAnimation.length?(H(),ne(I,{key:0,"max-height":"250px"},{default:u(()=>[(H(!0),q(me,null,ge(c.modelAnimation,V=>(H(),q("div",{class:X(["option",t.animationName==V.name?"option-active":""]),onClick:A=>p(V),key:V.name},[r(C,null,{default:u(()=>[l("div",ni,xe(V.name),1),ae(l("div",oi,[r(T,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(b)]),_:1})],512),[[le,t.animationName==V.name]])]),_:2},1024)],10,ti))),128))]),_:1})):(H(),ne(P,{key:1,description:"暂无动画","image-size":120}))],2),si,l("div",{class:X(["options",a.value])},[l("div",ii,[r(C,null,{default:u(()=>[r(T,null,{default:u(()=>[r(g)]),_:1}),ai]),_:1})]),l("div",ri,[r(E,{modelValue:t.loop,"onUpdate:modelValue":_[1]||(_[1]=V=>t.loop=V),onChange:h},{default:u(()=>[r(f,{value:"LoopOnce"},{default:u(()=>[F("只执行一次")]),_:1}),r(f,{value:"LoopRepeat"},{default:u(()=>[F("无限循环")]),_:1}),r(f,{value:"LoopPingPong"},{default:u(()=>[F("来回循环")]),_:1})]),_:1},8,["modelValue"])]),l("div",li,[r(C,null,{default:u(()=>[r(T,null,{default:u(()=>[r(x)]),_:1}),ci]),_:1})]),l("div",di,[r(y,{"show-input":"",modelValue:t.timeScale,"onUpdate:modelValue":_[2]||(_[2]=V=>t.timeScale=V),onChange:h,step:.01,min:0,max:1},null,8,["modelValue"])]),l("div",ui,[r(C,null,{default:u(()=>[r(T,null,{default:u(()=>[r(L)]),_:1}),pi]),_:1})]),l("div",hi,[r(y,{"show-input":"",modelValue:t.weight,"onUpdate:modelValue":_[3]||(_[3]=V=>t.weight=V),onChange:h,step:.01,min:0,max:1},null,8,["modelValue"])])],2),l("div",mi,[fi,r(v,{modelValue:t.rotationVisible,"onUpdate:modelValue":_[4]||(_[4]=V=>t.rotationVisible=V),onChange:m},null,8,["modelValue"])]),l("div",gi,[l("div",{class:X(["option",s.value])},[r(C,null,{default:u(()=>[_i,r(E,{modelValue:t.rotationType,"onUpdate:modelValue":_[5]||(_[5]=V=>t.rotationType=V),onChange:S},{default:u(()=>[r(f,{value:"x"},{default:u(()=>[F("X轴")]),_:1}),r(f,{value:"y"},{default:u(()=>[F("Y轴")]),_:1}),r(f,{value:"z"},{default:u(()=>[F("Z轴")]),_:1})]),_:1},8,["modelValue"])]),_:1})],2),l("div",{class:X(["option",s.value])},[r(C,null,{default:u(()=>[r(T,null,{default:u(()=>[r(x)]),_:1}),yi]),_:1})],2),l("div",{class:X(["option",s.value])},[r(y,{onInput:m,"show-input":"",modelValue:t.rotationSpeed,"onUpdate:modelValue":_[6]||(_[6]=V=>t.rotationSpeed=V),step:.01,min:1,max:10},null,8,["modelValue"])],2)])])}}},wi={class:"edit-box"},xi={class:"header"},bi=l("span",null,"辅助线/轴配置",-1),Mi={class:"option space-between"},Si=l("span",null," 模型轴旋转 ",-1),Ci={class:"option"},Li={class:"option"},Ti={class:"option"},Ei={class:"option space-between"},Ai=l("span",null," 模型位置 ",-1),Ii={class:"option"},Pi={class:"grid-txt"},ki={class:"grid-silder"},Ri={class:"option"},Vi={class:"grid-txt"},Fi={class:"grid-silder"},$i={class:"option"},Ui={class:"grid-txt"},Di={class:"grid-silder"},Hi={class:"option space-between"},Oi=l("span",null," 模型骨架 ",-1),zi={class:"option space-between"},Ni=l("span",null," 网格辅助线 ",-1),Gi={class:"option"},Bi={class:"grid-txt"},ji={class:"grid-silder"},Yi={class:"option"},Xi={class:"grid-txt"},Wi={class:"grid-silder"},Zi={class:"option"},Qi={class:"grid-txt"},qi={class:"grid-silder"},Ki={class:"option"},Ji={class:"option"},ea={class:"option space-between"},ta=l("span",null," 坐标轴辅助线 ",-1),na={class:"grid-txt"},oa={class:"grid-silder"},sa={__name:"EditAttribute",setup(n,{expose:e}){const o=we(),{$bus:i}=Ue().proxy,t=_e({visible:!0,skeletonHelper:!1,gridHelper:!1,x:0,y:-.59,z:-.1,positionX:0,positionY:-1,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8}),a=je,s=te(()=>t.visible?"":"disabled"),c=te(()=>{const{visible:P,gridHelper:g}=t;return g&&P?"":"disabled"}),d=te(()=>{const{visible:P,axesHelper:g}=t;return g&&P?"":"disabled"});Be(()=>{i.on("model-update",()=>{Object.assign(t,{visible:!0,skeletonHelper:!1,gridHelper:!1,x:0,y:-.59,z:-.1,positionX:0,positionY:-1,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8})})});const p=()=>{},h=(P,g)=>{const f=g=="right";o.modelApi.onSetModelRotateOnAxis(P,f)},m=()=>{o.modelApi.onResultModelRotateOnAxis()},S=()=>{o.modelApi.onSetModelPosition(t)},M=()=>{t.positionX=0,t.positionY=-1,t.positionZ=0,o.modelApi.onResultModelPosition(t)},_=()=>{o.modelApi.onSetModelHelper(t.skeletonHelper)},v=P=>{t.color=P,o.modelApi.onSetModelGridHelper(t)},b=()=>{o.modelApi.onSetModelGridHelper(t)},T=()=>{o.modelApi.onSetModelGridHelperSize(t)},C=()=>{o.modelApi.onSetModelAxesHelper(t)};return e({getAttrbuteConfig:()=>{const{x:P,y:g,z:f}=o.modelApi.model.rotation;return{...t,rotationX:P,rotationY:g,rotationZ:f}}}),(P,g)=>{const f=w("el-switch"),E=w("Setting"),x=w("el-icon"),y=w("el-space"),L=w("el-button"),V=w("Location"),A=w("el-slider"),G=w("Eleme"),R=w("Grid"),U=w("el-input-number"),D=w("el-color-picker"),Y=w("Rank");return H(),q("div",wi,[l("div",xi,[bi,r(f,{modelValue:t.visible,"onUpdate:modelValue":g[0]||(g[0]=j=>t.visible=j),onChange:p},null,8,["modelValue"])]),l("div",{class:X(["options",s.value])},[l("div",Mi,[r(y,null,{default:u(()=>[r(x,null,{default:u(()=>[r(E)]),_:1}),Si]),_:1}),r(L,{type:"primary",link:"",icon:"Refresh",onClick:m},{default:u(()=>[F(" 重置 ")]),_:1})]),l("div",Ci,[r(L,{type:"info",icon:"RefreshRight",onClick:g[1]||(g[1]=j=>h("x","right"))}),r(L,{type:"primary",link:""},{default:u(()=>[F("X轴")]),_:1}),r(L,{type:"info",icon:"RefreshLeft",onClick:g[2]||(g[2]=j=>h("x","left"))})]),l("div",Li,[r(L,{type:"info",icon:"RefreshRight",onClick:g[3]||(g[3]=j=>h("y","right"))}),r(L,{type:"primary",link:""},{default:u(()=>[F("Y轴")]),_:1}),r(L,{type:"info",icon:"RefreshLeft",onClick:g[4]||(g[4]=j=>h("y","left"))})]),l("div",Ti,[r(L,{type:"info",icon:"RefreshRight",onClick:g[5]||(g[5]=j=>h("z","right"))}),r(L,{type:"primary",link:""},{default:u(()=>[F("Z轴")]),_:1}),r(L,{type:"info",icon:"RefreshLeft",onClick:g[6]||(g[6]=j=>h("z","left"))})]),l("div",Ei,[r(y,null,{default:u(()=>[r(x,null,{default:u(()=>[r(V)]),_:1}),Ai]),_:1}),r(L,{type:"primary",link:"",icon:"Refresh",onClick:M},{default:u(()=>[F(" 重置 ")]),_:1})]),l("div",Ii,[l("div",Pi,[r(L,{type:"primary",link:""},{default:u(()=>[F("X 轴")]),_:1})]),l("div",ki,[r(A,{onInput:S,"show-input":"",modelValue:t.positionX,"onUpdate:modelValue":g[7]||(g[7]=j=>t.positionX=j),min:-10,max:10,step:.1},null,8,["modelValue"])])]),l("div",Ri,[l("div",Vi,[r(L,{type:"primary",link:""},{default:u(()=>[F("Y 轴")]),_:1})]),l("div",Fi,[r(A,{onInput:S,"show-input":"",modelValue:t.positionY,"onUpdate:modelValue":g[8]||(g[8]=j=>t.positionY=j),min:-10,max:10,step:.1},null,8,["modelValue"])])]),l("div",$i,[l("div",Ui,[r(L,{type:"primary",link:""},{default:u(()=>[F("Z 轴")]),_:1})]),l("div",Di,[r(A,{onInput:S,"show-input":"",modelValue:t.positionZ,"onUpdate:modelValue":g[9]||(g[9]=j=>t.positionZ=j),min:-10,max:10,step:.1},null,8,["modelValue"])])]),l("div",Hi,[r(y,null,{default:u(()=>[r(x,null,{default:u(()=>[r(G)]),_:1}),Oi]),_:1}),r(f,{modelValue:t.skeletonHelper,"onUpdate:modelValue":g[10]||(g[10]=j=>t.skeletonHelper=j),onChange:_},null,8,["modelValue"])])],2),l("div",{class:X(["options",s.value])},[l("div",zi,[r(y,null,{default:u(()=>[r(x,null,{default:u(()=>[r(R)]),_:1}),Ni]),_:1}),r(f,{modelValue:t.gridHelper,"onUpdate:modelValue":g[11]||(g[11]=j=>t.gridHelper=j),onChange:b},null,8,["modelValue"])])],2),l("div",{class:X(["options",c.value])},[l("div",Gi,[l("div",Bi,[r(L,{type:"primary",link:""},{default:u(()=>[F("X 轴")]),_:1})]),l("div",ji,[r(A,{"show-input":"",onInput:b,modelValue:t.x,"onUpdate:modelValue":g[12]||(g[12]=j=>t.x=j),min:-2,max:4,step:.01},null,8,["modelValue"])])]),l("div",Yi,[l("div",Xi,[r(L,{type:"primary",link:""},{default:u(()=>[F("Y 轴")]),_:1})]),l("div",Wi,[r(A,{"show-input":"",onInput:b,modelValue:t.y,"onUpdate:modelValue":g[13]||(g[13]=j=>t.y=j),min:-2,max:4,step:.01},null,8,["modelValue"])])]),l("div",Zi,[l("div",Qi,[r(L,{type:"primary",link:""},{default:u(()=>[F("Z 轴")]),_:1})]),l("div",qi,[r(A,{"show-input":"",onInput:b,modelValue:t.z,"onUpdate:modelValue":g[14]||(g[14]=j=>t.z=j),min:-2,max:4,step:.01},null,8,["modelValue"])])]),l("div",Ki,[l("div",null,[r(L,{type:"primary",link:""},{default:u(()=>[F("大小")]),_:1}),r(U,{controls:!0,onChange:T,modelValue:t.size,"onUpdate:modelValue":g[15]||(g[15]=j=>t.size=j),min:1,max:40},null,8,["modelValue"])]),l("div",null,[r(L,{type:"primary",link:""},{default:u(()=>[F("分割数")]),_:1}),r(U,{controls:!0,onChange:T,modelValue:t.divisions,"onUpdate:modelValue":g[16]||(g[16]=j=>t.divisions=j),min:1,max:40},null,8,["modelValue"])])]),l("div",Ji,[r(y,null,{default:u(()=>[r(L,{type:"primary",link:""},{default:u(()=>[F("网格颜色")]),_:1}),r(D,{"color-format":"hex",predefine:re(a),onChange:b,onActiveChange:v,modelValue:t.color,"onUpdate:modelValue":g[17]||(g[17]=j=>t.color=j)},null,8,["predefine","modelValue"])]),_:1})])],2),l("div",{class:X(["options",s.value])},[l("div",ea,[r(y,null,{default:u(()=>[r(x,null,{default:u(()=>[r(Y)]),_:1}),ta]),_:1}),r(f,{modelValue:t.axesHelper,"onUpdate:modelValue":g[18]||(g[18]=j=>t.axesHelper=j),onChange:C},null,8,["modelValue"])]),l("div",{class:X(["option",d.value])},[l("div",na,[r(L,{type:"primary",link:""},{default:u(()=>[F("轴长度")]),_:1})]),l("div",oa,[r(A,{onInput:C,modelValue:t.axesSize,"onUpdate:modelValue":g[19]||(g[19]=j=>t.axesSize=j),min:1,max:10,step:.2},null,8,["modelValue"])])],2)],2)])}}},He=n=>(Fe("data-v-1f2a3c72"),n=n(),$e(),n),ia={class:"edit-box"},aa={class:"header"},ra=He(()=>l("span",null,"模型灯光",-1)),la={class:"options"},ca={class:"option space-between"},da=He(()=>l("span",null,"光源平面",-1)),ua=He(()=>l("span",null,"平面颜色",-1)),pa={class:"grid-txt"},ha={class:"grid-silder"},ma={class:"grid-txt"},fa={class:"grid-silder"},ga={class:"options"},_a={class:"option space-between"},ya=He(()=>l("span",null,"环境光",-1)),va={class:"color"},wa={class:"silder"},xa={class:"options"},ba={class:"option space-between"},Ma=He(()=>l("span",null,"平行光",-1)),Sa={class:"color"},Ca={class:"silder"},La={class:"grid-txt"},Ta={class:"grid-silder"},Ea={class:"grid-txt"},Aa={class:"grid-silder"},Ia={class:"grid-txt"},Pa={class:"grid-silder"},ka={class:"grid-txt"},Ra={class:"grid-silder"},Va={class:"grid-txt"},Fa={class:"grid-silder"},$a={class:"options"},Ua={class:"option space-between"},Da=He(()=>l("span",null,"点光源",-1)),Ha={class:"grid-txt"},Oa={class:"grid-silder"},za={class:"color"},Na={class:"silder"},Ga={class:"grid-txt"},Ba={class:"grid-silder"},ja={class:"grid-txt"},Ya={class:"grid-silder"},Xa={class:"grid-txt"},Wa={class:"grid-silder"},Za={class:"options"},Qa={class:"option space-between"},qa=He(()=>l("span",null,"聚光灯",-1)),Ka={class:"color"},Ja={class:"silder"},er={class:"grid-txt"},tr={class:"grid-silder"},nr={class:"grid-txt"},or={class:"grid-silder"},sr={class:"grid-txt"},ir={class:"grid-silder"},ar={class:"grid-txt"},rr={class:"grid-silder"},lr={class:"grid-txt"},cr={class:"grid-silder"},dr={class:"grid-txt"},ur={class:"grid-silder"},pr={class:"grid-txt"},hr={class:"grid-silder"},mr={class:"grid-txt"},fr={class:"grid-silder"},gr={class:"grid-txt"},_r={class:"grid-silder"},yr={__name:"EditLight",setup(n,{expose:e}){const o=we(),{$bus:i}=Ue().proxy,t=_e({planeGeometry:!1,planeColor:"#000000",planeWidth:7,planeHeight:7,ambientLight:!0,ambientLightColor:"#fff",ambientLightIntensity:.8,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#fff",directionalLightIntensity:5,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistance:2.98,directionaShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:10,pointHorizontal:-4.21,pointVertical:-4.1,pointSistance:2.53,spotLight:!1,spotLightColor:"#00BABD",spotLightIntensity:900,spotHorizontal:-3.49,spotVertical:-4.37,spotSistance:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20}),a=je,s=te(()=>{const{ambientLight:x}=t;return x?"":"disabled"}),c=te(()=>{const{directionalLight:x}=t;return x?"":"disabled"}),d=te(()=>{const{pointLight:x}=t;return x?"":"disabled"}),p=te(()=>{const{spotLight:x}=t;return x?"":"disabled"}),h=te(()=>{const{planeGeometry:x}=t;return x?"":"disabled"}),m=_e({modelApi:te(()=>o.modelApi)});Be(()=>{i.on("model-update",()=>{f()})});const S=x=>{t.ambientLightColor=x,m.modelApi.onSetModelAmbientLight(t)},M=()=>{m.modelApi.onSetModelAmbientLight(t)},_=x=>{t.directionalLightColor=x,m.modelApi.onSetModelDirectionalLight(t)},v=()=>{t.directionalLight&&(t.planeGeometry=!0,m.modelApi.onSetModelPlaneGeometry(t)),m.modelApi.onSetModelDirectionalLight(t)},b=x=>{t.pointLightColor=x,m.modelApi.onSetModelPointLight(t)},T=()=>{m.modelApi.onSetModelPointLight(t)},C=x=>{t.spotLightColor=x,m.modelApi.onSetModelSpotLight(t)},I=()=>{t.spotLight&&(t.planeGeometry=!0,m.modelApi.onSetModelPlaneGeometry(t)),m.modelApi.onSetModelSpotLight(t)},P=x=>{t.planeColor=x,m.modelApi.onSetModelPlaneGeometry(t)},g=()=>{m.modelApi.onSetModelPlaneGeometry(t)},f=()=>{Object.assign(t,{planeGeometry:!1,planeColor:"#000000",planeWidth:7,planeHeight:7,ambientLight:!0,ambientLightColor:"#fff",ambientLightIntensity:.8,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#fff",directionalLightIntensity:5,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistance:2.98,directionaShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:10,pointHorizontal:-4.21,pointVertical:-4.1,pointSistance:2.53,spotLight:!1,spotLightColor:"#00BABD",spotLightIntensity:900,spotHorizontal:-3.49,spotVertical:-4.37,spotSistance:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20})},E=()=>{f(),m.modelApi.onResettingLight({ambientLight:!0})};return e({config:t}),(x,y)=>{const L=w("el-button"),V=w("Odometer"),A=w("el-icon"),G=w("el-space"),R=w("el-switch"),U=w("el-color-picker"),D=w("el-slider"),Y=w("SetUp"),j=w("Place"),J=w("Orange"),ie=w("el-scrollbar");return H(),q("div",ia,[l("div",aa,[ra,r(L,{type:"primary",icon:"Refresh",onClick:E},{default:u(()=>[F(" 重置 ")]),_:1})]),r(ie,{height:"calc(100vh - 130px)"},{default:u(()=>[l("div",la,[l("div",ca,[r(G,null,{default:u(()=>[r(A,null,{default:u(()=>[r(V)]),_:1}),da]),_:1}),r(R,{modelValue:t.planeGeometry,"onUpdate:modelValue":y[0]||(y[0]=$=>t.planeGeometry=$),onChange:g},null,8,["modelValue"])]),l("div",{class:X(["option",h.value])},[r(G,null,{default:u(()=>[ua,r(U,{"color-format":"hex",modelValue:t.planeColor,"onUpdate:modelValue":y[1]||(y[1]=$=>t.planeColor=$),predefine:re(a),onChange:g,onActiveChange:P},null,8,["modelValue","predefine"])]),_:1})],2),l("div",{class:X(["option",h.value])},[l("div",pa,[r(L,{type:"primary",link:""},{default:u(()=>[F("宽度")]),_:1})]),l("div",ha,[r(D,{"show-input":"",onInput:g,modelValue:t.planeWidth,"onUpdate:modelValue":y[2]||(y[2]=$=>t.planeWidth=$),min:0,max:100,step:.1},null,8,["modelValue"])])],2),l("div",{class:X(["option",h.value])},[l("div",ma,[r(L,{type:"primary",link:""},{default:u(()=>[F("高度")]),_:1})]),l("div",fa,[r(D,{"show-input":"",onInput:g,modelValue:t.planeHeight,"onUpdate:modelValue":y[3]||(y[3]=$=>t.planeHeight=$),min:0,max:100,step:.1},null,8,["modelValue"])])],2)]),l("div",ga,[l("div",_a,[r(G,null,{default:u(()=>[r(A,null,{default:u(()=>[r(V)]),_:1}),ya]),_:1}),r(R,{modelValue:t.ambientLight,"onUpdate:modelValue":y[4]||(y[4]=$=>t.ambientLight=$),onChange:M},null,8,["modelValue"])]),l("div",{class:X(["option",s.value])},[l("div",va,[r(U,{"color-format":"hex",modelValue:t.ambientLightColor,"onUpdate:modelValue":y[5]||(y[5]=$=>t.ambientLightColor=$),predefine:re(a),onChange:M,onActiveChange:S},null,8,["modelValue","predefine"])]),l("div",wa,[r(D,{"show-input":"",onInput:M,modelValue:t.ambientLightIntensity,"onUpdate:modelValue":y[6]||(y[6]=$=>t.ambientLightIntensity=$),min:-5,max:5,step:.01},null,8,["modelValue"])])],2)]),l("div",xa,[l("div",ba,[r(G,null,{default:u(()=>[r(A,null,{default:u(()=>[r(Y)]),_:1}),Ma]),_:1}),r(R,{modelValue:t.directionalLight,"onUpdate:modelValue":y[7]||(y[7]=$=>t.directionalLight=$),onChange:v},null,8,["modelValue"])]),l("div",{class:X(["option",c.value])},[l("div",Sa,[r(U,{"color-format":"hex",modelValue:t.directionalLightColor,"onUpdate:modelValue":y[8]||(y[8]=$=>t.directionalLightColor=$),predefine:re(a),onChange:v,onActiveChange:_},null,8,["modelValue","predefine"])]),l("div",Ca,[r(D,{"show-input":"",onInput:v,modelValue:t.directionalLightIntensity,"onUpdate:modelValue":y[9]||(y[9]=$=>t.directionalLightIntensity=$),min:-5,max:15,step:.01},null,8,["modelValue"])])],2),l("div",{class:X(["option",c.value])},[l("div",La,[r(L,{type:"primary",link:""},{default:u(()=>[F("是否开启阴影")]),_:1})]),l("div",Ta,[r(R,{modelValue:t.directionaShadow,"onUpdate:modelValue":y[10]||(y[10]=$=>t.directionaShadow=$),onChange:v},null,8,["modelValue"])]),r(G,null,{default:u(()=>[l("div",Ea,[r(L,{type:"primary",link:""},{default:u(()=>[F("辅助线")]),_:1})]),l("div",Aa,[r(R,{modelValue:t.directionalLightHelper,"onUpdate:modelValue":y[11]||(y[11]=$=>t.directionalLightHelper=$),onChange:v},null,8,["modelValue"])])]),_:1})],2),l("div",{class:X(["option",c.value])},[l("div",Ia,[r(L,{type:"primary",link:""},{default:u(()=>[F("水平方向")]),_:1})]),l("div",Pa,[r(D,{"show-input":"",onInput:v,modelValue:t.directionalHorizontal,"onUpdate:modelValue":y[12]||(y[12]=$=>t.directionalHorizontal=$),min:-10,max:10,step:.01},null,8,["modelValue"])])],2),l("div",{class:X(["option",c.value])},[l("div",ka,[r(L,{type:"primary",link:""},{default:u(()=>[F("垂直方向")]),_:1})]),l("div",Ra,[r(D,{"show-input":"",onInput:v,modelValue:t.directionalVertical,"onUpdate:modelValue":y[13]||(y[13]=$=>t.directionalVertical=$),min:-10,max:10,step:.01},null,8,["modelValue"])])],2),l("div",{class:X(["option",c.value])},[l("div",Va,[r(L,{type:"primary",link:""},{default:u(()=>[F("光源距离")]),_:1})]),l("div",Fa,[r(D,{"show-input":"",onInput:v,modelValue:t.directionalSistance,"onUpdate:modelValue":y[14]||(y[14]=$=>t.directionalSistance=$),min:0,max:10,step:.01},null,8,["modelValue"])])],2)]),l("div",$a,[l("div",Ua,[r(G,null,{default:u(()=>[r(A,null,{default:u(()=>[r(j)]),_:1}),Da]),_:1}),r(R,{modelValue:t.pointLight,"onUpdate:modelValue":y[15]||(y[15]=$=>t.pointLight=$),onChange:T},null,8,["modelValue"])]),l("div",{class:X(["option",d.value])},[r(G,null,{default:u(()=>[l("div",Ha,[r(L,{type:"primary",link:""},{default:u(()=>[F("辅助线")]),_:1})]),l("div",Oa,[r(R,{modelValue:t.pointLightHelper,"onUpdate:modelValue":y[16]||(y[16]=$=>t.pointLightHelper=$),onChange:T},null,8,["modelValue"])])]),_:1})],2),l("div",{class:X(["option",d.value])},[l("div",za,[r(U,{"color-format":"hex",modelValue:t.pointLightColor,"onUpdate:modelValue":y[17]||(y[17]=$=>t.pointLightColor=$),predefine:re(a),onChange:T,onActiveChange:b},null,8,["modelValue","predefine"])]),l("div",Na,[r(D,{"show-input":"",onInput:T,modelValue:t.pointLightIntensity,"onUpdate:modelValue":y[18]||(y[18]=$=>t.pointLightIntensity=$),min:-20,max:60,step:.1},null,8,["modelValue"])])],2),l("div",{class:X(["option",d.value])},[l("div",Ga,[r(L,{type:"primary",link:""},{default:u(()=>[F("水平方向")]),_:1})]),l("div",Ba,[r(D,{"show-input":"",onInput:T,modelValue:t.pointHorizontal,"onUpdate:modelValue":y[19]||(y[19]=$=>t.pointHorizontal=$),min:-10,max:10,step:.11},null,8,["modelValue"])])],2),l("div",{class:X(["option",d.value])},[l("div",ja,[r(L,{type:"primary",link:""},{default:u(()=>[F("垂直方向")]),_:1})]),l("div",Ya,[r(D,{"show-input":"",onInput:T,modelValue:t.pointVertical,"onUpdate:modelValue":y[20]||(y[20]=$=>t.pointVertical=$),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),l("div",{class:X(["option",d.value])},[l("div",Xa,[r(L,{type:"primary",link:""},{default:u(()=>[F("光源距离")]),_:1})]),l("div",Wa,[r(D,{"show-input":"",onInput:T,modelValue:t.pointSistance,"onUpdate:modelValue":y[21]||(y[21]=$=>t.pointSistance=$),min:0,max:10,step:.1},null,8,["modelValue"])])],2)]),l("div",Za,[l("div",Qa,[r(G,null,{default:u(()=>[r(A,null,{default:u(()=>[r(J)]),_:1}),qa]),_:1}),r(R,{modelValue:t.spotLight,"onUpdate:modelValue":y[22]||(y[22]=$=>t.spotLight=$),onChange:I},null,8,["modelValue"])]),l("div",{class:X(["option",p.value])},[l("div",Ka,[r(U,{"color-format":"hex",modelValue:t.spotLightColor,"onUpdate:modelValue":y[23]||(y[23]=$=>t.spotLightColor=$),predefine:re(a),onChange:I,onActiveChange:C},null,8,["modelValue","predefine"])]),l("div",Ja,[r(D,{"show-input":"",onInput:I,modelValue:t.spotLightIntensity,"onUpdate:modelValue":y[24]||(y[24]=$=>t.spotLightIntensity=$),min:0,max:2e3,step:.1},null,8,["modelValue"])])],2),l("div",{class:X(["option",p.value])},[l("div",er,[r(L,{type:"primary",link:""},{default:u(()=>[F("是否开启阴影")]),_:1})]),l("div",tr,[r(R,{modelValue:t.spotCastShadow,"onUpdate:modelValue":y[25]||(y[25]=$=>t.spotCastShadow=$),onChange:I},null,8,["modelValue"])]),r(G,null,{default:u(()=>[l("div",nr,[r(L,{type:"primary",link:""},{default:u(()=>[F("辅助线")]),_:1})]),l("div",or,[r(R,{modelValue:t.spotLightHelper,"onUpdate:modelValue":y[26]||(y[26]=$=>t.spotLightHelper=$),onChange:I},null,8,["modelValue"])])]),_:1})],2),l("div",{class:X(["option",p.value])},[l("div",sr,[r(L,{type:"primary",link:""},{default:u(()=>[F("水平方向")]),_:1})]),l("div",ir,[r(D,{"show-input":"",onInput:I,modelValue:t.spotHorizontal,"onUpdate:modelValue":y[27]||(y[27]=$=>t.spotHorizontal=$),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),l("div",{class:X(["option",p.value])},[l("div",ar,[r(L,{type:"primary",link:""},{default:u(()=>[F("垂直方向")]),_:1})]),l("div",rr,[r(D,{"show-input":"",onInput:I,modelValue:t.spotVertical,"onUpdate:modelValue":y[28]||(y[28]=$=>t.spotVertical=$),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),l("div",{class:X(["option",p.value])},[l("div",lr,[r(L,{type:"primary",link:""},{default:u(()=>[F("光源距离")]),_:1})]),l("div",cr,[r(D,{"show-input":"",onInput:I,modelValue:t.spotSistance,"onUpdate:modelValue":y[29]||(y[29]=$=>t.spotSistance=$),min:0,max:10,step:.1},null,8,["modelValue"])])],2),l("div",{class:X(["option",p.value])},[l("div",dr,[r(L,{type:"primary",link:""},{default:u(()=>[F("光线照射范围")]),_:1})]),l("div",ur,[r(D,{"show-input":"",onInput:I,modelValue:t.spotAngle,"onUpdate:modelValue":y[30]||(y[30]=$=>t.spotAngle=$),min:0,max:2,step:.01},null,8,["modelValue"])])],2),l("div",{class:X(["option",p.value])},[l("div",pr,[r(L,{type:"primary",link:""},{default:u(()=>[F("边缘聚光度")]),_:1})]),l("div",hr,[r(D,{"show-input":"",onInput:I,modelValue:t.spotPenumbra,"onUpdate:modelValue":y[31]||(y[31]=$=>t.spotPenumbra=$),min:0,max:1,step:.01},null,8,["modelValue"])])],2),l("div",{class:X(["option",p.value])},[l("div",mr,[r(L,{type:"primary",link:""},{default:u(()=>[F("投影聚焦度")]),_:1})]),l("div",fr,[r(D,{"show-input":"",onInput:I,modelValue:t.spotFocus,"onUpdate:modelValue":y[32]||(y[32]=$=>t.spotFocus=$),min:0,max:3,step:.01},null,8,["modelValue"])])],2),l("div",{class:X(["option",p.value])},[l("div",gr,[r(L,{type:"primary",link:""},{default:u(()=>[F("光源照射距离")]),_:1})]),l("div",_r,[r(D,{"show-input":"",onInput:I,modelValue:t.spotDistance,"onUpdate:modelValue":y[33]||(y[33]=$=>t.spotDistance=$),min:1,max:500,step:1},null,8,["modelValue"])])],2)])]),_:1})])}}},vr=Le(yr,[["__scopeId","data-v-1f2a3c72"]]),wr={class:"edit-box"},xr={class:"header"},br=l("span",null,"后期处理",-1),Mr={class:"options"},Sr={class:"option space-between"},Cr=l("span",null," 辉光 ",-1),Lr={class:"option"},Tr={class:"grid-txt"},Er={class:"grid-silder"},Ar={class:"option"},Ir={class:"grid-txt"},Pr={class:"grid-silder"},kr={class:"option"},Rr={class:"grid-txt"},Vr={class:"grid-silder"},Fr={class:"option"},$r={class:"grid-txt"},Ur={class:"grid-silder"},Dr={class:"options"},Hr={class:"option space-between"},Or=l("span",null," 色调曝光度 ",-1),zr={class:"grid-silder"},Nr={class:"header"},Gr=l("span",null,"模型操作",-1),Br={class:"options"},jr=l("span",null," 模型分解 ",-1),Yr={class:"grid-silder"},Xr=l("span",null," 模型材质操作 ",-1),Wr={class:"grid-silder"},Zr={class:"grid-silder"},Qr={__name:"EditLaterStage",setup(n,{expose:e}){const o=we(),{$bus:i}=Ue().proxy,t=te(()=>{const{glow:T}=d;return T?"":"disabled"}),a=te(()=>{const T=o.modelApi.modelMaterialList,C=T.filter(I=>I.type=="Mesh");return C.length<=1||C.length!=T.length||d.manageFlage?"disabled":""}),s=te(()=>{const T=o.modelApi.modelMaterialList,C=T.filter(I=>I.type=="Mesh");return C.length<=1||C.length!=T.length?"disabled":""}),c=te(()=>d.manageFlage?"":"disabled"),d=_e({glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlage:!1,manageFlage:!1,toneMappingExposure:2,color:""});Be(()=>{i.on("model-update",()=>{Object.assign(d,{glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlage:!1,toneMappingExposure:2})})});const p=()=>{o.modelApi.onSetFlowColor(d.color)},h=T=>{d.color=T,o.modelApi.onSetFlowColor(d.color)},m=()=>{o.modelApi.onSetUnrealBloomPass(d)},S=()=>{o.modelApi.setModelMeshDecompose(d)},M=()=>{d.decompose=0,o.modelApi.setModelMeshDrag(d)},_=T=>{o.modelApi.setTransformControlsType(T)},v=()=>{Object.assign(d,{glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlage:!1,toneMappingExposure:2}),o.modelApi.initStageFlow()};return e({getStageConfig:()=>({meshPositonList:o.modelApi.getMeshDragPosition(),...d})}),(T,C)=>{const I=w("el-button"),P=w("Sunny"),g=w("el-icon"),f=w("el-space"),E=w("WarnTriangleFilled"),x=w("el-switch"),y=w("el-tooltip"),L=w("el-color-picker"),V=w("el-slider"),A=w("Umbrella"),G=w("Cpu"),R=w("Rank"),U=w("el-radio-button"),D=w("el-radio-group");return H(),q("div",wr,[l("div",xr,[br,r(I,{type:"primary",icon:"Refresh",onClick:v},{default:u(()=>[F(" 重置 ")]),_:1})]),l("div",Mr,[l("div",Sr,[r(f,null,{default:u(()=>[r(g,null,{default:u(()=>[r(P)]),_:1}),Cr]),_:1}),r(y,{effect:"dark",content:"注意：辉光效果十分耗费性能，大模型文件开启会有卡顿，请谨慎使用 ",placement:"top"},{default:u(()=>[r(f,null,{default:u(()=>[r(g,null,{default:u(()=>[r(E,{size:20,color:"#ffb940"})]),_:1}),r(x,{modelValue:d.glow,"onUpdate:modelValue":C[0]||(C[0]=Y=>d.glow=Y),onChange:m},null,8,["modelValue"])]),_:1})]),_:1})])]),l("div",{class:X(["options",t.value])},[l("div",Lr,[l("div",Tr,[r(I,{type:"primary",link:""},{default:u(()=>[F("颜色")]),_:1})]),l("div",Er,[r(L,{"color-format":"hex",predefine:re(je),onChange:p,onActiveChange:h,modelValue:d.color,"onUpdate:modelValue":C[1]||(C[1]=Y=>d.color=Y)},null,8,["predefine","modelValue"])])]),l("div",Ar,[l("div",Ir,[r(I,{type:"primary",link:""},{default:u(()=>[F("强度")]),_:1})]),l("div",Pr,[r(V,{"show-input":"",modelValue:d.strength,"onUpdate:modelValue":C[2]||(C[2]=Y=>d.strength=Y),onInput:m,step:.01,min:0,max:8},null,8,["modelValue"])])]),l("div",kr,[l("div",Rr,[r(I,{type:"primary",link:""},{default:u(()=>[F("半径")]),_:1})]),l("div",Vr,[r(V,{"show-input":"",modelValue:d.radius,"onUpdate:modelValue":C[3]||(C[3]=Y=>d.radius=Y),onInput:m,step:.01,min:0,max:5},null,8,["modelValue"])])]),l("div",Fr,[l("div",$r,[r(I,{type:"primary",link:""},{default:u(()=>[F("阈值")]),_:1})]),l("div",Ur,[r(V,{"show-input":"",modelValue:d.threshold,"onUpdate:modelValue":C[4]||(C[4]=Y=>d.threshold=Y),onInput:m,step:.01,min:0,max:1},null,8,["modelValue"])])])],2),l("div",Dr,[l("div",Hr,[r(f,null,{default:u(()=>[r(g,null,{default:u(()=>[r(A)]),_:1}),Or]),_:1}),l("div",zr,[r(V,{"show-input":"",modelValue:d.toneMappingExposure,"onUpdate:modelValue":C[5]||(C[5]=Y=>d.toneMappingExposure=Y),onInput:m,step:.01,min:.5,max:10},null,8,["modelValue"])])])]),l("div",Nr,[r(f,null,{default:u(()=>[Gr,a.value=="disabled"?(H(),ne(y,{key:0,effect:"dark",content:"当前模型不可进行以下操作",placement:"top"},{default:u(()=>[r(g,null,{default:u(()=>[r(E,{size:20,color:"#ffb940"})]),_:1})]),_:1})):ye("",!0)]),_:1})]),l("div",Br,[l("div",{class:X(["option space-between",a.value])},[r(f,null,{default:u(()=>[r(g,null,{default:u(()=>[r(G)]),_:1}),jr]),_:1}),l("div",Yr,[r(V,{"show-input":"",modelValue:d.decompose,"onUpdate:modelValue":C[6]||(C[6]=Y=>d.decompose=Y),onInput:S,step:.01,min:0,max:800},null,8,["modelValue"])])],2),l("div",{class:X(["option",s.value])},[r(f,null,{default:u(()=>[r(g,null,{default:u(()=>[r(R,{size:20})]),_:1}),Xr]),_:1}),l("div",Wr,[r(x,{modelValue:d.manageFlage,"onUpdate:modelValue":C[7]||(C[7]=Y=>d.manageFlage=Y),onChange:M},null,8,["modelValue"])])],2),l("div",{class:X(["option",c.value])},[l("div",Zr,[r(D,{modelValue:d.transformType,"onUpdate:modelValue":C[8]||(C[8]=Y=>d.transformType=Y),onChange:_},{default:u(()=>[r(U,{value:"translate"},{default:u(()=>[F("拖拽")]),_:1}),r(U,{value:"rotate"},{default:u(()=>[F("旋转")]),_:1}),r(U,{value:"scale"},{default:u(()=>[F("缩放")]),_:1})]),_:1},8,["modelValue"])])],2)])])}}},En=n=>(Fe("data-v-106173a7"),n=n(),$e(),n),qr={class:"edit-box"},Kr=En(()=>l("div",{class:"header"},[l("span",null,"几何体模型材质列表")],-1)),Jr={class:"options"},el=["onClick"],tl={class:"icon-name"},nl={class:"check"},ol={class:"icon-delete"},sl=En(()=>l("div",{class:"header"},[l("span",null,"几何体模型编辑")],-1)),il={class:"options"},al={class:"grid-txt"},rl={class:"grid-silder"},ll={key:1},cl={__name:"EditGeometry",setup(n){const e=we(),o=_e({meaterialName:null,type:null}),i=ee(null),t=ee([]),a=te(()=>s.modelMaterialList.filter(S=>S.userData.geometry)!=0),s=_e({modelMaterialList:te(()=>e.modelApi.modelMaterialList),selectMeshUuid:te(()=>e.selectMeshUuid)});gn(()=>e.selectMeshUuid,m=>{const{geometry:S}=s.modelMaterialList.find(M=>M.uuid==m)||{};if(S){const{type:M}=S;i.value={...S.parameters},o.type=M,t.value=Object.keys(i.value)}else t.value=[]});const c=({name:m,material:S,geometry:M})=>{o.meaterialName=S.name,e.modelApi.onChangeModelMeaterial(m)},d=()=>{e.modelApi.onSetGeometryMesh(i.value,o.type)},p=m=>{e.modelApi.onDeleteGeometryMesh(m),e.selectMeshAction({}),ce.success("删除成功")},h=m=>{let S={min:1,max:80,step:.01};return["width","height","radius","length","thetaLength","radiusTop","innerRadius","radiusBottom","q","outerRadius","arc","tube","p"].includes(m)&&(S={min:.1,max:10,step:.01}),["detail","capSegments","radialSegments","thetaStart","depthSegments","widthSegments","heightSegments"].includes(m)&&(S={min:0,max:10,step:1}),S};return(m,S)=>{const M=w("Check"),_=w("el-icon"),v=w("Delete"),b=w("el-space"),T=w("el-scrollbar"),C=w("el-button"),I=w("el-slider"),P=w("el-switch"),g=w("el-empty");return H(),q("div",qr,[a.value?(H(),q(me,{key:0},[Kr,l("div",Jr,[r(T,{"max-height":"300px"},{default:u(()=>[(H(!0),q(me,null,ge(s.modelMaterialList,f=>(H(),q("div",{class:X(["option",s.selectMeshUuid==f.uuid?"option-active":""]),onClick:E=>c(f),key:f.uuid},[l("div",tl,xe(f.name),1),r(b,null,{default:u(()=>[ae(l("div",nl,[r(_,{size:"20px",color:"#2a3ff6"},{default:u(()=>[r(M)]),_:1})],512),[[le,s.selectMeshUuid==f.uuid]]),l("div",ol,[r(_,{size:"18px",color:"#2a3ff6"},{default:u(()=>[r(v,{onClick:it(E=>p(f.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)])]),_:2},1024)],10,el))),128))]),_:1})]),sl,l("div",il,[(H(!0),q(me,null,ge(t.value,f=>(H(),q("div",{class:"option",key:f},[l("div",al,[r(C,{type:"primary",link:""},{default:u(()=>[F(xe(f),1)]),_:2},1024)]),l("div",rl,[typeof i.value[f]=="number"?(H(),ne(I,{key:0,"show-input":"",modelValue:i.value[f],"onUpdate:modelValue":E=>i.value[f]=E,min:h(f).min,max:h(f).max,step:h(f).step,onInput:d},null,8,["modelValue","onUpdate:modelValue","min","max","step"])):typeof i.value[f]=="string"?(H(),q("div",ll,xe(i.value[f]),1)):typeof i.value[f]=="boolean"?(H(),ne(P,{key:2,onChange:d,modelValue:i.value[f],"onUpdate:modelValue":E=>i.value[f]=E},null,8,["modelValue","onUpdate:modelValue"])):ye("",!0)])]))),128))])],64)):(H(),ne(g,{key:1,description:"当前模型不支持使用该功能","image-size":120}))])}}},dl=Le(cl,[["__scopeId","data-v-106173a7"]]),lt=n=>(Fe("data-v-0cebceb8"),n=n(),$e(),n),ul={class:"edit-box"},pl={class:"header"},hl=lt(()=>l("span",null," 标签配置 ",-1)),ml={class:"options"},fl={class:"option"},gl=lt(()=>l("span",null,"标签类型",-1)),_l=lt(()=>l("span",{style:{color:"#18c174 "}},"(可拖拽添加多个)",-1)),yl={class:"tag-box"},vl={class:"icon"},wl=lt(()=>l("div",{class:"options"},[l("div",{class:"header"},"标签列表")],-1)),xl={class:"options"},bl=["onClick"],Ml={class:"icon-name"},Sl={class:"check"},Cl={class:"icon-delete"},Ll=lt(()=>l("div",{class:"header"},[l("span",null," 标签编辑 ")],-1)),Tl={key:0,class:"options"},El={class:"option"},Al={class:"grid-txt"},Il={class:"grid-silder"},Pl={class:"option"},kl={class:"grid-txt"},Rl={class:"grid-silder"},Vl={class:"option"},Fl={class:"grid-txt"},$l={class:"grid-silder"},Ul={class:"option"},Dl={class:"grid-txt"},Hl={class:"grid-silder"},Ol={class:"option"},zl={class:"grid-txt"},Nl={class:"grid-silder"},Gl={class:"option"},Bl={class:"grid-txt"},jl={class:"grid-silder"},Yl={class:"option"},Xl={class:"grid-txt"},Wl={class:"grid-silder"},Zl={class:"grid-txt"},Ql={class:"grid-silder"},ql={class:"grid-txt"},Kl={class:"grid-silder"},Jl={class:"option"},ec={class:"grid-txt"},tc={class:"grid-silder"},nc={class:"option",style:{height:"auto"}},oc={class:"grid-txt"},sc={class:"grid-silder"},ic={__name:"EditTags",setup(n,{expose:e}){const o=we(),i=je,t=_e({dragTagList:te(()=>o.modelApi.dragTagList)}),a=te(()=>{const M=[];for(const[_]of Object.entries(_n))M.push({name:_});return M}),s=_e({}),c=(M,_)=>{o.modelApi.setDragTag(_),o.changeDragType("tags")},d=M=>{M.preventDefault()},p=()=>{s.uuid=null,o.modelApi.clearSceneTags()},h=M=>{Object.assign(s,{...M})},m=M=>{o.modelApi.deleteTag(M),s.uuid=null},S=()=>{o.modelApi.updateTagElement(s)};return e({config:t}),(M,_)=>{const v=w("el-button"),b=w("PriceTag"),T=w("el-icon"),C=w("el-space"),I=w("el-col"),P=w("el-row"),g=w("el-scrollbar"),f=w("Check"),E=w("Delete"),x=w("el-empty"),y=w("el-slider"),L=w("el-color-picker"),V=w("el-input");return H(),q("div",ul,[l("div",pl,[hl,r(v,{type:"primary",icon:"Refresh",onClick:p},{default:u(()=>[F(" 重置 ")]),_:1})]),l("div",ml,[l("div",fl,[r(C,null,{default:u(()=>[r(T,null,{default:u(()=>[r(b)]),_:1}),gl,_l]),_:1})]),r(g,{"max-height":"150px"},{default:u(()=>[r(P,{class:"tag-row"},{default:u(()=>[(H(!0),q(me,null,ge(a.value,A=>(H(),ne(I,{draggable:"true",key:A.name,span:4,onDragstart:G=>c(G,A),onDrag:_[0]||(_[0]=G=>d(G))},{default:u(()=>[l("div",yl,[l("div",vl,[r(T,{size:"16px"},{default:u(()=>[(H(),ne(yn(A.name)))]),_:2},1024)])])]),_:2},1032,["onDragstart"]))),128))]),_:1})]),_:1})]),wl,l("div",xl,[t.dragTagList.length?(H(),ne(g,{key:0,"max-height":"170px"},{default:u(()=>[(H(!0),q(me,null,ge(t.dragTagList,A=>(H(),q("div",{class:X(["option",s.uuid==A.uuid?"option-active":""]),onClick:G=>h(A),key:A.uuid},[l("div",Ml,xe(A.innerText),1),r(C,null,{default:u(()=>[ae(l("div",Sl,[r(T,{size:"18px",color:"#2a3ff6"},{default:u(()=>[r(f)]),_:1})],512),[[le,s.uuid==A.uuid]]),l("div",Cl,[r(T,{size:"18px",color:"#2a3ff6"},{default:u(()=>[r(E,{onClick:it(G=>m(A.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)])]),_:2},1024)],10,bl))),128))]),_:1})):(H(),ne(x,{key:1,description:"暂无标签","image-size":100}))]),Ll,s.uuid?(H(),q("div",Tl,[l("div",El,[l("div",Al,[r(v,{type:"primary",link:""},{default:u(()=>[F("容器高度")]),_:1})]),l("div",Il,[r(y,{onInput:S,"show-input":"",modelValue:s.height,"onUpdate:modelValue":_[1]||(_[1]=A=>s.height=A),min:1,max:500,step:1},null,8,["modelValue"])])]),l("div",Pl,[l("div",kl,[r(v,{type:"primary",link:""},{default:u(()=>[F("容器宽度")]),_:1})]),l("div",Rl,[r(y,{onInput:S,"show-input":"",modelValue:s.width,"onUpdate:modelValue":_[2]||(_[2]=A=>s.width=A),min:1,max:500,step:1},null,8,["modelValue"])])]),l("div",Vl,[l("div",Fl,[r(v,{type:"primary",link:""},{default:u(()=>[F("字体大小")]),_:1})]),l("div",$l,[r(y,{onInput:S,"show-input":"",modelValue:s.fontSize,"onUpdate:modelValue":_[3]||(_[3]=A=>s.fontSize=A),min:1,max:50,step:.1},null,8,["modelValue"])])]),l("div",Ul,[l("div",Dl,[r(v,{type:"primary",link:""},{default:u(()=>[F("标签坐标X")]),_:1})]),l("div",Hl,[r(y,{onInput:S,"show-input":"",modelValue:s.positionX,"onUpdate:modelValue":_[4]||(_[4]=A=>s.positionX=A),min:-50,max:50,step:.01},null,8,["modelValue"])])]),l("div",Ol,[l("div",zl,[r(v,{type:"primary",link:""},{default:u(()=>[F("标签坐标Y")]),_:1})]),l("div",Nl,[r(y,{onInput:S,"show-input":"",modelValue:s.positionY,"onUpdate:modelValue":_[5]||(_[5]=A=>s.positionY=A),min:-50,max:50,step:.1},null,8,["modelValue"])])]),l("div",Gl,[l("div",Bl,[r(v,{type:"primary",link:""},{default:u(()=>[F("标签坐标Z")]),_:1})]),l("div",jl,[r(y,{onInput:S,"show-input":"",modelValue:s.positionZ,"onUpdate:modelValue":_[6]||(_[6]=A=>s.positionZ=A),min:-50,max:50,step:.1},null,8,["modelValue"])])]),l("div",Yl,[l("div",Xl,[r(v,{type:"primary",link:""},{default:u(()=>[F("背景颜色")]),_:1})]),l("div",Wl,[r(L,{"color-format":"hex",predefine:re(i),onChange:S,modelValue:s.backgroundColor,"onUpdate:modelValue":_[7]||(_[7]=A=>s.backgroundColor=A)},null,8,["predefine","modelValue"])]),l("div",Zl,[r(v,{type:"primary",link:""},{default:u(()=>[F("图标颜色")]),_:1})]),l("div",Ql,[r(L,{"color-format":"hex",predefine:re(i),onChange:S,modelValue:s.iconColor,"onUpdate:modelValue":_[8]||(_[8]=A=>s.iconColor=A)},null,8,["predefine","modelValue"])]),l("div",ql,[r(v,{type:"primary",link:""},{default:u(()=>[F("字体颜色")]),_:1})]),l("div",Kl,[r(L,{"color-format":"hex",predefine:re(i),onChange:S,modelValue:s.color,"onUpdate:modelValue":_[9]||(_[9]=A=>s.color=A)},null,8,["predefine","modelValue"])])]),l("div",Jl,[l("div",ec,[r(v,{type:"primary",link:""},{default:u(()=>[F("图标大小")]),_:1})]),l("div",tc,[r(y,{onInput:S,"show-input":"",modelValue:s.iconSize,"onUpdate:modelValue":_[10]||(_[10]=A=>s.iconSize=A),min:1,max:50,step:.1},null,8,["modelValue"])])]),l("div",nc,[l("div",oc,[r(v,{type:"primary",link:""},{default:u(()=>[F("标签内容")]),_:1})]),l("div",sc,[r(V,{type:"textarea",autosize:{minRows:3,maxRows:3},onInput:S,modelValue:s.innerText,"onUpdate:modelValue":_[11]||(_[11]=A=>s.innerText=A),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])):ye("",!0)])}}},ac=Le(ic,[["__scopeId","data-v-0cebceb8"]]),rc={class:"model-panel"},lc={class:"panel-tabs"},cc=["onClick"],dc={class:"tab"},uc={class:"panel-edit"},pc={__name:"index",setup(n,{expose:e}){const o=[{name:"背景",key:"EditBackground",icon:"Picture"},{name:"材质",key:"EditMaterial",icon:"DataAnalysis"},{name:"后期/操作",key:"EditLaterStage",icon:"MagicStick"},{name:"灯光",key:"EditLight",icon:"Sunrise"},{name:"模型动画",key:"EditAnimation",icon:"VideoCameraFilled"},{name:"辅助线/轴配置",key:"EditAttribute",icon:"Box"},{name:"几何体模型配置",key:"EditGeometry",icon:"Cellphone"},{name:"标签配置",key:"EditTags",icon:"CollectionTag"}],i=ee("EditMaterial"),t=ee(null),a=ee(null),s=ee(null),c=ee(null),d=ee(null),p=ee(null),h=ee(null),m=ee(null);return ee(null),we(),e({getPanelConfig:()=>({background:t.value.config,material:a.value.getMeshConfig(),animation:s.value.config,attribute:c.value.getAttrbuteConfig(),light:d.value.config,stage:p.value.getStageConfig(),tags:m.value.config})}),(M,_)=>{const v=w("el-icon"),b=w("el-tooltip");return H(),q("div",rc,[l("ul",lc,[(H(),q(me,null,ge(o,T=>l("li",{key:T.key,class:X(i.value==T.key?"active":""),onClick:C=>i.value=T.key},[r(b,{effect:"light",content:T.name,placement:"top"},{default:u(()=>[l("div",dc,[r(v,{size:"20px",color:i.value==T.key?"#fff":""},{default:u(()=>[(H(),ne(yn(T.icon)))]),_:2},1032,["color"])])]),_:2},1032,["content"])],10,cc)),64))]),l("div",uc,[ae(l("div",null,[r(Ts,{ref_key:"background",ref:t},null,512)],512),[[le,i.value=="EditBackground"]]),ae(l("div",null,[r(qs,{ref_key:"material",ref:a},null,512)],512),[[le,i.value=="EditMaterial"]]),ae(l("div",null,[r(Qr,{ref_key:"stage",ref:p},null,512)],512),[[le,i.value=="EditLaterStage"]]),ae(l("div",null,[r(vi,{ref_key:"animation",ref:s},null,512)],512),[[le,i.value=="EditAnimation"]]),ae(l("div",null,[r(vr,{ref_key:"light",ref:d},null,512)],512),[[le,i.value=="EditLight"]]),ae(l("div",null,[r(sa,{ref_key:"attribute",ref:c},null,512)],512),[[le,i.value=="EditAttribute"]]),ae(l("div",null,[r(dl,{ref_key:"geometry",ref:h},null,512)],512),[[le,i.value=="EditGeometry"]]),ae(l("div",null,[r(ac,{ref_key:"tags",ref:m},null,512)],512),[[le,i.value=="EditTags"]])])])}}},hc=Le(pc,[["__scopeId","data-v-b652900c"]]),mc={class:"model-choose"},fc=l("div",{class:"header"},[l("span",null,"模型列表")],-1),gc={class:"options"},_c={class:"option"},yc=l("span",null,"普通模型",-1),vc={class:"options"},wc={class:"option"},xc=l("span",null,"动画模型",-1),bc={class:"options"},Mc={class:"option"},Sc=l("span",null,"几何体模型",-1),Cc={key:0,style:{color:"#18c174 "}},Lc=["onDragstart"],Tc={class:"geometry-name"},Ec={key:1,class:"geometry-box"},Ac={class:"icon"},Ic=l("div",null,[l("span",null,"添加几何体模型")],-1),Pc={class:"options"},kc={class:"option"},Rc=l("span",null,"外部模型",-1),Vc={class:"file-name"},Fc=l("span",null,"当前模型:",-1),$c={class:"upload"},Uc={class:"icon"},Dc=l("div",null,[l("span",null,"请选择(目前仅支持.glb, .obj, .gltf, .fbx, .stl格式)")],-1),Hc={__name:"index",setup(n,{expose:e}){const o=we(),{$bus:i}=Ue().proxy,t=te(()=>$t.filter(v=>!v.animation)),a=te(()=>$t.filter(v=>v.animation)),s=ee(9),c=ee(!1),d=ee({name:"变形金刚（3）",fileType:"glb",id:9,animation:!1,filePath:"threeFile/glb/glb-9.glb",icon:Ne("model-icon/4.png"),decomposeName:"transformers_3",key:"transformers-3"}),p=ee(null),h=async v=>{if(v.id==s.value)return!1;c.value=!1,s.value=v.id,p.value=null,d.value=v,i.emit("page-loading",!0);try{const{load:b}=await o.modelApi.onSwitchModel(v);b&&(i.emit("model-update"),i.emit("page-loading",!1))}catch{i.emit("page-loading",!1)}},m=async()=>{c.value=!0,p.value=null,s.value=null,d.value={},o.modelApi.clearSceneModel()},S=(v,b)=>{o.modelApi.setDragGeometryModel(b),o.changeDragType("geometry")},M=v=>{v.preventDefault()},_=async v=>{p.value=v.name;const T={filePath:URL.createObjectURL(v.raw),fileType:Ht(v.name)};i.emit("page-loading",!0);try{const{load:C,filePath:I}=await o.modelApi.onSwitchModel(T);URL.revokeObjectURL(I),C&&(i.emit("model-update"),i.emit("page-loading",!1),s.value=null,c.value=!1,d.value={})}catch{p.value=null,i.emit("page-loading",!1)}};return e({activeModel:d}),(v,b)=>{const T=w("Orange"),C=w("el-icon"),I=w("el-space"),P=w("el-image"),g=w("el-col"),f=w("el-row"),E=w("el-scrollbar"),x=w("Paperclip"),y=w("SwitchFilled"),L=w("el-tooltip"),V=w("Plus"),A=w("UploadFilled"),G=w("el-upload");return H(),q("div",mc,[fc,l("div",gc,[l("div",_c,[r(I,null,{default:u(()=>[r(C,null,{default:u(()=>[r(T)]),_:1}),yc]),_:1})]),r(E,{"max-height":"210px"},{default:u(()=>[r(f,null,{default:u(()=>[(H(!0),q(me,null,ge(t.value,R=>(H(),ne(g,{style:{textAlign:"center"},span:12,key:R.id},{default:u(()=>[r(P,{draggable:"false",onClick:it(U=>h(R),["prevent"]),class:X(["el-img",s.value==R.id?"active-model":""]),src:R.icon,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1})]),_:1})]),l("div",vc,[l("div",wc,[r(I,null,{default:u(()=>[r(C,null,{default:u(()=>[r(x)]),_:1}),xc]),_:1})]),r(E,{"max-height":"210px"},{default:u(()=>[r(f,null,{default:u(()=>[(H(!0),q(me,null,ge(a.value,R=>(H(),ne(g,{style:{textAlign:"center"},span:12,key:R.id},{default:u(()=>[r(P,{draggable:"false",onClick:U=>h(R),class:X(["el-img",s.value==R.id?"active-model":""]),src:R.icon,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1})]),_:1})]),l("div",bc,[l("div",Mc,[r(I,null,{default:u(()=>[r(C,null,{default:u(()=>[r(y)]),_:1}),Sc,c.value?(H(),q("span",Cc,"(可拖拽添加多个)")):ye("",!0)]),_:1})]),r(E,{"max-height":"120px"},{default:u(()=>[c.value?(H(),ne(f,{key:0},{default:u(()=>[(H(!0),q(me,null,ge(re(Zn),R=>(H(),ne(g,{style:{textAlign:"center"},span:8,key:R.type},{default:u(()=>[l("div",{class:X(["geometry",s.value==R.id?"active-model":""]),draggable:"true",onDragstart:U=>S(U,R),onDrag:b[0]||(b[0]=U=>M(U))},[l("div",Tc,[r(L,{effect:"dark",content:`${R.name}:${R.type}`,placement:"top"},{default:u(()=>[l("b",null,xe(R.name),1)]),_:2},1032,["content"])])],42,Lc)]),_:2},1024))),128))]),_:1})):(H(),q("div",Ec,[l("div",{class:"geometry-add",onClick:m},[l("div",Ac,[r(C,{size:44},{default:u(()=>[r(V)]),_:1}),Ic])])]))]),_:1})]),l("div",Pc,[l("div",kc,[r(I,null,{default:u(()=>[r(C,null,{default:u(()=>[r(A)]),_:1}),Rc]),_:1})]),l("div",Vc,[Fc,r(L,{effect:"dark",content:p.value,placement:"top"},{default:u(()=>[l("b",null,xe(p.value),1)]),_:1},8,["content"])]),r(G,{action:"",accept:".glb,.obj,.gltf,.fbx,.stl",class:"file-box","show-file-list":!1,"auto-upload":!1,"on-change":_},{default:u(()=>[l("div",$c,[l("div",Uc,[r(C,{size:44},{default:u(()=>[r(V)]),_:1}),Dc])])]),_:1})])])}}};var An={exports:{}};/*!
* clipboard.js v2.0.11
* https://clipboardjs.com/
*
* Licensed MIT © Zeno Rocha
*/(function(n,e){(function(i,t){n.exports=t()})($n,function(){return function(){var o={686:function(a,s,c){c.d(s,{default:function(){return $}});var d=c(279),p=c.n(d),h=c(370),m=c.n(h),S=c(817),M=c.n(S);function _(B){try{return document.execCommand(B)}catch{return!1}}var v=function(k){var O=M()(k);return _("cut"),O},b=v;function T(B){var k=document.documentElement.getAttribute("dir")==="rtl",O=document.createElement("textarea");O.style.fontSize="12pt",O.style.border="0",O.style.padding="0",O.style.margin="0",O.style.position="absolute",O.style[k?"right":"left"]="-9999px";var W=window.pageYOffset||document.documentElement.scrollTop;return O.style.top="".concat(W,"px"),O.setAttribute("readonly",""),O.value=B,O}var C=function(k,O){var W=T(k);O.container.appendChild(W);var Z=M()(W);return _("copy"),W.remove(),Z},I=function(k){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},W="";return typeof k=="string"?W=C(k,O):k instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(k==null?void 0:k.type)?W=C(k.value,O):(W=M()(k),_("copy")),W},P=I;function g(B){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?g=function(O){return typeof O}:g=function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},g(B)}var f=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},O=k.action,W=O===void 0?"copy":O,Z=k.container,z=k.target,ue=k.text;if(W!=="copy"&&W!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(z!==void 0)if(z&&g(z)==="object"&&z.nodeType===1){if(W==="copy"&&z.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(W==="cut"&&(z.hasAttribute("readonly")||z.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(ue)return P(ue,{container:Z});if(z)return W==="cut"?b(z):P(z,{container:Z})},E=f;function x(B){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?x=function(O){return typeof O}:x=function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},x(B)}function y(B,k){if(!(B instanceof k))throw new TypeError("Cannot call a class as a function")}function L(B,k){for(var O=0;O<k.length;O++){var W=k[O];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(B,W.key,W)}}function V(B,k,O){return k&&L(B.prototype,k),O&&L(B,O),B}function A(B,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");B.prototype=Object.create(k&&k.prototype,{constructor:{value:B,writable:!0,configurable:!0}}),k&&G(B,k)}function G(B,k){return G=Object.setPrototypeOf||function(W,Z){return W.__proto__=Z,W},G(B,k)}function R(B){var k=Y();return function(){var W=j(B),Z;if(k){var z=j(this).constructor;Z=Reflect.construct(W,arguments,z)}else Z=W.apply(this,arguments);return U(this,Z)}}function U(B,k){return k&&(x(k)==="object"||typeof k=="function")?k:D(B)}function D(B){if(B===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}function Y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function j(B){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)},j(B)}function J(B,k){var O="data-clipboard-".concat(B);if(k.hasAttribute(O))return k.getAttribute(O)}var ie=function(B){A(O,B);var k=R(O);function O(W,Z){var z;return y(this,O),z=k.call(this),z.resolveOptions(Z),z.listenClick(W),z}return V(O,[{key:"resolveOptions",value:function(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof Z.action=="function"?Z.action:this.defaultAction,this.target=typeof Z.target=="function"?Z.target:this.defaultTarget,this.text=typeof Z.text=="function"?Z.text:this.defaultText,this.container=x(Z.container)==="object"?Z.container:document.body}},{key:"listenClick",value:function(Z){var z=this;this.listener=m()(Z,"click",function(ue){return z.onClick(ue)})}},{key:"onClick",value:function(Z){var z=Z.delegateTarget||Z.currentTarget,ue=this.action(z)||"copy",ct=E({action:ue,container:this.container,target:this.target(z),text:this.text(z)});this.emit(ct?"success":"error",{action:ue,text:ct,trigger:z,clearSelection:function(){z&&z.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(Z){return J("action",Z)}},{key:"defaultTarget",value:function(Z){var z=J("target",Z);if(z)return document.querySelector(z)}},{key:"defaultText",value:function(Z){return J("text",Z)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(Z){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return P(Z,z)}},{key:"cut",value:function(Z){return b(Z)}},{key:"isSupported",value:function(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],z=typeof Z=="string"?[Z]:Z,ue=!!document.queryCommandSupported;return z.forEach(function(ct){ue=ue&&!!document.queryCommandSupported(ct)}),ue}}]),O}(p()),$=ie},828:function(a){var s=9;if(typeof Element<"u"&&!Element.prototype.matches){var c=Element.prototype;c.matches=c.matchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector||c.webkitMatchesSelector}function d(p,h){for(;p&&p.nodeType!==s;){if(typeof p.matches=="function"&&p.matches(h))return p;p=p.parentNode}}a.exports=d},438:function(a,s,c){var d=c(828);function p(S,M,_,v,b){var T=m.apply(this,arguments);return S.addEventListener(_,T,b),{destroy:function(){S.removeEventListener(_,T,b)}}}function h(S,M,_,v,b){return typeof S.addEventListener=="function"?p.apply(null,arguments):typeof _=="function"?p.bind(null,document).apply(null,arguments):(typeof S=="string"&&(S=document.querySelectorAll(S)),Array.prototype.map.call(S,function(T){return p(T,M,_,v,b)}))}function m(S,M,_,v){return function(b){b.delegateTarget=d(b.target,M),b.delegateTarget&&v.call(S,b)}}a.exports=h},879:function(a,s){s.node=function(c){return c!==void 0&&c instanceof HTMLElement&&c.nodeType===1},s.nodeList=function(c){var d=Object.prototype.toString.call(c);return c!==void 0&&(d==="[object NodeList]"||d==="[object HTMLCollection]")&&"length"in c&&(c.length===0||s.node(c[0]))},s.string=function(c){return typeof c=="string"||c instanceof String},s.fn=function(c){var d=Object.prototype.toString.call(c);return d==="[object Function]"}},370:function(a,s,c){var d=c(879),p=c(438);function h(_,v,b){if(!_&&!v&&!b)throw new Error("Missing required arguments");if(!d.string(v))throw new TypeError("Second argument must be a String");if(!d.fn(b))throw new TypeError("Third argument must be a Function");if(d.node(_))return m(_,v,b);if(d.nodeList(_))return S(_,v,b);if(d.string(_))return M(_,v,b);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function m(_,v,b){return _.addEventListener(v,b),{destroy:function(){_.removeEventListener(v,b)}}}function S(_,v,b){return Array.prototype.forEach.call(_,function(T){T.addEventListener(v,b)}),{destroy:function(){Array.prototype.forEach.call(_,function(T){T.removeEventListener(v,b)})}}}function M(_,v,b){return p(document.body,_,v,b)}a.exports=h},817:function(a){function s(c){var d;if(c.nodeName==="SELECT")c.focus(),d=c.value;else if(c.nodeName==="INPUT"||c.nodeName==="TEXTAREA"){var p=c.hasAttribute("readonly");p||c.setAttribute("readonly",""),c.select(),c.setSelectionRange(0,c.value.length),p||c.removeAttribute("readonly"),d=c.value}else{c.hasAttribute("contenteditable")&&c.focus();var h=window.getSelection(),m=document.createRange();m.selectNodeContents(c),h.removeAllRanges(),h.addRange(m),d=h.toString()}return d}a.exports=s},279:function(a){function s(){}s.prototype={on:function(c,d,p){var h=this.e||(this.e={});return(h[c]||(h[c]=[])).push({fn:d,ctx:p}),this},once:function(c,d,p){var h=this;function m(){h.off(c,m),d.apply(p,arguments)}return m._=d,this.on(c,m,p)},emit:function(c){var d=[].slice.call(arguments,1),p=((this.e||(this.e={}))[c]||[]).slice(),h=0,m=p.length;for(h;h<m;h++)p[h].fn.apply(p[h].ctx,d);return this},off:function(c,d){var p=this.e||(this.e={}),h=p[c],m=[];if(h&&d)for(var S=0,M=h.length;S<M;S++)h[S].fn!==d&&h[S].fn._!==d&&m.push(h[S]);return m.length?p[c]=m:delete p[c],this}},a.exports=s,a.exports.TinyEmitter=s}},i={};function t(a){if(i[a])return i[a].exports;var s=i[a]={exports:{}};return o[a](s,s.exports,t),s.exports}return function(){t.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return t.d(s,{a:s}),s}}(),function(){t.d=function(a,s){for(var c in s)t.o(s,c)&&!t.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:s[c]})}}(),function(){t.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)}}(),t(686)}().default})})(An);var Oc=An.exports;const zc=Un(Oc),Nc={class:"code"},Gc={class:"dialog-footer"},Bc={__name:"index",setup(n,{expose:e}){const o=ee(!1),i=ee(null),t=_e({width:400,height:300}),a=te(()=>{const d=i.value.replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,"'$1'"),p=`${Qn}?modelConfig=`+d;return`<iframe  width="${t.width}" height="${t.height}" src="${p}" allowfullscreen></iframe>`}),s=d=>{o.value=!0,i.value=JSON.stringify(d)},c=()=>{const d=new zc(".copy-button",{text:()=>a.value});d.on("success",p=>{ce.success("复制成功,将代码粘贴至你的项目中即可"),d.destroy(),o.value=!1}),d.on("error",()=>{console.log("复制失败"),d.destroy()})};return e({showDialog:s}),(d,p)=>{const h=w("el-scrollbar"),m=w("el-text"),S=w("el-input-number"),M=w("el-col"),_=w("el-row"),v=w("el-button"),b=w("el-dialog");return H(),ne(b,{modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=T=>o.value=T),title:"将当前编辑效果嵌入你的项目",width:"600px","close-on-click-modal":!1},{footer:u(()=>[l("span",Gc,[r(v,{type:"primary",class:"copy-button",onClick:c},{default:u(()=>[F(" 复制代码 ")]),_:1})])]),default:u(()=>[r(h,{"max-height":"400px"},{default:u(()=>[l("code",Nc,xe(a.value),1)]),_:1}),r(_,{style:{marginTop:"10px"}},{default:u(()=>[r(M,{span:12},{default:u(()=>[r(m,{type:"primary"},{default:u(()=>[F("容器宽度")]),_:1}),r(S,{class:"number-style",precision:0,modelValue:t.width,"onUpdate:modelValue":p[0]||(p[0]=T=>t.width=T)},null,8,["modelValue"])]),_:1}),r(M,{span:12},{default:u(()=>[r(m,{type:"primary"},{default:u(()=>[F("容器高度")]),_:1}),r(S,{class:"number-style",precision:0,modelValue:t.height,"onUpdate:modelValue":p[1]||(p[1]=T=>t.height=T)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},jc=Le(Bc,[["__scopeId","data-v-5000b3b9"]]);let Qe,It,Oe,ft;function Pt(n,e=1/0,o=null){It||(It=new bt(2,2,1,1)),Oe||(Oe=new vn({uniforms:{blitTexture:new qn(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Oe.uniforms.blitTexture.value=n,Oe.defines.IS_SRGB=n.colorSpace==at,Oe.needsUpdate=!0,ft||(ft=new N(It,Oe),ft.frustumCulled=!1);const i=new wn,t=new Ge;t.add(ft),o===null&&(o=Qe=new xn({antialias:!1}));const a=Math.min(n.image.width,e),s=Math.min(n.image.height,e);o.setSize(a,s),o.clear(),o.render(t,i);const c=document.createElement("canvas"),d=c.getContext("2d");c.width=a,c.height=s,d.drawImage(o.domElement,0,0,a,s);const p=new Kn(c);return p.minFilter=n.minFilter,p.magFilter=n.magFilter,p.wrapS=n.wrapS,p.wrapT=n.wrapT,p.name=n.name,Qe&&(Qe.forceContextLoss(),Qe.dispose(),Qe=null),p}const en={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Bt{constructor(){this.pluginCallbacks=[],this.register(function(e){return new td(e)}),this.register(function(e){return new nd(e)}),this.register(function(e){return new ad(e)}),this.register(function(e){return new rd(e)}),this.register(function(e){return new ld(e)}),this.register(function(e){return new cd(e)}),this.register(function(e){return new od(e)}),this.register(function(e){return new sd(e)}),this.register(function(e){return new id(e)}),this.register(function(e){return new dd(e)}),this.register(function(e){return new ud(e)}),this.register(function(e){return new pd(e)}),this.register(function(e){return new hd(e)}),this.register(function(e){return new md(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,o,i,t){const a=new ed,s=[];for(let c=0,d=this.pluginCallbacks.length;c<d;c++)s.push(this.pluginCallbacks[c](a));a.setPlugins(s),a.write(e,o,t).catch(i)}parseAsync(e,o){const i=this;return new Promise(function(t,a){i.parse(e,t,a,o)})}}const K={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},kt="KHR_mesh_quantization",ve={};ve[oo]=K.NEAREST;ve[so]=K.NEAREST_MIPMAP_NEAREST;ve[io]=K.NEAREST_MIPMAP_LINEAR;ve[Se]=K.LINEAR;ve[ao]=K.LINEAR_MIPMAP_NEAREST;ve[ro]=K.LINEAR_MIPMAP_LINEAR;ve[lo]=K.CLAMP_TO_EDGE;ve[co]=K.REPEAT;ve[st]=K.MIRRORED_REPEAT;const tn={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Yc=new he,nn=12,Xc=1179937895,Wc=2,on=8,Zc=1313821514,Qc=5130562;function Je(n,e){return n.length===e.length&&n.every(function(o,i){return o===e[i]})}function qc(n){return new TextEncoder().encode(n).buffer}function Kc(n){return Je(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Jc(n,e,o){const i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let t=e;t<e+o;t++)for(let a=0;a<n.itemSize;a++){let s;n.itemSize>4?s=n.array[t*n.itemSize+a]:(a===0?s=n.getX(t):a===1?s=n.getY(t):a===2?s=n.getZ(t):a===3&&(s=n.getW(t)),n.normalized===!0&&(s=Ut.normalize(s,n.array))),i.min[a]=Math.min(i.min[a],s),i.max[a]=Math.max(i.max[a],s)}return i}function In(n){return Math.ceil(n/4)*4}function Rt(n,e=0){const o=In(n.byteLength);if(o!==n.byteLength){const i=new Uint8Array(o);if(i.set(new Uint8Array(n)),e!==0)for(let t=n.byteLength;t<o;t++)i[t]=e;return i.buffer}return n}function sn(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function an(n,e){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,e));let o;return e==="image/jpeg"?o=.92:e==="image/webp"&&(o=.8),n.convertToBlob({type:e,quality:o})}class ed{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+bn}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,o,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const t=this,a=t.buffers,s=t.json;i=t.options;const c=t.extensionsUsed,d=t.extensionsRequired,p=new Blob(a,{type:"application/octet-stream"}),h=Object.keys(c),m=Object.keys(d);if(h.length>0&&(s.extensionsUsed=h),m.length>0&&(s.extensionsRequired=m),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=p.size),i.binary===!0){const S=new FileReader;S.readAsArrayBuffer(p),S.onloadend=function(){const M=Rt(S.result),_=new DataView(new ArrayBuffer(on));_.setUint32(0,M.byteLength,!0),_.setUint32(4,Qc,!0);const v=Rt(qc(JSON.stringify(s)),32),b=new DataView(new ArrayBuffer(on));b.setUint32(0,v.byteLength,!0),b.setUint32(4,Zc,!0);const T=new ArrayBuffer(nn),C=new DataView(T);C.setUint32(0,Xc,!0),C.setUint32(4,Wc,!0);const I=nn+b.byteLength+v.byteLength+_.byteLength+M.byteLength;C.setUint32(8,I,!0);const P=new Blob([T,b,v,_,M],{type:"application/octet-stream"}),g=new FileReader;g.readAsArrayBuffer(P),g.onloadend=function(){o(g.result)}}}else if(s.buffers&&s.buffers.length>0){const S=new FileReader;S.readAsDataURL(p),S.onloadend=function(){const M=S.result;s.buffers[0].uri=M,o(s)}}else o(s)}serializeUserData(e,o){if(Object.keys(e.userData).length===0)return;const i=this.options,t=this.extensionsUsed;try{const a=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&a.gltfExtensions){o.extensions===void 0&&(o.extensions={});for(const s in a.gltfExtensions)o.extensions[s]=a.gltfExtensions[s],t[s]=!0;delete a.gltfExtensions}Object.keys(a).length>0&&(o.extras=a)}catch(a){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+a.message)}}getUID(e,o=!1){if(this.uids.has(e)===!1){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(o)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new Q;for(let t=0,a=e.count;t<a;t++)if(Math.abs(i.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const o=this.cache;if(o.attributesNormalized.has(e))return o.attributesNormalized.get(e);const i=e.clone(),t=new Q;for(let a=0,s=i.count;a<s;a++)t.fromBufferAttribute(i,a),t.x===0&&t.y===0&&t.z===0?t.setX(1):t.normalize(),i.setXYZ(a,t.x,t.y,t.z);return o.attributesNormalized.set(e,i),i}applyTextureTransform(e,o){let i=!1;const t={};(o.offset.x!==0||o.offset.y!==0)&&(t.offset=o.offset.toArray(),i=!0),o.rotation!==0&&(t.rotation=o.rotation,i=!0),(o.repeat.x!==1||o.repeat.y!==1)&&(t.scale=o.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=t,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,o){if(e===o)return e;function i(M){return M.colorSpace===at?function(v){return v<.04045?v*.0773993808:Math.pow(v*.9478672986+.0521327014,2.4)}:function(v){return v}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Ct&&(e=Pt(e)),o instanceof Ct&&(o=Pt(o));const t=e?e.image:null,a=o?o.image:null,s=Math.max(t?t.width:0,a?a.width:0),c=Math.max(t?t.height:0,a?a.height:0),d=sn();d.width=s,d.height=c;const p=d.getContext("2d",{willReadFrequently:!0});p.fillStyle="#00ffff",p.fillRect(0,0,s,c);const h=p.getImageData(0,0,s,c);if(t){p.drawImage(t,0,0,s,c);const M=i(e),_=p.getImageData(0,0,s,c).data;for(let v=2;v<_.length;v+=4)h.data[v]=M(_[v]/256)*256}if(a){p.drawImage(a,0,0,s,c);const M=i(o),_=p.getImageData(0,0,s,c).data;for(let v=1;v<_.length;v+=4)h.data[v]=M(_[v]/256)*256}p.putImageData(h,0,0);const S=(e||o).clone();return S.source=new Jn(d),S.colorSpace=eo,S.channel=(e||o).channel,e&&o&&e.channel!==o.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),S}processBuffer(e){const o=this.json,i=this.buffers;return o.buffers||(o.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,o,i,t,a){const s=this.json;s.bufferViews||(s.bufferViews=[]);let c;switch(o){case K.BYTE:case K.UNSIGNED_BYTE:c=1;break;case K.SHORT:case K.UNSIGNED_SHORT:c=2;break;default:c=4}let d=e.itemSize*c;a===K.ARRAY_BUFFER&&(d=Math.ceil(d/4)*4);const p=In(t*d),h=new DataView(new ArrayBuffer(p));let m=0;for(let _=i;_<i+t;_++){for(let v=0;v<e.itemSize;v++){let b;e.itemSize>4?b=e.array[_*e.itemSize+v]:(v===0?b=e.getX(_):v===1?b=e.getY(_):v===2?b=e.getZ(_):v===3&&(b=e.getW(_)),e.normalized===!0&&(b=Ut.normalize(b,e.array))),o===K.FLOAT?h.setFloat32(m,b,!0):o===K.INT?h.setInt32(m,b,!0):o===K.UNSIGNED_INT?h.setUint32(m,b,!0):o===K.SHORT?h.setInt16(m,b,!0):o===K.UNSIGNED_SHORT?h.setUint16(m,b,!0):o===K.BYTE?h.setInt8(m,b):o===K.UNSIGNED_BYTE&&h.setUint8(m,b),m+=c}m%d!==0&&(m+=d-m%d)}const S={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:p};return a!==void 0&&(S.target=a),a===K.ARRAY_BUFFER&&(S.byteStride=d),this.byteOffset+=p,s.bufferViews.push(S),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const o=this,i=o.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(t){const a=new FileReader;a.readAsArrayBuffer(e),a.onloadend=function(){const s=Rt(a.result),c={buffer:o.processBuffer(s),byteOffset:o.byteOffset,byteLength:s.byteLength};o.byteOffset+=s.byteLength,t(i.bufferViews.push(c)-1)}})}processAccessor(e,o,i,t){const a=this.json,s={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let c;if(e.array.constructor===Float32Array)c=K.FLOAT;else if(e.array.constructor===Int32Array)c=K.INT;else if(e.array.constructor===Uint32Array)c=K.UNSIGNED_INT;else if(e.array.constructor===Int16Array)c=K.SHORT;else if(e.array.constructor===Uint16Array)c=K.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)c=K.BYTE;else if(e.array.constructor===Uint8Array)c=K.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),(t===void 0||t===1/0)&&(t=e.count),t===0)return null;const d=Jc(e,i,t);let p;o!==void 0&&(p=e===o.index?K.ELEMENT_ARRAY_BUFFER:K.ARRAY_BUFFER);const h=this.processBufferView(e,c,i,t,p),m={bufferView:h.id,byteOffset:h.byteOffset,componentType:c,count:t,max:d.max,min:d.min,type:s[e.itemSize]};return e.normalized===!0&&(m.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(m)-1}processImage(e,o,i,t="image/png"){if(e!==null){const a=this,s=a.cache,c=a.json,d=a.options,p=a.pending;s.images.has(e)||s.images.set(e,{});const h=s.images.get(e),m=t+":flipY/"+i.toString();if(h[m]!==void 0)return h[m];c.images||(c.images=[]);const S={mimeType:t},M=sn();M.width=Math.min(e.width,d.maxTextureSize),M.height=Math.min(e.height,d.maxTextureSize);const _=M.getContext("2d",{willReadFrequently:!0});if(i===!0&&(_.translate(0,M.height),_.scale(1,-1)),e.data!==void 0){o!==Mn&&console.error("GLTFExporter: Only RGBAFormat is supported.",o),(e.width>d.maxTextureSize||e.height>d.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const b=new Uint8ClampedArray(e.height*e.width*4);for(let T=0;T<b.length;T+=4)b[T+0]=e.data[T+0],b[T+1]=e.data[T+1],b[T+2]=e.data[T+2],b[T+3]=e.data[T+3];_.putImageData(new ImageData(b,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)_.drawImage(e,0,0,M.width,M.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");d.binary===!0?p.push(an(M,t).then(b=>a.processBufferViewImage(b)).then(b=>{S.bufferView=b})):M.toDataURL!==void 0?S.uri=M.toDataURL(t):p.push(an(M,t).then(b=>new FileReader().readAsDataURL(b)).then(b=>{S.uri=b}));const v=c.images.push(S)-1;return h[m]=v,v}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const o=this.json;o.samplers||(o.samplers=[]);const i={magFilter:ve[e.magFilter],minFilter:ve[e.minFilter],wrapS:ve[e.wrapS],wrapT:ve[e.wrapT]};return o.samplers.push(i)-1}processTexture(e){const i=this.options,t=this.cache,a=this.json;if(t.textures.has(e))return t.textures.get(e);a.textures||(a.textures=[]),e instanceof Ct&&(e=Pt(e,i.maxTextureSize));let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const c={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(c.name=e.name),this._invokeAll(function(p){p.writeTexture&&p.writeTexture(e,c)});const d=a.textures.push(c)-1;return t.textures.set(e,d),d}processMaterial(e){const o=this.cache,i=this.json;if(o.materials.has(e))return o.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const t={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const a=e.color.toArray().concat([e.opacity]);if(Je(a,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=a),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const c=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),d={index:this.processTexture(c),channel:c.channel};this.applyTextureTransform(d,c),t.pbrMetallicRoughness.metallicRoughnessTexture=d}if(e.map){const c={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(c,e.map),t.pbrMetallicRoughness.baseColorTexture=c}if(e.emissive){const c=e.emissive;if(Math.max(c.r,c.g,c.b)>0&&(t.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const p={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(p,e.emissiveMap),t.emissiveTexture=p}}if(e.normalMap){const c={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(c.scale=e.normalScale.x),this.applyTextureTransform(c,e.normalMap),t.normalTexture=c}if(e.aoMap){const c={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(c.strength=e.aoMapIntensity),this.applyTextureTransform(c,e.aoMap),t.occlusionTexture=c}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===rt&&(t.doubleSided=!0),e.name!==""&&(t.name=e.name),this.serializeUserData(e,t),this._invokeAll(function(c){c.writeMaterial&&c.writeMaterial(e,t)});const s=i.materials.push(t)-1;return o.materials.set(e,s),s}processMesh(e){const o=this.cache,i=this.json,t=[e.geometry.uuid];if(Array.isArray(e.material))for(let P=0,g=e.material.length;P<g;P++)t.push(e.material[P].uuid);else t.push(e.material.uuid);const a=t.join(":");if(o.meshes.has(a))return o.meshes.get(a);const s=e.geometry;let c;e.isLineSegments?c=K.LINES:e.isLineLoop?c=K.LINE_LOOP:e.isLine?c=K.LINE_STRIP:e.isPoints?c=K.POINTS:c=e.material.wireframe?K.LINES:K.TRIANGLES;const d={},p={},h=[],m=[],S={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},M=s.getAttribute("normal");M!==void 0&&!this.isNormalizedNormalAttribute(M)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(M)));let _=null;for(let P in s.attributes){if(P.slice(0,5)==="morph")continue;const g=s.attributes[P];if(P=S[P]||P.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(P)||(P="_"+P),o.attributes.has(this.getUID(g))){p[P]=o.attributes.get(this.getUID(g));continue}_=null;const E=g.array;P==="JOINTS_0"&&!(E instanceof Uint16Array)&&!(E instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),_=new Ve(new Uint16Array(E),g.itemSize,g.normalized));const x=this.processAccessor(_||g,s);x!==null&&(P.startsWith("_")||this.detectMeshQuantization(P,g),p[P]=x,o.attributes.set(this.getUID(g),x))}if(M!==void 0&&s.setAttribute("normal",M),Object.keys(p).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const P=[],g=[],f={};if(e.morphTargetDictionary!==void 0)for(const E in e.morphTargetDictionary)f[e.morphTargetDictionary[E]]=E;for(let E=0;E<e.morphTargetInfluences.length;++E){const x={};let y=!1;for(const L in s.morphAttributes){if(L!=="position"&&L!=="normal"){y||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),y=!0);continue}const V=s.morphAttributes[L][E],A=L.toUpperCase(),G=s.attributes[L];if(o.attributes.has(this.getUID(V,!0))){x[A]=o.attributes.get(this.getUID(V,!0));continue}const R=V.clone();if(!s.morphTargetsRelative)for(let U=0,D=V.count;U<D;U++)for(let Y=0;Y<V.itemSize;Y++)Y===0&&R.setX(U,V.getX(U)-G.getX(U)),Y===1&&R.setY(U,V.getY(U)-G.getY(U)),Y===2&&R.setZ(U,V.getZ(U)-G.getZ(U)),Y===3&&R.setW(U,V.getW(U)-G.getW(U));x[A]=this.processAccessor(R,s),o.attributes.set(this.getUID(G,!0),x[A])}m.push(x),P.push(e.morphTargetInfluences[E]),e.morphTargetDictionary!==void 0&&g.push(f[E])}d.weights=P,g.length>0&&(d.extras={},d.extras.targetNames=g)}const v=Array.isArray(e.material);if(v&&s.groups.length===0)return null;let b=!1;if(v&&s.index===null){const P=[];for(let g=0,f=s.attributes.position.count;g<f;g++)P[g]=g;s.setIndex(P),b=!0}const T=v?e.material:[e.material],C=v?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let P=0,g=C.length;P<g;P++){const f={mode:c,attributes:p};if(this.serializeUserData(s,f),m.length>0&&(f.targets=m),s.index!==null){let x=this.getUID(s.index);(C[P].start!==void 0||C[P].count!==void 0)&&(x+=":"+C[P].start+":"+C[P].count),o.attributes.has(x)?f.indices=o.attributes.get(x):(f.indices=this.processAccessor(s.index,s,C[P].start,C[P].count),o.attributes.set(x,f.indices)),f.indices===null&&delete f.indices}const E=this.processMaterial(T[C[P].materialIndex]);E!==null&&(f.material=E),h.push(f)}b===!0&&s.setIndex(null),d.primitives=h,i.meshes||(i.meshes=[]),this._invokeAll(function(P){P.writeMesh&&P.writeMesh(e,d)});const I=i.meshes.push(d)-1;return o.meshes.set(a,I),I}detectMeshQuantization(e,o){if(this.extensionsUsed[kt])return;let i;switch(o.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}o.normalized&&(i+=" normalized");const t=e.split("_",1)[0];en[t]&&en[t].includes(i)&&(this.extensionsUsed[kt]=!0,this.extensionsRequired[kt]=!0)}processCamera(e){const o=this.json;o.cameras||(o.cameras=[]);const i=e.isOrthographicCamera,t={type:i?"orthographic":"perspective"};return i?t.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:t.perspective={aspectRatio:e.aspect,yfov:Ut.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(t.name=e.type),o.cameras.push(t)-1}processAnimation(e,o){const i=this.json,t=this.nodeMap;i.animations||(i.animations=[]),e=Bt.Utils.mergeMorphTargetTracks(e.clone(),o);const a=e.tracks,s=[],c=[];for(let d=0;d<a.length;++d){const p=a[d],h=xt.parseTrackName(p.name);let m=xt.findNode(o,h.nodeName);const S=tn[h.propertyName];if(h.objectName==="bones"&&(m.isSkinnedMesh===!0?m=m.skeleton.getBoneByName(h.objectIndex):m=void 0),!m||!S){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',p.name);continue}const M=1;let _=p.values.length/p.times.length;S===tn.morphTargetInfluences&&(_/=m.morphTargetInfluences.length);let v;p.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(v="CUBICSPLINE",_/=3):p.getInterpolation()===to?v="STEP":v="LINEAR",c.push({input:this.processAccessor(new Ve(p.times,M)),output:this.processAccessor(new Ve(p.values,_)),interpolation:v}),s.push({sampler:c.length-1,target:{node:t.get(m),path:S}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:c,channels:s}),i.animations.length-1}processSkin(e){const o=this.json,i=this.nodeMap,t=o.nodes[i.get(e)],a=e.skeleton;if(a===void 0)return null;const s=e.skeleton.bones[0];if(s===void 0)return null;const c=[],d=new Float32Array(a.bones.length*16),p=new Mt;for(let m=0;m<a.bones.length;++m)c.push(i.get(a.bones[m])),p.copy(a.boneInverses[m]),p.multiply(e.bindMatrix).toArray(d,m*16);return o.skins===void 0&&(o.skins=[]),o.skins.push({inverseBindMatrices:this.processAccessor(new Ve(d,16)),joints:c,skeleton:i.get(s)}),t.skin=o.skins.length-1}processNode(e){const o=this.json,i=this.options,t=this.nodeMap;o.nodes||(o.nodes=[]);const a={};if(i.trs){const c=e.quaternion.toArray(),d=e.position.toArray(),p=e.scale.toArray();Je(c,[0,0,0,1])||(a.rotation=c),Je(d,[0,0,0])||(a.translation=d),Je(p,[1,1,1])||(a.scale=p)}else e.matrixAutoUpdate&&e.updateMatrix(),Kc(e.matrix)===!1&&(a.matrix=e.matrix.elements);if(e.name!==""&&(a.name=String(e.name)),this.serializeUserData(e,a),e.isMesh||e.isLine||e.isPoints){const c=this.processMesh(e);c!==null&&(a.mesh=c)}else e.isCamera&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const c=[];for(let d=0,p=e.children.length;d<p;d++){const h=e.children[d];if(h.visible||i.onlyVisible===!1){const m=this.processNode(h);m!==null&&c.push(m)}}c.length>0&&(a.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,a)});const s=o.nodes.push(a)-1;return t.set(e,s),s}processScene(e){const o=this.json,i=this.options;o.scenes||(o.scenes=[],o.scene=0);const t={};e.name!==""&&(t.name=e.name),o.scenes.push(t);const a=[];for(let s=0,c=e.children.length;s<c;s++){const d=e.children[s];if(d.visible||i.onlyVisible===!1){const p=this.processNode(d);p!==null&&a.push(p)}}a.length>0&&(t.nodes=a),this.serializeUserData(e,t)}processObjects(e){const o=new Ge;o.name="AuxScene";for(let i=0;i<e.length;i++)o.children.push(e[i]);this.processScene(o)}processInput(e){const o=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});const i=[];for(let t=0;t<e.length;t++)e[t]instanceof Ge?this.processScene(e[t]):i.push(e[t]);i.length>0&&this.processObjects(i);for(let t=0;t<this.skins.length;++t)this.processSkin(this.skins[t]);for(let t=0;t<o.animations.length;++t)this.processAnimation(o.animations[t],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let o=0,i=this.plugins.length;o<i;o++)e(this.plugins[o])}}class td{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,o){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,t=i.json,a=i.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(1-e.penumbra)*e.angle,s.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),a[this.name]||(t.extensions=t.extensions||{},t.extensions[this.name]={lights:[]},a[this.name]=!0);const c=t.extensions[this.name].lights;c.push(s),o.extensions=o.extensions||{},o.extensions[this.name]={light:c.length-1}}}class nd{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,o){if(!e.isMeshBasicMaterial)return;const t=this.writer.extensionsUsed;o.extensions=o.extensions||{},o.extensions[this.name]={},t[this.name]=!0,o.pbrMetallicRoughness.metallicFactor=0,o.pbrMetallicRoughness.roughnessFactor=.9}}class od{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,t=i.extensionsUsed,a={};if(a.clearcoatFactor=e.clearcoat,e.clearcoatMap){const s={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(s,e.clearcoatMap),a.clearcoatTexture=s}if(a.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const s={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(s,e.clearcoatRoughnessMap),a.clearcoatRoughnessTexture=s}if(e.clearcoatNormalMap){const s={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(s.scale=e.clearcoatNormalScale.x),i.applyTextureTransform(s,e.clearcoatNormalMap),a.clearcoatNormalTexture=s}o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class sd{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const t=this.writer.extensionsUsed,a={};a.dispersion=e.dispersion,o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class id{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,t=i.extensionsUsed,a={};if(a.iridescenceFactor=e.iridescence,e.iridescenceMap){const s={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(s,e.iridescenceMap),a.iridescenceTexture=s}if(a.iridescenceIor=e.iridescenceIOR,a.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],a.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const s={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(s,e.iridescenceThicknessMap),a.iridescenceThicknessTexture=s}o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class ad{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,t=i.extensionsUsed,a={};if(a.transmissionFactor=e.transmission,e.transmissionMap){const s={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(s,e.transmissionMap),a.transmissionTexture=s}o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class rd{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,t=i.extensionsUsed,a={};if(a.thicknessFactor=e.thickness,e.thicknessMap){const s={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(s,e.thicknessMap),a.thicknessTexture=s}a.attenuationDistance=e.attenuationDistance,a.attenuationColor=e.attenuationColor.toArray(),o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class ld{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const t=this.writer.extensionsUsed,a={};a.ior=e.ior,o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class cd{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(Yc)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,t=i.extensionsUsed,a={};if(e.specularIntensityMap){const s={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(s,e.specularIntensityMap),a.specularTexture=s}if(e.specularColorMap){const s={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(s,e.specularColorMap),a.specularColorTexture=s}a.specularFactor=e.specularIntensity,a.specularColorFactor=e.specularColor.toArray(),o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class dd{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,t=i.extensionsUsed,a={};if(e.sheenRoughnessMap){const s={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(s,e.sheenRoughnessMap),a.sheenRoughnessTexture=s}if(e.sheenColorMap){const s={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(s,e.sheenColorMap),a.sheenColorTexture=s}a.sheenRoughnessFactor=e.sheenRoughness,a.sheenColorFactor=e.sheenColor.toArray(),o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class ud{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,o){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,t=i.extensionsUsed,a={};if(e.anisotropyMap){const s={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(s,e.anisotropyMap),a.anisotropyTexture=s}a.anisotropyStrength=e.anisotropy,a.anisotropyRotation=e.anisotropyRotation,o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class pd{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,o){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const t=this.writer.extensionsUsed,a={};a.emissiveStrength=e.emissiveIntensity,o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class hd{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,o){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const i=this.writer,t=i.extensionsUsed,a={};if(e.bumpMap){const s={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(s,e.bumpMap),a.bumpTexture=s}a.bumpFactor=e.bumpScale,o.extensions=o.extensions||{},o.extensions[this.name]=a,t[this.name]=!0}}class md{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,o){if(!e.isInstancedMesh)return;const i=this.writer,t=e,a=new Float32Array(t.count*3),s=new Float32Array(t.count*4),c=new Float32Array(t.count*3),d=new Mt,p=new Q,h=new be,m=new Q;for(let M=0;M<t.count;M++)t.getMatrixAt(M,d),d.decompose(p,h,m),p.toArray(a,M*3),h.toArray(s,M*4),m.toArray(c,M*3);const S={TRANSLATION:i.processAccessor(new Ve(a,3)),ROTATION:i.processAccessor(new Ve(s,4)),SCALE:i.processAccessor(new Ve(c,3))};t.instanceColor&&(S._COLOR_0=i.processAccessor(t.instanceColor)),o.extensions=o.extensions||{},o.extensions[this.name]={attributes:S},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}Bt.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),t=new n.TimeBufferType(n.times.length+1),a=new n.ValueBufferType(n.values.length+i),s=n.createInterpolant(new n.ValueBufferType(i));let c;if(n.times.length===0){t[0]=e;for(let d=0;d<i;d++)a[d]=0;c=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;t[0]=e,t.set(n.times,1),a.set(s.evaluate(e),0),a.set(n.values,i),c=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;t[t.length-1]=e,t.set(n.times,0),a.set(n.values,0),a.set(s.evaluate(e),n.values.length),c=t.length-1}else for(let d=0;d<n.times.length;d++){if(Math.abs(n.times[d]-e)<.001)return d;if(n.times[d]<e&&n.times[d+1]>e){t.set(n.times.slice(0,d+1),0),t[d+1]=e,t.set(n.times.slice(d+1),d+2),a.set(n.values.slice(0,(d+1)*i),0),a.set(s.evaluate(e),(d+1)*i),a.set(n.values.slice((d+1)*i),(d+2)*i),c=d+1;break}}return n.times=t,n.values=a,c},mergeMorphTargetTracks:function(n,e){const o=[],i={},t=n.tracks;for(let a=0;a<t.length;++a){let s=t[a];const c=xt.parseTrackName(s.name),d=xt.findNode(e,c.nodeName);if(c.propertyName!=="morphTargetInfluences"||c.propertyIndex===void 0){o.push(s);continue}if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),s=s.clone(),s.setInterpolation(no)}const p=d.morphTargetInfluences.length,h=d.morphTargetDictionary[c.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+c.propertyIndex);let m;if(i[d.uuid]===void 0){m=s.clone();const M=new m.ValueBufferType(p*m.times.length);for(let _=0;_<m.times.length;_++)M[_*p+h]=m.values[_];m.name=(c.nodeName||"")+".morphTargetInfluences",m.values=M,i[d.uuid]=m,o.push(m);continue}const S=s.createInterpolant(new s.ValueBufferType(1));m=i[d.uuid];for(let M=0;M<m.times.length;M++)m.values[M*p+h]=S.evaluate(m.times[M]);for(let M=0;M<s.times.length;M++){const _=this.insertKeyframe(m,s.times[M]);m.values[_*p+h]=s.values[M]}}return n.tracks=o,n}};class Pn extends uo{constructor(e){super(e),this.type=dt}parse(e){const s=function(x,y){switch(x){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(y||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(y||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(y||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(y||""))}},h=`
`,m=function(x,y,L){y=y||1024;let A=x.pos,G=-1,R=0,U="",D=String.fromCharCode.apply(null,new Uint16Array(x.subarray(A,A+128)));for(;0>(G=D.indexOf(h))&&R<y&&A<x.byteLength;)U+=D,R+=D.length,A+=128,D+=String.fromCharCode.apply(null,new Uint16Array(x.subarray(A,A+128)));return-1<G?(x.pos+=R+G+1,U+D.slice(0,G)):!1},S=function(x){const y=/^#\?(\S+)/,L=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,V=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,R={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let U,D;for((x.pos>=x.byteLength||!(U=m(x)))&&s(1,"no header found"),(D=U.match(y))||s(3,"bad initial token"),R.valid|=1,R.programtype=D[1],R.string+=U+`
`;U=m(x),U!==!1;){if(R.string+=U+`
`,U.charAt(0)==="#"){R.comments+=U+`
`;continue}if((D=U.match(L))&&(R.gamma=parseFloat(D[1])),(D=U.match(V))&&(R.exposure=parseFloat(D[1])),(D=U.match(A))&&(R.valid|=2,R.format=D[1]),(D=U.match(G))&&(R.valid|=4,R.height=parseInt(D[1],10),R.width=parseInt(D[2],10)),R.valid&2&&R.valid&4)break}return R.valid&2||s(3,"missing format specifier"),R.valid&4||s(3,"missing image size specifier"),R},M=function(x,y,L){const V=y;if(V<8||V>32767||x[0]!==2||x[1]!==2||x[2]&128)return new Uint8Array(x);V!==(x[2]<<8|x[3])&&s(3,"wrong scanline width");const A=new Uint8Array(4*y*L);A.length||s(4,"unable to allocate buffer space");let G=0,R=0;const U=4*V,D=new Uint8Array(4),Y=new Uint8Array(U);let j=L;for(;j>0&&R<x.byteLength;){R+4>x.byteLength&&s(1),D[0]=x[R++],D[1]=x[R++],D[2]=x[R++],D[3]=x[R++],(D[0]!=2||D[1]!=2||(D[2]<<8|D[3])!=V)&&s(3,"bad rgbe scanline format");let J=0,ie;for(;J<U&&R<x.byteLength;){ie=x[R++];const B=ie>128;if(B&&(ie-=128),(ie===0||J+ie>U)&&s(3,"bad scanline data"),B){const k=x[R++];for(let O=0;O<ie;O++)Y[J++]=k}else Y.set(x.subarray(R,R+ie),J),J+=ie,R+=ie}const $=V;for(let B=0;B<$;B++){let k=0;A[G]=Y[B+k],k+=V,A[G+1]=Y[B+k],k+=V,A[G+2]=Y[B+k],k+=V,A[G+3]=Y[B+k],G+=4}j--}return A},_=function(x,y,L,V){const A=x[y+3],G=Math.pow(2,A-128)/255;L[V+0]=x[y+0]*G,L[V+1]=x[y+1]*G,L[V+2]=x[y+2]*G,L[V+3]=1},v=function(x,y,L,V){const A=x[y+3],G=Math.pow(2,A-128)/255;L[V+0]=ut.toHalfFloat(Math.min(x[y+0]*G,65504)),L[V+1]=ut.toHalfFloat(Math.min(x[y+1]*G,65504)),L[V+2]=ut.toHalfFloat(Math.min(x[y+2]*G,65504)),L[V+3]=ut.toHalfFloat(1)},b=new Uint8Array(e);b.pos=0;const T=S(b),C=T.width,I=T.height,P=M(b.subarray(b.pos),C,I);let g,f,E;switch(this.type){case Lt:E=P.length/4;const x=new Float32Array(E*4);for(let L=0;L<E;L++)_(P,L*4,x,L*4);g=x,f=Lt;break;case dt:E=P.length/4;const y=new Uint16Array(E*4);for(let L=0;L<E;L++)v(P,L*4,y,L*4);g=y,f=dt;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:C,height:I,data:g,header:T.string,gamma:T.gamma,exposure:T.exposure,type:f}}setDataType(e){return this.type=e,this}load(e,o,i,t){function a(s,c){switch(s.type){case Lt:case dt:s.colorSpace=po,s.minFilter=Se,s.magFilter=Se,s.generateMipmaps=!1,s.flipY=!0;break}o&&o(s,c)}return super.load(e,a,i,t)}}function fd(n){this.scene.background=new he(n),document.getElementById("video").pause()}function gd(n){document.getElementById("video").pause();const o=new Ae().load(n);this.scene.background=o,this.scene.backgroundIntensity=1,o.dispose()}function _d(n){return new Promise(e=>{document.getElementById("video").pause();const{blurriness:i,intensity:t,viewImg:a}=n,s=new Ae().load(a);s.mapping=Ot,this.scene.background=s,this.scene.environment=s,this.scene.backgroundIntensity=t,this.scene.backgroundBlurriness=i,s.dispose(),e()})}function yd(n){const{blurriness:e,intensity:o}=n;this.scene.backgroundIntensity=o,this.scene.backgroundBlurriness=e}function vd(n,e){return new Promise(async o=>{document.getElementById("video").pause();let t,a;e=="hdr"?t=new Pn:t=new Ae,a=await t.loadAsync(n),a.mapping=Ot,this.scene.background=a,a.dispose(),o()})}function wd(n){return new Promise(async e=>{const o=new FileReader,i=document.getElementById("video"),{clientHeight:t,clientWidth:a}=this.container;o.onload=c=>{i.src=c.target.result,i.width=a,i.height=t,i.play()},o.readAsDataURL(n.raw);const s=new ho(i);this.scene.background=s,this.scene.minFilter=Se,this.scene.magFilter=Se,this.scene.format=mo,s.dispose(),e()})}const xd={onSetSceneColor:fd,onSetSceneImage:gd,onSetSceneViewImage:_d,onSetSceneViewConfig:yd,onSetStorageViewImage:vd,onSetStorageViewVideo:wd},Ie=we();function bd(){this.modelMaterialList=[];let n=0;this.model.traverse(e=>{e.isMesh&&e.material&&(e.castShadow=!0,e.frustumCulled=!1,Array.isArray(e.material)?(e.material=e.material[0],this.setMaterialMeshParams(e,n)):this.setMaterialMeshParams(e,n))})}function Md(n,e){const o=n.clone();Object.assign(n.userData,{rotation:o.rotation,scale:o.scale,position:o.position});const i=n.material.clone();n.mapId=n.name+"_"+e,n.material=i;const{mapId:t,uuid:a,userData:s,type:c,name:d,isMesh:p,visible:h}=n,{color:m,wireframe:S,depthWrite:M,opacity:_}=n.material,b={mapId:t,uuid:a,userData:s,type:c,name:d,isMesh:p,visible:h,material:{color:m,wireframe:S,depthWrite:M,opacity:_}};this.modelMaterialList.push(b);const T=n.material.clone();T.userData.mapId=n.name+"_"+e,this.originalMaterials.set(n.uuid,T)}function Sd(){this.model.updateMatrixWorld();const n=new zt().setFromObject(this.model),e=n.getSize(new Q),o=n.getCenter(new Q),i=Math.max(e.x,e.y,e.z),a=2.5/(i>1?i:.5);this.model.scale.set(a,a,a),this.model.position.sub(o.multiplyScalar(a)),this.controls.maxDistance=e.length()*10,this.camera.position.set(0,2,6),this.camera.updateProjectionMatrix()}function Cd(n){let e={};return n.forEach(o=>{if(o.map&&o.map.image){const i=document.createElement("canvas");i.width=75,i.height=75,i.getContext("2d").drawImage(o.map.image,0,0),e={url:i.toDataURL("image/png",.5)},i.remove()}}),e}function Ld(n){const{color:e,wireframe:o,depthWrite:i,opacity:t}=JSON.parse(JSON.stringify(n)),a=Ie.selectMesh.uuid,s=this.scene.getObjectByProperty("uuid",a);if(s&&s.material){const{name:d,map:p}=s.material;Object.assign(s.material,{map:p,name:d,transparent:!0,color:new he(e),wireframe:o,depthWrite:i,opacity:t})}const c=this.modelMaterialList.find(d=>d.uuid==a)||{};Object.assign(c.material,{color:new he(e),wireframe:o,depthWrite:i,opacity:t})}function Td(n){const e=this.scene.getObjectByProperty("uuid",n.uuid);e.visible=n.visible}function Ed({mapId:n,meshName:e}){const o=Ie.selectMesh.uuid,i=this.scene.getObjectByProperty("uuid",o),t=this.originalMaterials.get(o);i.material=t.clone(),i.mapId=n,i.meshFrom=e}function Ad({id:n,url:e}){return new Promise(o=>{const i=Ie.selectMesh.uuid,t=this.scene.getObjectByProperty("uuid",i),a=new Ae().load(e),s=t.material.clone();s.map=a,s.map.wrapS=st,s.map.wrapT=st,s.map.flipY=!1,s.map.colorSpace=at,s.map.minFilter=Se,s.map.magFilter=Se,t.material=s,t.mapId=n,t.meshFrom=n,a.dispose(),o()})}function Id(n,e){return new Promise(async o=>{const i=Ie.selectMesh.uuid,t=this.scene.getObjectByProperty("uuid",i);let a,s;e=="hdr"?a=new Pn:a=new Ae,s=await a.loadAsync(n);const c=t.material.clone();c.map=s,c.map.wrapS=st,c.map.wrapT=st,c.map.flipY=!1,c.map.colorSpace=at,c.map.minFilter=Se,c.map.magFilter=Se,t.material=c,s.dispose(),o()})}function Pd(n){const e=this.model.getObjectByName(n);return this.outlinePass.selectedObjects=[e],Ie.selectMeshAction(e),e}function kd(n){const{clientHeight:e,clientWidth:o,offsetLeft:i,offsetTop:t}=this.container;this.mouse.x=(n.clientX-i)/o*2-1,this.mouse.y=-((n.clientY-t)/e)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);let a;if(this.model&&(a=this.model),this.geometryGroup.children.length&&(a=this.geometryGroup),!a)return!1;const c=this.raycaster.intersectObjects(a.children,!0).filter(d=>d.object.isMesh&&d.object.material);if(c.length>0){const d=c[0].object;if(this.outlinePass.selectedObjects=[d],Ie.selectMeshAction(d),this.transformControls){const p=new zt().setFromObject(d),{dragPosition:h}=d.userData;if(h)this.transformControls.position.copy(h);else{const m=p.getCenter(new Q);d.userData.dragPosition=m,this.transformControls.position.copy(m)}this.transformControls.attach(d)}}else this.transformControls||(this.outlinePass.selectedObjects=[],Ie.selectMeshAction({}))}function Rd(){const n=[];return this.model.traverse(e=>{if(e.isMesh&&e.material){const{color:o,opacity:i,depthWrite:t,wireframe:a}=e.material,s={meshName:e.name,meshFrom:e.meshFrom,color:o.getStyle(),opacity:i,depthWrite:t,wireframe:a,visible:e.visible,type:e.material.type};n.push(s)}}),n}function Vd(n){this.model.traverse(e=>{if(e.isMesh&&e.material){const{name:o,color:i,map:t,wireframe:a,depthWrite:s,opacity:c}=e.material;if(n.type)e.material=new Nt[n.type]({map:t,transparent:!0,color:i,name:o});else{const d=this.originalMaterials.get(e.uuid);e.material=d}s&&(e.material.depthWrite=s),c&&(e.material.opacity=c),a&&(e.material.wireframe=a),e.material.side=rt}})}function Fd(n){this.modelMaterialList=[],this.model.traverse(e=>{const{name:o}=e;e.castShadow=!0,e.frustumCulled=!1,e.isMesh&&e.material&&(this.modelMaterialList.push(e),this.originalMaterials.set(e.uuid,e.material),e.mapId=o)})}function $d(){this.model.traverse(n=>{if(n.isMesh&&n.material){const e=this.originalMaterials.get(n.uuid);n.material=e.clone(),n.mapId=e.userData.mapId,n.visible=!0,n.meshFrom=null}}),this.modelMaterialList.forEach(n=>{n.visible=!0;const e=this.originalMaterials.get(n.uuid);n.mapId=e.userData.mapId;const{color:o,wireframe:i,depthWrite:t,opacity:a}=e;Object.assign(n.material,{color:o,wireframe:i,depthWrite:t,opacity:a})}),Ie.selectMeshAction({})}const Ud={getModelMeaterialList:bd,setModelPositionSize:Sd,getModelMaps:Cd,onSetModelMaterial:Ld,onSetModelMap:Ed,onSetSystemModelMap:Ad,onSetStorageModelMap:Id,onChangeModelMeaterial:Pd,onMouseClickModel:kd,onGetEditMeshList:Rd,onChangeModelMeshType:Vd,onSetGeometryMeshList:Fd,onSetMeshVisibe:Td,initModelMaterial:$d,setMaterialMeshParams:Md};var ot={Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return 1-Math.cos(n*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}},Back:{In:function(n){var e=1.70158;return n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}},Bounce:{In:function(n){return 1-ot.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?ot.Bounce.In(n*2)*.5:ot.Bounce.Out(n*2-1)*.5+.5}}},et;typeof self>"u"&&typeof process<"u"&&process.hrtime?et=function(){var n=process.hrtime();return n[0]*1e3+n[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?et=self.performance.now.bind(self.performance):Date.now!==void 0?et=Date.now:et=function(){return new Date().getTime()};var Re=et,kn=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(o){return e._tweens[o]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},n.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},n.prototype.update=function(e,o){e===void 0&&(e=Re()),o===void 0&&(o=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var t=0;t<i.length;t++){var a=this._tweens[i[t]],s=!o;a&&a.update(e,s)===!1&&!o&&delete this._tweens[i[t]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),ze={Linear:function(n,e){var o=n.length-1,i=o*e,t=Math.floor(i),a=ze.Utils.Linear;return e<0?a(n[0],n[1],i):e>1?a(n[o],n[o-1],o-i):a(n[t],n[t+1>o?o:t+1],i-t)},Bezier:function(n,e){for(var o=0,i=n.length-1,t=Math.pow,a=ze.Utils.Bernstein,s=0;s<=i;s++)o+=t(1-e,i-s)*t(e,s)*n[s]*a(i,s);return o},CatmullRom:function(n,e){var o=n.length-1,i=o*e,t=Math.floor(i),a=ze.Utils.CatmullRom;return n[0]===n[o]?(e<0&&(t=Math.floor(i=o*(1+e))),a(n[(t-1+o)%o],n[t],n[(t+1)%o],n[(t+2)%o],i-t)):e<0?n[0]-(a(n[0],n[0],n[1],n[1],-i)-n[0]):e>1?n[o]-(a(n[o],n[o],n[o-1],n[o-1],i-o)-n[o]):a(n[t?t-1:0],n[t],n[o<t+1?o:t+1],n[o<t+2?o:t+2],i-t)},Utils:{Linear:function(n,e,o){return(e-n)*o+n},Bernstein:function(n,e){var o=ze.Utils.Factorial;return o(n)/o(e)/o(n-e)},Factorial:function(){var n=[1];return function(e){var o=1;if(n[e])return n[e];for(var i=e;i>1;i--)o*=i;return n[e]=o,o}}(),CatmullRom:function(n,e,o,i,t){var a=(o-n)*.5,s=(i-e)*.5,c=t*t,d=t*c;return(2*e-2*o+a+s)*d+(-3*e+3*o-2*a-s)*c+a*t+e}}},jt=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),Rn=new kn,Dd=function(){function n(e,o){o===void 0&&(o=Rn),this._object=e,this._group=o,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=ot.Linear.None,this._interpolationFunction=ze.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=jt.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.to=function(e,o){return this._valuesEnd=Object.create(e),o!==void 0&&(this._duration=o),this},n.prototype.duration=function(e){return this._duration=e,this},n.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var o in this._valuesStartRepeat)this._swapEndStartRepeatValues(o),this._valuesStart[o]=this._valuesStartRepeat[o]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e!==void 0?typeof e=="string"?Re()+parseFloat(e):e:Re(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},n.prototype._setupProperties=function(e,o,i,t){for(var a in i){var s=e[a],c=Array.isArray(s),d=c?"array":typeof s,p=!c&&Array.isArray(i[a]);if(!(d==="undefined"||d==="function")){if(p){var h=i[a];if(h.length===0)continue;h=h.map(this._handleRelativeValue.bind(this,s)),i[a]=[s].concat(h)}if((d==="object"||c)&&s&&!p){o[a]=c?[]:{};for(var m in s)o[a][m]=s[m];t[a]=c?[]:{},this._setupProperties(s,o[a],i[a],t[a])}else typeof o[a]>"u"&&(o[a]=s),c||(o[a]*=1),p?t[a]=i[a].slice().reverse():t[a]=o[a]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(e){return e===void 0&&(e=Re()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},n.prototype.resume=function(e){return e===void 0&&(e=Re()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var e=0,o=this._chainedTweens.length;e<o;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return this._group=e,this},n.prototype.delay=function(e){return this._delayTime=e,this},n.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return this._yoyo=e,this},n.prototype.easing=function(e){return this._easingFunction=e,this},n.prototype.interpolation=function(e){return this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,o){if(e===void 0&&(e=Re()),o===void 0&&(o=!0),this._isPaused)return!0;var i,t,a=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>a)return!1;o&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),t=(e-this._startTime)/this._duration,t=this._duration===0||t>1?1:t;var s=this._easingFunction(t);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,s),this._onUpdateCallback&&this._onUpdateCallback(this._object,t),t===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var c=0,d=this._chainedTweens.length;c<d;c++)this._chainedTweens[c].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,o,i,t){for(var a in i)if(o[a]!==void 0){var s=o[a]||0,c=i[a],d=Array.isArray(e[a]),p=Array.isArray(c),h=!d&&p;h?e[a]=this._interpolationFunction(c,t):typeof c=="object"&&c?this._updateProperties(e[a],s,c,t):(c=this._handleRelativeValue(s,c),typeof c=="number"&&(e[a]=s+(c-s)*t))}},n.prototype._handleRelativeValue=function(e,o){return typeof o!="string"?o:o.charAt(0)==="+"||o.charAt(0)==="-"?e+parseFloat(o):parseFloat(o)},n.prototype._swapEndStartRepeatValues=function(e){var o=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=o},n}(),Hd="18.6.4",Od=jt.nextId,Ce=Rn,zd=Ce.getAll.bind(Ce),Nd=Ce.removeAll.bind(Ce),Gd=Ce.add.bind(Ce),Bd=Ce.remove.bind(Ce),jd=Ce.update.bind(Ce),Xe={Easing:ot,Group:kn,Interpolation:ze,now:Re,Sequence:jt,nextId:Od,Tween:Dd,VERSION:Hd,getAll:zd,removeAll:Nd,add:Gd,remove:Bd,update:jd};const Pe=new Sn,de=new Q,Ee=new Q,se=new be,rn={X:new Q(1,0,0),Y:new Q(0,1,0),Z:new Q(0,0,1)},Vt={type:"change"},ln={type:"mouseDown",mode:null},cn={type:"mouseUp",mode:null},dn={type:"objectChange"};class Yd extends Dt{constructor(e,o){super(),o===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),o=document),this.isTransformControls=!0,this.visible=!1,this.domElement=o,this.domElement.style.touchAction="none";const i=new Kd;this._gizmo=i,this.add(i);const t=new Jd;this._plane=t,this.add(t);const a=this;function s(C,I){let P=I;Object.defineProperty(a,C,{get:function(){return P!==void 0?P:I},set:function(g){P!==g&&(P=g,t[C]=g,i[C]=g,a.dispatchEvent({type:C+"-changed",value:g}),a.dispatchEvent(Vt))}}),a[C]=I,t[C]=I,i[C]=I}s("camera",e),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const c=new Q,d=new Q,p=new be,h=new be,m=new Q,S=new be,M=new Q,_=new Q,v=new Q,b=0,T=new Q;s("worldPosition",c),s("worldPositionStart",d),s("worldQuaternion",p),s("worldQuaternionStart",h),s("cameraPosition",m),s("cameraQuaternion",S),s("pointStart",M),s("pointEnd",_),s("rotationAxis",v),s("rotationAngle",b),s("eye",T),this._offset=new Q,this._startNorm=new Q,this._endNorm=new Q,this._cameraScale=new Q,this._parentPosition=new Q,this._parentQuaternion=new be,this._parentQuaternionInv=new be,this._parentScale=new Q,this._worldScaleStart=new Q,this._worldQuaternionInv=new be,this._worldScale=new Q,this._positionStart=new Q,this._quaternionStart=new be,this._scaleStart=new Q,this._getPointer=Xd.bind(this),this._onPointerDown=Zd.bind(this),this._onPointerHover=Wd.bind(this),this._onPointerMove=Qd.bind(this),this._onPointerUp=qd.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Pe.setFromCamera(e,this.camera);const o=Ft(this._gizmo.picker[this.mode],Pe);o?this.axis=o.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Pe.setFromCamera(e,this.camera);const o=Ft(this._plane,Pe,!0);o&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(o.point).sub(this.worldPositionStart)),this.dragging=!0,ln.mode=this.mode,this.dispatchEvent(ln)}}pointerMove(e){const o=this.axis,i=this.mode,t=this.object;let a=this.space;if(i==="scale"?a="local":(o==="E"||o==="XYZE"||o==="XYZ")&&(a="world"),t===void 0||o===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Pe.setFromCamera(e,this.camera);const s=Ft(this._plane,Pe,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&o!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),o.indexOf("X")===-1&&(this._offset.x=0),o.indexOf("Y")===-1&&(this._offset.y=0),o.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&o!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),t.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(t.position.applyQuaternion(se.copy(this._quaternionStart).invert()),o.search("X")!==-1&&(t.position.x=Math.round(t.position.x/this.translationSnap)*this.translationSnap),o.search("Y")!==-1&&(t.position.y=Math.round(t.position.y/this.translationSnap)*this.translationSnap),o.search("Z")!==-1&&(t.position.z=Math.round(t.position.z/this.translationSnap)*this.translationSnap),t.position.applyQuaternion(this._quaternionStart)),a==="world"&&(t.parent&&t.position.add(de.setFromMatrixPosition(t.parent.matrixWorld)),o.search("X")!==-1&&(t.position.x=Math.round(t.position.x/this.translationSnap)*this.translationSnap),o.search("Y")!==-1&&(t.position.y=Math.round(t.position.y/this.translationSnap)*this.translationSnap),o.search("Z")!==-1&&(t.position.z=Math.round(t.position.z/this.translationSnap)*this.translationSnap),t.parent&&t.position.sub(de.setFromMatrixPosition(t.parent.matrixWorld))));else if(i==="scale"){if(o.search("XYZ")!==-1){let c=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(c*=-1),Ee.set(c,c,c)}else de.copy(this.pointStart),Ee.copy(this.pointEnd),de.applyQuaternion(this._worldQuaternionInv),Ee.applyQuaternion(this._worldQuaternionInv),Ee.divide(de),o.search("X")===-1&&(Ee.x=1),o.search("Y")===-1&&(Ee.y=1),o.search("Z")===-1&&(Ee.z=1);t.scale.copy(this._scaleStart).multiply(Ee),this.scaleSnap&&(o.search("X")!==-1&&(t.scale.x=Math.round(t.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),o.search("Y")!==-1&&(t.scale.y=Math.round(t.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),o.search("Z")!==-1&&(t.scale.z=Math.round(t.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const c=20/this.worldPosition.distanceTo(de.setFromMatrixPosition(this.camera.matrixWorld));let d=!1;o==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(de.copy(this.rotationAxis).cross(this.eye))*c):(o==="X"||o==="Y"||o==="Z")&&(this.rotationAxis.copy(rn[o]),de.copy(rn[o]),a==="local"&&de.applyQuaternion(this.worldQuaternion),de.cross(this.eye),de.length()===0?d=!0:this.rotationAngle=this._offset.dot(de.normalize())*c),(o==="E"||d)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&o!=="E"&&o!=="XYZE"?(t.quaternion.copy(this._quaternionStart),t.quaternion.multiply(se.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),t.quaternion.copy(se.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),t.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Vt),this.dispatchEvent(dn)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(cn.mode=this.mode,this.dispatchEvent(cn)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Vt),this.dispatchEvent(dn),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Pe}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Xd(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function Wd(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function Zd(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function Qd(n){this.enabled&&this.pointerMove(this._getPointer(n))}function qd(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function Ft(n,e,o){const i=e.intersectObject(n,!0);for(let t=0;t<i.length;t++)if(i[t].object.visible||o)return i[t];return!1}const gt=new fo,oe=new Q(0,1,0),un=new Q(0,0,0),pn=new Mt,_t=new be,wt=new be,Me=new Q,hn=new Mt,tt=new Q(1,0,0),ke=new Q(0,1,0),nt=new Q(0,0,1),yt=new Q,qe=new Q,Ke=new Q;class Kd extends Dt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Cn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=new go({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const t=o.clone();t.opacity=.5;const a=e.clone();a.color.setHex(16711680);const s=e.clone();s.color.setHex(65280);const c=e.clone();c.color.setHex(255);const d=e.clone();d.color.setHex(16711680),d.opacity=.5;const p=e.clone();p.color.setHex(65280),p.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const m=e.clone();m.opacity=.25;const S=e.clone();S.color.setHex(16776960),S.opacity=.25,e.clone().color.setHex(16776960);const _=e.clone();_.color.setHex(7895160);const v=new fe(0,.04,.1,12);v.translate(0,.05,0);const b=new pe(.08,.08,.08);b.translate(0,.04,0);const T=new Xt;T.setAttribute("position",new Wt([0,0,0,1,0,0],3));const C=new fe(.0075,.0075,.5,3);C.translate(0,.25,0);function I(U,D){const Y=new We(U,.0075,3,64,D*Math.PI*2);return Y.rotateY(Math.PI/2),Y.rotateX(Math.PI/2),Y}function P(){const U=new Xt;return U.setAttribute("position",new Wt([0,0,0,1,1,1],3)),U}const g={X:[[new N(v,a),[.5,0,0],[0,0,-Math.PI/2]],[new N(v,a),[-.5,0,0],[0,0,Math.PI/2]],[new N(C,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new N(v,s),[0,.5,0]],[new N(v,s),[0,-.5,0],[Math.PI,0,0]],[new N(C,s)]],Z:[[new N(v,c),[0,0,.5],[Math.PI/2,0,0]],[new N(v,c),[0,0,-.5],[-Math.PI/2,0,0]],[new N(C,c),null,[Math.PI/2,0,0]]],XYZ:[[new N(new pt(.1,0),m.clone()),[0,0,0]]],XY:[[new N(new pe(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new N(new pe(.15,.15,.01),d.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new pe(.15,.15,.01),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},f={X:[[new N(new fe(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new N(new fe(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new N(new fe(.2,0,.6,4),i),[0,.3,0]],[new N(new fe(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new N(new fe(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new N(new fe(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new N(new pt(.2,0),i)]],XY:[[new N(new pe(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new N(new pe(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new pe(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},E={START:[[new N(new pt(.01,2),t),null,null,null,"helper"]],END:[[new N(new pt(.01,2),t),null,null,null,"helper"]],DELTA:[[new Te(P(),t),null,null,null,"helper"]],X:[[new Te(T,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Te(T,t.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Te(T,t.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},x={XYZE:[[new N(I(.5,1),_),null,[0,Math.PI/2,0]]],X:[[new N(I(.5,.5),a)]],Y:[[new N(I(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new N(I(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new N(I(.75,1),S),null,[0,Math.PI/2,0]]]},y={AXIS:[[new Te(T,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={XYZE:[[new N(new _o(.25,10,8),i)]],X:[[new N(new We(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new N(new We(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new N(new We(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new N(new We(.75,.1,2,24),i)]]},V={X:[[new N(b,a),[.5,0,0],[0,0,-Math.PI/2]],[new N(C,a),[0,0,0],[0,0,-Math.PI/2]],[new N(b,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new N(b,s),[0,.5,0]],[new N(C,s)],[new N(b,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new N(b,c),[0,0,.5],[Math.PI/2,0,0]],[new N(C,c),[0,0,0],[Math.PI/2,0,0]],[new N(b,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new N(new pe(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new N(new pe(.15,.15,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new pe(.15,.15,.01),p),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new N(new pe(.1,.1,.1),m.clone())]]},A={X:[[new N(new fe(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new N(new fe(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new N(new fe(.2,0,.6,4),i),[0,.3,0]],[new N(new fe(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new N(new fe(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new N(new fe(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new N(new pe(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new N(new pe(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new pe(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new N(new pe(.2,.2,.2),i),[0,0,0]]]},G={X:[[new Te(T,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Te(T,t.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Te(T,t.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function R(U){const D=new Dt;for(const Y in U)for(let j=U[Y].length;j--;){const J=U[Y][j][0].clone(),ie=U[Y][j][1],$=U[Y][j][2],B=U[Y][j][3],k=U[Y][j][4];J.name=Y,J.tag=k,ie&&J.position.set(ie[0],ie[1],ie[2]),$&&J.rotation.set($[0],$[1],$[2]),B&&J.scale.set(B[0],B[1],B[2]),J.updateMatrix();const O=J.geometry.clone();O.applyMatrix4(J.matrix),J.geometry=O,J.renderOrder=1/0,J.position.set(0,0,0),J.rotation.set(0,0,0),J.scale.set(1,1,1),D.add(J)}return D}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=R(g)),this.add(this.gizmo.rotate=R(x)),this.add(this.gizmo.scale=R(V)),this.add(this.picker.translate=R(f)),this.add(this.picker.rotate=R(L)),this.add(this.picker.scale=R(A)),this.add(this.helper.translate=R(E)),this.add(this.helper.rotate=R(y)),this.add(this.helper.scale=R(G)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:wt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let t=[];t=t.concat(this.picker[this.mode].children),t=t.concat(this.gizmo[this.mode].children),t=t.concat(this.helper[this.mode].children);for(let a=0;a<t.length;a++){const s=t[a];s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition);let c;if(this.camera.isOrthographicCamera?c=(this.camera.top-this.camera.bottom)/this.camera.zoom:c=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(c*this.size/4),s.tag==="helper"){s.visible=!1,s.name==="AXIS"?(s.visible=!!this.axis,this.axis==="X"&&(se.setFromEuler(gt.set(0,0,0)),s.quaternion.copy(i).multiply(se),Math.abs(oe.copy(tt).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(se.setFromEuler(gt.set(0,0,Math.PI/2)),s.quaternion.copy(i).multiply(se),Math.abs(oe.copy(ke).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(se.setFromEuler(gt.set(0,Math.PI/2,0)),s.quaternion.copy(i).multiply(se),Math.abs(oe.copy(nt).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(se.setFromEuler(gt.set(0,Math.PI/2,0)),oe.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(pn.lookAt(un,oe,ke)),s.quaternion.multiply(se),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),de.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),de.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(de),s.visible=this.dragging):(s.quaternion.copy(i),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1));continue}s.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(oe.copy(tt).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(oe.copy(ke).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(oe.copy(nt).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(oe.copy(nt).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(oe.copy(tt).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(oe.copy(ke).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(_t.copy(i),oe.copy(this.eye).applyQuaternion(se.copy(i).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(pn.lookAt(this.eye,un,ke)),s.name==="X"&&(se.setFromAxisAngle(tt,Math.atan2(-oe.y,oe.z)),se.multiplyQuaternions(_t,se),s.quaternion.copy(se)),s.name==="Y"&&(se.setFromAxisAngle(ke,Math.atan2(oe.x,oe.z)),se.multiplyQuaternions(_t,se),s.quaternion.copy(se)),s.name==="Z"&&(se.setFromAxisAngle(nt,Math.atan2(oe.y,oe.x)),se.multiplyQuaternions(_t,se),s.quaternion.copy(se))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(d){return s.name===d}))&&(s.material.color.setHex(16776960),s.material.opacity=1)}super.updateMatrixWorld(e)}}class Jd extends N{constructor(){super(new bt(1e5,1e5,2,2),new Cn({visible:!1,wireframe:!0,side:rt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let o=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(o="local"),yt.copy(tt).applyQuaternion(o==="local"?this.worldQuaternion:wt),qe.copy(ke).applyQuaternion(o==="local"?this.worldQuaternion:wt),Ke.copy(nt).applyQuaternion(o==="local"?this.worldQuaternion:wt),oe.copy(qe),this.mode){case"translate":case"scale":switch(this.axis){case"X":oe.copy(this.eye).cross(yt),Me.copy(yt).cross(oe);break;case"Y":oe.copy(this.eye).cross(qe),Me.copy(qe).cross(oe);break;case"Z":oe.copy(this.eye).cross(Ke),Me.copy(Ke).cross(oe);break;case"XY":Me.copy(Ke);break;case"YZ":Me.copy(yt);break;case"XZ":oe.copy(Ke),Me.copy(qe);break;case"XYZ":case"E":Me.set(0,0,0);break}break;case"rotate":default:Me.set(0,0,0)}Me.length()===0?this.quaternion.copy(this.cameraQuaternion):(hn.lookAt(de.set(0,0,0),Me,oe),this.quaternion.setFromRotationMatrix(hn)),super.updateMatrixWorld(e)}}function eu(n){const{glow:e,threshold:o,strength:i,radius:t,toneMappingExposure:a,color:s}=n;this.glowUnrealBloomPass=e,e?(this.unrealBloomPass.threshold=o,this.unrealBloomPass.strength=i,this.unrealBloomPass.radius=t,this.renderer.toneMappingExposure=a,this.shaderPass.material.uniforms.glowColor.value=new he(s),((this.effectComposer.passes||[]).find(p=>p.name=="ShaderColor")||{}).name||this.effectComposer.addPass(this.shaderPass)):(this.unrealBloomPass.threshold=0,this.unrealBloomPass.strength=0,this.unrealBloomPass.radius=0,this.renderer.toneMappingExposure=a,this.shaderPass.material.uniforms.glowColor.value=new he,this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose(),this.effectComposer.removePass(this.shaderPass))}function tu({decompose:n}){if(this.glowMaterialList.length<=1)return!1;const e=(t,a)=>{const s=new Xe.Tween(t.position);s.to(a,500),s.onUpdate(function(c){t.position.set(c.x||0,c.y||0,c.z||0)}),s.start()},o=this.glowMaterialList.length,i=2*Math.PI/o;this.glowMaterialList.forEach((t,a)=>{const s=this.model.getObjectByName(t),{decomposeName:c}=this.model;if(s.type=="Mesh")if(Tt[c]&&Tt[c][t]){const d={x:0,y:0,z:0},{x:p,y:h,z:m}=Tt[c][t];p=="straight"?d.x+=n:p=="burden"&&(d.x-=n),h=="straight"?d.y+=n:h=="burden"&&(d.y-=n),m=="straight"?d.z+=n:m=="burden"&&(d.z-=n),e(s,d)}else{const d=a*i,p=n*Math.cos(d),h=n*Math.sin(d);e(s,{x:p,y:h,z:0})}})}function nu({manageFlage:n}){n?(this.transformControls||(this.transformControls=new Yd(this.camera,this.renderer.domElement),this.transformControls.setMode("translate"),this.transformControls.addEventListener("dragging-changed",e=>{this.controls.enabled=!e.value}),this.transformControls.size=1,this.scene.add(this.transformControls)),this.transformControls.attach()):this.transformControls&&(this.transformControls.detach(),this.transformControls.dispose(),this.scene.remove(this.transformControls),this.transformControls=null)}function ou(n){this.transformControls.setMode(n)}function su(){const n=[];return this.modelMaterialList.forEach(e=>{const o=this.model.getObjectByProperty("name",e.name),{rotation:i,scale:t,position:a}=o,s={name:e.name,rotation:{x:i.x,y:i.y,z:i.z},scale:{x:t.x,y:t.y,z:t.z},position:{x:a.x,y:a.y,z:a.z}};n.push(s)}),n}function iu(n){this.shaderPass.material.uniforms.glowColor.value=new he(n)}function au(){this.renderer.toneMappingExposure=2,Object.assign(this.unrealBloomPass,{threshold:0,strength:0,radius:0}),this.shaderPass.material.uniforms.glowColor.value=new he,this.glowUnrealBloomPass=!1,this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose(),this.transformControls&&(this.transformControls.detach(),this.transformControls.dispose(),this.scene.remove(this.transformControls),this.transformControls=null),this.effectComposer.removePass(this.shaderPass),this.model.traverse(n=>{if(n.isMesh&&n.material){const{rotation:e,scale:o,position:i}=n.userData;n.rotation.set(e.x,e.y,e.z),n.scale.set(o.x,o.y,o.z),n.position.set(i.x,i.y,i.z)}})}const ru={onSetUnrealBloomPass:eu,setModelMeshDecompose:tu,setModelMeshDrag:nu,getMeshDragPosition:su,onSetFlowColor:iu,initStageFlow:au,setTransformControlsType:ou};function lu({ambientLight:n,ambientLightColor:e,ambientLightIntensity:o}){this.ambientLight.visible=n,this.ambientLight.intensity=o,this.ambientLight.color.set(e)}function cu(n){const{directionaShadow:e,directionalHorizontal:o,directionalVertical:i,directionalSistance:t,directionalLight:a,directionalLightColor:s,directionalLightIntensity:c,directionalLightHelper:d}=n;this.directionalLight.visible=a,this.directionalLightHelper.visible=d&&a,this.directionalLight.intensity=c,this.directionalLight.castShadow=e,this.directionalLight.color.set(s);const{x:p,y:h,z:m}=Gt(o,i,t);this.directionalLight.position.set(p,h,m),this.directionalLightHelper.update()}function du(n){const{pointHorizontal:e,pointVertical:o,pointSistance:i,pointLight:t,pointLightColor:a,pointLightIntensity:s,pointLightHelper:c}=n;this.pointLight.visible=t,this.pointLightHelper.visible=t&&c,this.pointLight.intensity=s,this.pointLight.color.set(a);const{x:d,y:p,z:h}=Gt(e,o,i);this.pointLight.position.set(d,p,h),this.pointLightHelper.update()}function uu(n){const{spotDistance:e,spotCastShadow:o,spotLightHelper:i,spotFocus:t,spotPenumbra:a,spotAngle:s,spotLight:c,spotLightColor:d,spotLightIntensity:p,spotHorizontal:h,spotVertical:m,spotSistance:S}=n;this.spotLight.visible=c,this.spotLightHelper.visible=c&&i,this.spotLight.intensity=p,this.spotLight.angle=s,this.spotLight.penumbra=a,this.spotLight.shadow.focus=t,this.spotLight.castShadow=o,this.spotLight.distance=e,this.spotLight.color.set(d);const{x:M,y:_,z:v}=Gt(h,m,S);this.spotLight.position.set(M,_,v),this.spotLightHelper.update()}function pu({planeGeometry:n,planeColor:e,planeWidth:o,planeHeight:i}){this.planeGeometry.visible=n,this.planeGeometry.geometry=new bt(o,i),this.planeGeometry.material.color.set(e),this.planeGeometry.material.side=rt,this.planeGeometry.geometry.verticesNeedUpdate=!0}function hu({ambientLight:n}){const e={planeGeometry:!1,planeColor:"#939393",planeWidth:7,planeHeight:7,ambientLight:n,ambientLightColor:"#fff",ambientLightIntensity:.8,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#1E90FF",directionalLightIntensity:1,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistance:2.98,directionaShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:1,pointHorizontal:-4.21,pointVertical:-4.1,pointSistance:2.53,spotLight:!1,spotLightColor:"#323636",spotLightIntensity:400,spotHorizontal:-3.49,spotVertical:-4.37,spotSistance:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20};this.onSetModelAmbientLight(e),this.onSetModelDirectionalLight(e),this.onSetModelPointLight(e),this.onSetModelSpotLight(e),this.onSetModelPlaneGeometry(e)}const mu={onSetModelAmbientLight:lu,onSetModelDirectionalLight:cu,onSetModelPointLight:du,onSetModelSpotLight:uu,onSetModelPlaneGeometry:pu,onResettingLight:hu};function fu(n){this.onSetModelAnimaion(n),cancelAnimationFrame(this.animationFrame),this.animationFrameFun()}function gu({animationName:n,loop:e,timeScale:o,weight:i}){this.animationMixer=new yo(this.model);const t=vo.findByName(this.modelAnimation,n);t&&(this.animateClipAction=this.animationMixer.clipAction(t),this.animateClipAction.setEffectiveTimeScale(o),this.animateClipAction.setEffectiveWeight(i),this.animateClipAction.setLoop(this.loopMap[e]),this.animateClipAction.play())}function _u(){this.animationFrame=requestAnimationFrame(()=>this.animationFrameFun()),this.animationMixer&&this.animationMixer.update(this.animationColock.getDelta())}function yu(){this.animateClipAction&&(this.animationMixer.stopAllAction(),this.animationMixer.update(0),cancelAnimationFrame(this.animationFrame))}function vu(n){const{rotationVisible:e,rotationType:o,rotationSpeed:i}=n;e?(cancelAnimationFrame(this.rotationAnimationFrame),this.rotationAnimationFun(o,i)):(cancelAnimationFrame(this.rotationAnimationFrame),this.model.rotation.set(0,0,0))}function wu(n){const{rotationType:e,rotationSpeed:o}=n;this.model.rotation.set(0,0,0),cancelAnimationFrame(this.rotationAnimationFrame),this.rotationAnimationFun(e,o)}function xu(n,e){this.rotationAnimationFrame=requestAnimationFrame(()=>this.rotationAnimationFun(n,e)),this.model.rotation[n]+=e/50}function bu(n){this.modelAnimation=n.animations||[]}const Mu={onStartModelAnimaion:fu,onSetModelAnimaion:gu,animationFrameFun:_u,onClearAnimation:yu,onSetRotation:vu,onSetRotationType:wu,rotationAnimationFun:xu,getModelAnimaionList:bu};function Su(n){this.skeletonHelper.visible=n}function Cu(n,e){const o=Math.PI/2,{x:i,y:t,z:a}=this.model.rotation,s={x:i,y:t,z:a};s[n]+=e?o:-o;const c=new Xe.Tween({x:i,y:t,z:a});c.to(s,500),c.onUpdate(d=>{this.model.rotation[n]=d[n]}),c.start()}function Lu(){this.model.rotation.x=0,this.model.rotation.y=0,this.model.rotation.z=0}function Tu({positionX:n,positionY:e,positionZ:o}){const i=new Xe.Tween(this.model.position),t={x:n,y:e,z:o};i.to(t,500),i.onUpdate(a=>{this.model.position.set(a.x||0,a.y||0,a.z||0)}),i.start()}function Eu({positionX:n,positionY:e,positionZ:o}){this.model.position.set(n,e,o)}function Au(){this.camera.position.set(0,2,6),this.camera.lookAt(0,0,0)}function Iu(){return this.camera.position}function Pu({x:n,y:e,z:o,gridHelper:i,color:t}){this.gridHelper.visible=i,this.gridHelper.material.color.set(t);const a=new Xe.Tween(this.gridHelper.position),s={x:n,y:e,z:o};a.to(s,500),a.onUpdate(c=>{this.gridHelper.position.set(c.x||0,c.y||0,c.z||0)}),a.start()}function ku({x:n,y:e,z:o,size:i,divisions:t,color:a,gridHelper:s}){this.scene.remove(this.gridHelper),this.gridHelper.geometry.dispose(),this.gridHelper.material.dispose(),this.gridHelper=new vt(i,t,a,a),this.gridHelper.position.set(n,e,o),this.gridHelper.material.linewidth=.1,this.gridHelper.material.color.set(a),this.gridHelper.visible=s,this.scene.add(this.gridHelper)}function Ru({axesHelper:n,axesSize:e}){this.scene.remove(this.axesHelper),this.axesHelper.geometry.dispose(),this.axesHelper.material.dispose(),this.axesHelper=new Ln(e),this.axesHelper.position.set(0,-.5,0),this.axesHelper.visible=n,this.scene.add(this.axesHelper)}const Vu={onSetModelHelper:Su,onSetModelRotateOnAxis:Cu,onResultModelRotateOnAxis:Lu,onSetModelPosition:Tu,onResultModelPosition:Eu,onResetModelCamera:Au,onGetModelCamera:Iu,onSetModelGridHelper:Pu,onSetModelGridHelperSize:ku,onSetModelAxesHelper:Ru},Fu=we();function $u(n){const e=this.scene.getObjectByProperty("uuid",n);this.modelMaterialList=this.modelMaterialList.filter(o=>o.uuid!=n),this.glowMaterialList=this.modelMaterialList.map(o=>o.name),e.clear(),this.geometryGroup.remove(e)}function Uu(n,e){const o=Fu.selectMesh.uuid,i=this.scene.getObjectByProperty("uuid",o),t=Object.keys(n).map(s=>n[s]),a=new Nt[e](...t);i.geometry=a}const Du={onDeleteGeometryMesh:$u,onSetGeometryMesh:Uu};function Hu(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!zn(n)}function Ou(n){this.dragTag=n,this.dragTag.id=Tn(4,7)}function zu(){const{clientHeight:n,clientWidth:e,offsetLeft:o,offsetTop:i}=this.container,{clientX:t,clientY:a,name:s}=this.dragTag;this.mouse.x=(t-o)/e*2-1,this.mouse.y=-((a-i)/n)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const c=this.raycaster.intersectObjects(this.scene.children,!0);if(c.length>0){let d=document.createElement("div");const p="rgba(0,127,127,"+(Math.random()*.5+.25)+")",h=this.dragTagList.length+1,S=Dn({render(){let g;return r("div",null,[r("div",{className:"element-tag",style:{width:"60px",height:"40px",fontSize:"6px",color:"#ffffffbf",backgroundColor:p}},[r("span",{className:"tag-txt"},[`标签-${h}`])]),r("div",{className:"tag-icon"},[r(Hn,null,Hu(g=On(_n[s]))?g:{default:()=>[g]})])])}}).mount(document.createElement("div"));d.appendChild(S.$el);let M=new wo(d);const{x:_,y:v,z:b}=c[0].point;M.position.set(_,v,b),M.scale.set(.01,.01,.01);const{uuid:T,position:C,element:{innerText:I}}=M,P={uuid:T,positionX:C.x,positionY:C.y,positionZ:C.z,innerText:I,width:60,height:40,fontSize:6,backgroundColor:p,color:"#ffffffbf",iconColor:"#fff",iconSize:12,iconName:s,hover:!1};this.dragTagList.length==0&&this.container.appendChild(this.css3DRenderer.domElement),this.dragTagList.push(P),this.scene.add(M)}else ce.warning("当前角度无法获取鼠标位置请调整“相机角度”在添加")}function Nu(){if(this.dragTagList.length==0)return!1;this.dragTagList.forEach(n=>{const e=this.scene.getObjectByProperty("uuid",n.uuid);this.scene.remove(e);var o=e.element;o&&o.parentNode&&o.parentNode.removeChild(o)}),this.dragTagList=[],this.container.removeChild(this.css3DRenderer.domElement)}function Gu(n){const e=this.scene.getObjectByProperty("uuid",n);this.scene.remove(e);var o=e.element;if(o&&o.parentNode&&o.parentNode.removeChild(o),this.dragTagList=this.dragTagList.filter(i=>i.uuid!=n),this.dragTagList.length==0)return this.container.removeChild(this.css3DRenderer.domElement),!1}function Bu(n){const e=this.scene.getObjectByProperty("uuid",n.uuid);if(e){const o=e.element.querySelector(".element-tag"),i=e.element.querySelector(".tag-icon"),t=e.element.querySelector(".tag-txt"),{height:a,backgroundColor:s,width:c,fontSize:d,color:p,innerText:h,iconColor:m,iconSize:S,positionY:M,positionX:_,positionZ:v}=n;o.style.height=a+"px",o.style.backgroundColor=s,o.style.boxShadow=`0px 0px 4px ${s}`,o.style.width=c+"px",o.style.fontSize=d+"px",o.style.color=p,t.innerText=h,i.style.fontSize=S+"px",i.style.color=m;const b=new Xe.Tween(e.position),T={x:_,y:M,z:v};b.to(T,500),b.onUpdate(I=>{e.position.set(I.x||0,I.y||0,I.z||0)}),b.start();const C=this.dragTagList.find(I=>I.uuid==n.uuid);Object.assign(C,n)}}const ju={create3dTags:zu,setDragTag:Ou,clearSceneTags:Nu,deleteTag:Gu,updateTagElement:Bu},Yu={...xd,...Ud,...ru,...mu,...Mu,...Vu,...Du,...ju};class Vn{constructor(e){this.container=document.querySelector(e),this.camera,this.scene=null,this.renderer,this.controls,this.model,this.geometryGroup=new xo,this.geometryModel,this.loadingManager=new bo,this.fileLoaderMap={glb:new Et,fbx:new Mo(this.loadingManager),gltf:new Et,obj:new So(this.loadingManager),stl:new Co},this.modelAnimation,this.animationMixer,this.animationColock=new Lo,this.animationFrame=null,this.rotationAnimationFrame=null,this.animateClipAction=null,this.loopMap={LoopOnce:To,LoopRepeat:Eo,LoopPingPong:Ao},this.skeletonHelper,this.gridHelper,this.axesHelper,this.ambientLight,this.directionalLight,this.directionalLightHelper,this.pointLight,this.pointLightHelper,this.spotLight,this.spotLightHelper,this.planeGeometry,this.modelMaterialList=[],this.originalMaterials=new Map,this.effectComposer,this.outlinePass,this.renderAnimation=null,this.raycaster=new Sn,this.mouse=new At,this.glowComposer,this.glowRenderPass,this.unrealBloomPass,this.shaderPass,this.glowMaterialList,this.materials={},this.transformControls,this.glowUnrealBloomPass=!1,this.onWindowResizesListener,this.onMouseClickListener,this.modelProgressCallback=o=>o,this.dragGeometryModel={},this.loadingStatus=!0,this.css3DRenderer=null,this.css3dControls=null,this.dragTag={},this.dragTagList=[]}init(){return new Promise(async(e,o)=>{this.initRender(),this.initCamera(),this.initScene(),this.initControls(),this.createHelper(),this.createLight(),this.addEvenListMouseLisatener();const i=await this.setModel({filePath:"threeFile/glb/glb-9.glb",fileType:"glb",decomposeName:"transformers_3"});this.createEffectComposer(),this.sceneAnimation(),e(i)})}async initScene(){this.scene=new Ge;const e=new Ae().load(Ne("image/view-4.png"));e.mapping=Ot,this.scene.background=e,this.scene.environment=e,this.scene.backgroundIntensity=1,this.scene.backgroundBlurriness=1,e.dispose()}initCamera(){const{clientHeight:e,clientWidth:o}=this.container;this.camera=new wn(50,o/e,1,2e3)}initRender(){this.renderer=new xn({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio);const{clientHeight:e,clientWidth:o}=this.container;this.renderer.setSize(o,e),this.renderer.toneMapping=Io,this.renderer.autoClear=!0,this.renderer.outputColorSpace=at,this.renderer.toneMappingExposure=2,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Po,this.container.appendChild(this.renderer.domElement),this.css3DRenderer=new ko,this.css3DRenderer.setSize(o,e),this.css3DRenderer.domElement.style.position="absolute",this.css3DRenderer.domElement.style.pointerEvents="none",this.css3DRenderer.domElement.style.top=0}async openCameraAR(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){let e=document.getElementById("video");const o={video:{width:1280,height:720,facingMode:"user"}};navigator.mediaDevices.getUserMedia(o).then(function(i){e.srcObject=i,e.play()}).catch(function(i){console.error("Unable to access the camera/webcam.",i)})}else alert("MediaDevices interface not available"),console.error("MediaDevices interface not available.")}sceneAnimation(){this.renderAnimation=requestAnimationFrame(()=>this.sceneAnimation()),this.loadingStatus&&(this.glowUnrealBloomPass?this.setMeshFlow():(this.effectComposer.render(),this.controls.update()),Xe.update(),this.dragTagList.length&&(this.css3DRenderer.render(this.scene,this.camera),this.css3dControls.update()))}addEvenListMouseLisatener(){this.onWindowResizesListener=this.onWindowResizes.bind(this),window.addEventListener("resize",this.onWindowResizesListener),this.onMouseClickListener=this.onMouseClickModel.bind(this),this.container.addEventListener("click",this.onMouseClickListener)}initControls(){this.controls=new Zt(this.camera,this.renderer.domElement),this.controls.enablePan=!1,this.controls.enableDamping=!0,this.controls.target.set(0,0,0),this.controls.update(),this.css3dControls=new Zt(this.camera,this.css3DRenderer.domElement),this.css3dControls.enablePan=!1,this.css3dControls.enableDamping=!0,this.css3dControls.target.set(0,0,0),this.css3dControls.update()}setModel({filePath:e,fileType:o,decomposeName:i}){return new Promise((t,a)=>{this.loadingStatus=!1;let s;if(["glb","gltf"].includes(o)){const c=new Ro;c.setDecoderPath("draco/gltf/"),c.setDecoderConfig({type:"js"}),c.preload(),s=new Et().setDRACOLoader(c)}else s=this.fileLoaderMap[o];s.load(e,c=>{switch(o){case"glb":this.model=c.scene,this.skeletonHelper=new ht(c.scene);break;case"fbx":this.model=c,this.skeletonHelper=new ht(c);break;case"gltf":this.model=c.scene,this.skeletonHelper=new ht(c.scene);break;case"obj":this.model=c,this.skeletonHelper=new ht(c);break;case"stl":const d=new Ze,p=new N(c,d);this.model=p;break}this.model.decomposeName=i,this.getModelMeaterialList(),this.setModelPositionSize(),this.skeletonHelper.visible=!1,this.scene.add(this.skeletonHelper),this.glowMaterialList=this.modelMaterialList.map(d=>d.name),this.scene.add(this.model),this.loadingStatus=!0,t(!0),this.getModelAnimaionList(c)},c=>{this.modelProgressCallback(c.loaded)},c=>{ce.error("文件错误"),console.log(c),t(!0)})})}setMeshFlow(){this.scene.traverse(e=>{e instanceof vt&&(this.materials.gridHelper=e.material,e.material=new Ze({color:"#000"})),e instanceof Ge&&(this.materials.scene=e.background,this.materials.environment=e.environment,e.background=null,e.environment=null),!this.glowMaterialList.includes(e.name)&&e.isMesh&&(this.materials[e.uuid]=e.material,e.material=new Ze({color:"#000"}))}),this.glowComposer.render(),this.scene.traverse(e=>{this.materials[e.uuid]&&(e.material=this.materials[e.uuid],delete this.materials[e.uuid]),e instanceof vt&&(e.material=this.materials.gridHelper,delete this.materials.gridHelper),e instanceof Ge&&(e.background=this.materials.scene,e.environment=this.materials.environment,delete this.materials.scene,delete this.materials.environment)}),this.effectComposer.render(),this.controls.update()}setGeometryModel(e){return new Promise((o,i)=>{const{clientHeight:t,clientWidth:a,offsetLeft:s,offsetTop:c}=this.container;this.mouse.x=(e.clientX-s)/a*2-1,this.mouse.y=-((e.clientY-c)/t)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const d=this.raycaster.intersectObjects(this.scene.children,!0);if(d.length>0){const{type:p}=e,h=["id","name","modelType","type"],m=Object.keys(e).filter(E=>!h.includes(E)).map(E=>e[E]),S=new Nt[p](...m),_=["#FF4500","#90EE90","#00CED1","#1E90FF","#C71585","#FF4500","#FAD400","#1F93FF","#90F090","#C71585"][Math.ceil(Math.random()*10)],v=new Ze({color:new he(_),side:rt}),b=new N(S,v),{x:T,y:C,z:I}=d[0].point;b.position.set(T,C,I);const P=b.clone();Object.assign(b.userData,{rotation:P.rotation,scale:P.scale,position:P.position}),b.name=p+"_"+Tn(4,5),b.userData.geometry=!0,this.geometryGroup.add(b),this.model=this.geometryGroup,this.onSetGeometryMeshList(b),this.skeletonHelper.visible=!1,this.skeletonHelper.dispose(),this.glowMaterialList=this.modelMaterialList.map(E=>E.name),this.setModelMeshDrag({transformType:!0}),this.scene.add(this.model);const f=new zt().setFromObject(this.model).getSize(new Q);this.controls.maxDistance=f.length()*10,this.loadingStatus=!0,o(!0)}else ce.warning("当前角度无法获取鼠标位置请调整“相机角度”在添加")})}onProgress(e){typeof e=="function"&&(this.modelProgressCallback=e)}createHelper(){this.gridHelper=new vt(6,18,"#fff","rgb(193,193,193)"),this.gridHelper.position.set(0,-.59,-.1),this.gridHelper.visible=!1,this.scene.add(this.gridHelper),this.axesHelper=new Ln(2),this.axesHelper.visible=!1,this.scene.add(this.axesHelper),this.renderer.shadowMap.enabled=!0}createLight(){this.ambientLight=new Vo("#fff",.8),this.ambientLight.visible=!0,this.scene.add(this.ambientLight),this.directionalLight=new Fo("#fff",5),this.directionalLight.position.set(-1.44,2.2,1),this.directionalLight.castShadow=!0,this.directionalLight.visible=!1,this.scene.add(this.directionalLight),this.directionalLightHelper=new $o(this.directionalLight,.3),this.directionalLightHelper.visible=!1,this.scene.add(this.directionalLightHelper),this.pointLight=new Uo(16711680,5,100),this.pointLight.visible=!1,this.scene.add(this.pointLight),this.pointLightHelper=new Do(this.pointLight,.5),this.pointLightHelper.visible=!1,this.scene.add(this.pointLightHelper),this.spotLight=new Ho("#00BABD",900),this.spotLight.visible=!1,this.spotLight.map=new Ae().load(Ne("image/model-bg-1.jpg")),this.spotLight.map=new Ae().load(Ne("image/model-bg-1.jpg")),this.spotLight.decay=2,this.spotLight.shadow.mapSize.width=1920,this.spotLight.shadow.mapSize.height=1080,this.spotLight.shadow.camera.near=1,this.spotLight.shadow.camera.far=10,this.scene.add(this.spotLight),this.spotLightHelper=new Oo(this.spotLight),this.spotLightHelper.visible=!1,this.scene.add(this.spotLightHelper);const e=new bt(4,4);var o=new Ze({color:"#000000"});this.planeGeometry=new N(e,o),this.planeGeometry.rotation.x=-Math.PI/2,this.planeGeometry.position.set(0,-1.2,0),this.planeGeometry.receiveShadow=!0,this.planeGeometry.visible=!1,this.scene.add(this.planeGeometry)}createEffectComposer(){if(!this.container)return!1;const{clientHeight:e,clientWidth:o}=this.container;this.effectComposer=new Qt(this.renderer,new qt(o,e));const i=new Kt(this.scene,this.camera);this.effectComposer.addPass(i),this.outlinePass=new zo(new At(o,e),this.model,this.camera),this.outlinePass.visibleEdgeColor=new he("#FF8C00"),this.outlinePass.hiddenEdgeColor=new he("#8a90f3"),this.outlinePass.edgeGlow=2,this.outlinePass.usePatternTexture=!1,this.outlinePass.edgeThickness=1,this.outlinePass.edgeStrength=4,this.outlinePass.pulsePeriod=200,this.effectComposer.addPass(this.outlinePass);let t=new No;this.effectComposer.addPass(t);let a=new Jt(Go);const s=this.renderer.getPixelRatio();a.uniforms.resolution.value.set(1/(o*s),1/(e*s)),a.renderToScreen=!0,a.needsSwap=!0,this.effectComposer.addPass(a),this.unrealBloomPass=new Bo(new At(o,e),1.5,.4,.85);const c={minFilter:Se,format:Mn,stencilBuffer:!1},d=new qt(o*2,e*2,c);this.glowComposer=new Qt(this.renderer,d),this.glowComposer.renderToScreen=!1,this.glowRenderPass=new Kt(this.scene,this.camera),this.glowComposer.addPass(this.glowRenderPass),this.glowComposer.addPass(this.unrealBloomPass),this.shaderPass=new Jt(new vn({uniforms:{baseTexture:{value:null},bloomTexture:{value:this.glowComposer.renderTarget2.texture},tDiffuse:{value:null},glowColor:{value:null}},vertexShader:jo,fragmentShader:Yo,defines:{}}),"baseTexture"),this.shaderPass.material.uniforms.glowColor.value=new he,this.shaderPass.renderToScreen=!0,this.shaderPass.needsSwap=!0,this.shaderPass.name="ShaderColor"}onSwitchModel(e){return new Promise(async(o,i)=>{try{if(e.modelType&&e.modelType=="geometry"){this.modelAnimation=[],this.camera.fov=80,this.camera.updateProjectionMatrix();const t=await this.setGeometryModel(e);this.outlinePass.renderScene=this.geometryGroup,o()}else{this.clearSceneModel(),this.onResettingLight({ambientLight:!0}),this.camera.fov=50,this.geometryGroup.clear();const t=await this.setModel(e);this.outlinePass.renderScene=this.model,o({load:t,filePath:e.filePath})}}catch{i()}})}onWindowResizes(){if(!this.container)return!1;const{clientHeight:e,clientWidth:o}=this.container;if(this.camera.aspect=o/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(o,e),this.css3DRenderer.setSize(o,e),this.effectComposer){var i=this.effectComposer.passes[3];const t=this.renderer.getPixelRatio();i.uniforms.resolution.value.set(1/(o*t),1/(e*t)),this.effectComposer.setSize(o,e)}this.glowComposer&&this.glowComposer.setSize(o,e)}onDownloadScenCover(){var e=document.createElement("a"),o=this.renderer.domElement;e.href=o.toDataURL("image/png"),e.download=`${new Date().toLocaleString()}.png`,e.click(),ce.success("下载成功")}onExporterModel(e){const o=new Bt,i={trs:!0,animations:this.modelAnimation,binary:e=="glb",embedImages:!0,onlyVisible:!0,includeCustomExtensions:!0};o.parse(this.scene,function(t){t instanceof ArrayBuffer?a(t,`${new Date().toLocaleString()}.glb`):s(JSON.stringify(t),`${new Date().toLocaleString()}.gltf`);function a(c,d){const p=new Blob([c],{type:"application/octet-stream"}),h=URL.createObjectURL(p),m=document.createElement("a");m.href=h,m.download=d,m.click(),URL.revokeObjectURL(h),ce.success("导出成功")}function s(c,d){const p=new Blob([c],{type:"application/json"}),h=URL.createObjectURL(p),m=document.createElement("a");m.href=h,m.download=d,m.click(),URL.revokeObjectURL(h),ce.success("导出成功")}},t=>{ce.error(t)},i)}onClearModelData(){cancelAnimationFrame(this.rotationAnimationFrame),cancelAnimationFrame(this.renderAnimation),cancelAnimationFrame(this.animationFrame),this.container.removeEventListener("click",this.onMouseClickListener),window.removeEventListener("resize",this.onWindowResizesListener),this.scene.traverse(e=>{e.type==="Mesh"&&(e.geometry.dispose(),e.material.dispose())}),this.scene.clear(),this.renderer.dispose(),this.renderer.clear(),this.container=null,this.camera=null,this.scene=null,this.renderer=null,this.controls=null,this.model=null,this.geometryModel=null,this.fileLoaderMap=null,this.modelAnimation=null,this.animationMixer=null,this.animationColock=null,this.animationFrame=null,this.rotationAnimationFrame=null,this.animateClipAction=null,this.loopMap=null,this.skeletonHelper=null,this.gridHelper=null,this.axesHelper=null,this.ambientLight=null,this.directionalLight=null,this.directionalLightHelper=null,this.pointLight=null,this.pointLightHelper=null,this.spotLight=null,this.spotLightHelper=null,this.planeGeometry=null,this.modelMaterialList=[],this.originalMaterials.clear(),this.effectComposer=null,this.outlinePass=null,this.renderAnimation=null,this.raycaster=null,this.mouse=null,this.glowComposer&&(this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose()),this.glowComposer=null,this.unrealBloomPass=null,this.shaderPass=null,this.glowMaterialList=null,this.materials=null,this.transformControls=null,this.dragGeometryModel=null,this.glowUnrealBloomPass=!1}clearSceneModel(){this.scene.traverse(o=>{o.type==="Mesh"&&(o.geometry.dispose(),o.material.dispose())}),this.dragGeometryModel={},cancelAnimationFrame(this.animationFrame),cancelAnimationFrame(this.rotationAnimationFrame),this.scene.remove(this.model),this.model=null,this.glowUnrealBloomPass=!1,this.glowMaterialList=[],this.modelMaterialList=[],this.originalMaterials.clear(),this.materials={},this.transformControls&&(this.transformControls.detach(),this.transformControls.dispose(),this.scene.remove(this.transformControls),this.transformControls=null),this.glowComposer&&(this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose()),this.effectComposer&&this.effectComposer.removePass(this.shaderPass),this.renderer.toneMappingExposure=2,this.outlinePass.selectedObjects=[],Object.assign(this.unrealBloomPass,{threshold:0,strength:0,radius:0}),this.shaderPass.material.uniforms.glowColor.value=new he,this.skeletonHelper.visible=!1;const e={gridHelper:!1,x:0,y:-.59,z:-.1,positionX:0,positionY:-1,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8};this.onResettingLight({ambientLight:!1}),this.onSetModelGridHelper(e),this.onSetModelGridHelperSize(e),this.onSetModelAxesHelper(e),this.clearSceneTags()}setDragGeometryModel(e){this.dragGeometryModel=e}}Object.assign(Vn.prototype,{...Yu});const Fn=n=>(Fe("data-v-92d2f21e"),n=n(),$e(),n),Xu={key:0,id:"loading-mark"},Wu={class:"loading-box"},Zu={class:"loading"},Qu=Fn(()=>l("img",{src:Nn},null,-1)),qu={class:"progress-txt"},Ku=Fn(()=>l("div",{class:"loading-txt"}," 模型文件首次加载时间较长请耐心等待..... ",-1)),Ju={__name:"PageLoading",props:{percentage:{type:Number,default:0},loading:{type:Boolean,default:!1}},setup(n){const e=n;return(o,i)=>e.loading?(H(),q("div",Xu,[l("div",Wu,[l("div",Zu,[Qu,l("div",qu,[F(" 当前模型已加载 "),l("b",null,xe(e.percentage),1),F(" M ")]),Ku])])])):ye("",!0)}},ep=Le(Ju,[["__scopeId","data-v-92d2f21e"]]),St=n=>(Fe("data-v-c5f7a6c5"),n=n(),$e(),n),tp={class:"model-page"},np={class:"model-header"},op={class:"header-lf"},sp=St(()=>l("span",null," 基于Three.js+Vue3+Element-Plus开发的3d模型可视化编辑系统 ",-1)),ip=St(()=>l("span",null,"作者:answer ",-1)),ap={class:"header-lr"},rp={class:"model-container"},lp={class:"camera-icon"},cp=St(()=>l("div",{id:"mesh-txt"},null,-1)),dp={class:"edit-panel",style:{minWidth:"380px"}},up=St(()=>l("video",{id:"video",loop:"loop",playsinline:"",autoplay:"",style:{display:"none"}},null,-1)),pp={__name:"index",setup(n){const e=we(),o=Bn(),{$bus:i,$local:t}=Ue().proxy,a=ee(!1),s=ee(0),c=ee(null),d=ee(null),p=ee(null),h=ee(!1),m=te(()=>{if(c.value){const f=d.value.activeModel;return!!(f!=null&&f.filePath)}return!1}),S=()=>{e.modelApi.onResetModelCamera()},M=()=>{const f=t.get(mt);if(!Array.isArray(f)){let E=[];$t.forEach(x=>{E.push({...Xo,fileInfo:{...x}})}),t.set(mt,E)}},_=f=>{const{dragGeometryModel:E,dragTag:x}=e.modelApi,{clientX:y,clientY:L}=f;E.id&&e.dragType=="geometry"&&(E.clientX=y,E.clientY=L,e.modelApi.onSwitchModel(E)),x.id&&e.dragType=="tags"&&(x.clientX=y,x.clientY=L,e.modelApi.create3dTags(x))},v=()=>{const f=c.value.getPanelConfig();if(f.camera=e.modelApi.onGetModelCamera(),f.fileInfo=d.value.activeModel,f.fileInfo.filePath){t.set(Wo,f);const{href:E}=o.resolve({path:"/preview"});window.open(E,"_blank")}else ce.warning("当前模型暂不支持“效果预览”")},b=()=>{const f=c.value.getPanelConfig();f.camera=e.modelApi.onGetModelCamera(),f.fileInfo=d.value.activeModel,p.value.showDialog(f)},T=()=>{const f=document.documentElement;h.value?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen&&f.webkitRequestFullscreen()},C=()=>{jn.confirm(" 确认要更新当前模型数据至“模板库”?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"success"}).then(()=>{const f=c.value.getPanelConfig();if(f.camera=e.modelApi.onGetModelCamera(),f.fileInfo=d.value.activeModel,f.fileInfo.filePath){const E=t.get(mt)||[],{id:x}=f.fileInfo;Object.assign(E.filter(y=>x===y.fileInfo.id)[0],f),t.set(mt,E),ce.success("更新成功")}else ce.warning("当前模型暂不支持“数据保存”")}).catch(()=>{})},I=()=>{e.modelApi.onDownloadScenCover()},P=f=>{e.modelApi.onExporterModel(f)},g=f=>{const E=document.fullscreenElement||document.webkitFullscreenElement;h.value=!!E};return Be(async()=>{a.value=!0;const f=new Vn("#model");e.setModelApi(f),i.on("page-loading",x=>{a.value=x}),e.modelApi.onProgress(x=>{s.value=Number((x/1024/1024).toFixed(2))}),await f.init()&&(a.value=!1,s.value=0),M(),document.addEventListener("fullscreenchange",g)}),Gn(()=>{e.modelApi.onClearModelData(),document.removeEventListener("fullscreenchange",g)}),(f,E)=>{const x=w("el-button"),y=w("el-icon"),L=w("el-dropdown-item"),V=w("el-dropdown-menu"),A=w("el-dropdown"),G=w("el-space"),R=w("Aim"),U=w("el-tooltip");return H(),q("div",tp,[l("header",np,[l("div",op,[sp,ip,l("span",null,"当前Three.js版本:"+xe(bn),1)]),l("div",ap,[r(G,null,{default:u(()=>[r(x,{type:"primary",icon:"Film",onClick:E[0]||(E[0]=D=>f.$router.push({path:"/modelBase"}))},{default:u(()=>[F(" 模型库 ")]),_:1}),m.value?(H(),ne(x,{key:0,type:"primary",icon:"Document",onClick:C},{default:u(()=>[F("保存数据")]),_:1})):ye("",!0),m.value?(H(),ne(x,{key:1,type:"primary",icon:"View",onClick:v},{default:u(()=>[F("效果预览")]),_:1})):ye("",!0),r(A,{trigger:"click"},{dropdown:u(()=>[r(V,null,{default:u(()=>[r(L,{onClick:I},{default:u(()=>[F("下载封面")]),_:1}),r(L,{onClick:E[1]||(E[1]=D=>P("glb"))},{default:u(()=>[F("导出模型(.glb)格式")]),_:1}),r(L,{onClick:E[2]||(E[2]=D=>P("gltf"))},{default:u(()=>[F("导出模型(.gltf)格式")]),_:1})]),_:1})]),default:u(()=>[r(x,{type:"primary",icon:"Download"},{default:u(()=>[F(" 下载/导出"),r(y,{class:"el-icon--right"})]),_:1})]),_:1}),m.value?(H(),ne(x,{key:2,type:"primary",icon:"HelpFilled",onClick:b},{default:u(()=>[F(" 嵌入代码 ")]),_:1})):ye("",!0),r(x,{type:"primary",icon:"FullScreen",onClick:T},{default:u(()=>[F(xe(h.value?"取消全屏":"全屏"),1)]),_:1})]),_:1})])]),l("div",rp,[r(re(Hc),{ref_key:"choosePanel",ref:d},null,512),l("div",{id:"model",onDrop:_,ref:"model",onDragover:E[3]||(E[3]=it(()=>{},["prevent"]))},[l("div",lp,[r(U,{effect:"dark",content:"居中",placement:"top"},{default:u(()=>[r(y,{size:18,color:"#fff",onClick:S},{default:u(()=>[r(R)]),_:1})]),_:1})]),cp],544),l("div",dp,[re(e).modelApi.model?(H(),ne(re(hc),{key:0,ref_key:"editPanel",ref:c},null,512)):ye("",!0)])]),up,r(ep,{loading:a.value,percentage:s.value},null,8,["loading","percentage"]),r(re(jc),{ref_key:"implantDialog",ref:p},null,512)])}}},gp=Le(pp,[["__scopeId","data-v-c5f7a6c5"]]);export{gp as default};

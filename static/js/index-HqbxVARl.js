import{d as _n,_ as Le,e as he,f as te,g as ee,r as v,h as yn,i as ie,o as O,j as Q,k as r,l as a,w as u,m as V,v as le,F as pe,n as ge,u as ce,c as ne,p as Y,E as re,q as Pe,s as ke,t as Re,x as Oe,y as vn,z as Xe,A as ye,b as ve,B as wn,a as xn,C as Yt,D as Mn,G as zn,H as Hn,I as Nn,J as Gn,L as Bn,M as jn,N as Yn,O as Xn,P as Wn}from"./main-2rZIAjPF.js";import{g as je,b as Zn,v as Qn,P as We,a as zt,m as Xt,c as qn,C as de,d as Ft,e as Kn,I as Jn,f as bt,S as bn,U as eo,h as at,M as N,i as Sn,j as Ye,W as Cn,k as to,R as Ln,V as q,l as Tt,n as no,N as oo,o as Ut,p as Tn,D as lt,B as Ue,q as xt,r as so,s as St,t as io,u as ao,w as lo,x as ro,L as Se,y as co,z as uo,A as po,E as ho,F as it,Q as Me,G as mo,H as dt,J as Et,K as ut,O as fo,T as Ae,X as Ht,Y as go,Z as _o,_ as Mt,$ as Nt,a0 as En,a1 as Ot,a2 as yo,a3 as An,a4 as vo,a5 as _e,a6 as fe,a7 as Wt,a8 as Zt,a9 as pt,aa as Te,ab as wo,ac as Qe,ad as At,ae as Gt,af as xo,ag as Mo,ah as vt,ai as In,aj as Pn,ak as bo,al as Qt,am as So,an as ht,ao as Co,ap as Lo,aq as To,ar as Eo,as as Ao,at as Io,au as Po,av as It,aw as ko,ax as Ro,ay as Vo,az as qt,aA as Kt,aB as Ne,aC as $o,aD as Do,aE as Fo,aF as Uo,aG as Oo,aH as zo,aI as Ho,aJ as Jt,aK as en,aL as tn,aM as No,aN as Go,aO as nn,aP as Bo,aQ as jo,aR as Yo,aS as Xo,aT as mt,aU as Wo,aV as Zo}from"./CSS3DRenderer-ExBz_HNT.js";const xe=_n("useMeshEditStore",{state:()=>({modelApi:{},selectMesh:{},modelType:"oneModel"}),getters:{selectMeshUuid:o=>o.selectMesh.uuid},actions:{setModelApi(o){this.modelApi=o},selectMeshAction(o){this.selectMesh=o},changeDragType(o){this.modelType=o}}});_n("useIndexedDBStore",{state:()=>({db:{}}),getters:{},actions:{setDbApi(o){this.db=o}}});const ze=o=>(Pe("data-v-ce292eda"),o=o(),ke(),o),Qo={class:"edit-box"},qo={class:"header"},Ko=ze(()=>r("span",null,"背景",-1)),Jo={class:"icon-name"},es=ze(()=>r("span",null," 图片",-1)),ts={class:"action-txt"},ns={class:"check"},os={class:"icon-name"},ss=ze(()=>r("span",null," 颜色",-1)),is={class:"action"},as={class:"check"},ls={class:"icon-name"},rs=ze(()=>r("span",null," 全景图",-1)),cs={class:"action-txt"},ds={class:"check"},us={class:"option"},ps={class:"icon-name"},hs=ze(()=>r("span",null,"外部资源",-1)),ms={class:"texture-add"},fs={class:"icon"},gs=ze(()=>r("span",null,"加载外部全景图",-1)),_s={class:"texture-add"},ys={class:"icon"},vs=ze(()=>r("span",null,"加载外部视频",-1)),ws={class:"options"},xs={class:"option"},Ms={class:"grid-txt"},bs={class:"grid-silder"},Ss={class:"option"},Cs={class:"grid-txt"},Ls={class:"grid-silder"},Ts={__name:"EditBackground",setup(o,{expose:e}){const n=xe(),i=he({visible:!0,type:3,image:je("image/model-bg-3.jpg"),viewImg:je("image/view-4.png"),color:"#000",blurriness:1,intensity:1}),t=te(!1),l=te(3),s=te(3),c=ee(()=>{const{visible:T}=i;return T?"":"disabled"}),d=We,p=T=>{switch(Object.assign(i,{type:T,intensity:1,blurriness:1}),T){case 1:n.modelApi.onSetSceneColor(i.color);break;case 2:n.modelApi.onSetSceneImage(i.image);break;case 3:n.modelApi.onSetSceneViewImage(i);break}},m=({id:T,url:A})=>{i.image=A,l.value=T,n.modelApi.onSetSceneImage(A)},h=async({id:T,url:A})=>{try{t.value=!0,i.viewImg=A,s.value=T,await n.modelApi.onSetSceneViewImage(i)}finally{t.value=!1,re.success("操作成功")}},w=async T=>{const A=URL.createObjectURL(T.raw);await n.modelApi.onSetStorageViewImage(A,zt(T.name)),URL.revokeObjectURL(A),re.success("操作成功")},x=async T=>{await n.modelApi.onSetStorageViewVideo(T),re.success("操作成功")},f=T=>{i.color=T,n.modelApi.onSetSceneColor(i.color)},S=()=>{n.modelApi.onSetSceneColor(i.color)},L=()=>{n.modelApi.onSetSceneViewConfig(i)},C=()=>{const{type:T,visible:A,image:y,viewImg:E}=i;if(!A)return n.modelApi.onSetSceneColor("#000");switch(T){case 1:n.modelApi.onSetSceneColor(i.color);break;case 2:n.modelApi.onSetSceneImage(y);break;case 3:n.modelApi.onSetSceneViewImage(i);break}};return e({config:i}),(T,A)=>{const y=v("el-switch"),E=v("Picture"),_=v("el-icon"),M=v("el-space"),b=v("el-button"),g=v("Check"),I=v("el-image"),P=v("el-col"),R=v("el-row"),G=v("el-scrollbar"),F=v("DataAnalysis"),U=v("el-color-picker"),k=v("CameraFilled"),j=v("UploadFilled"),se=v("el-tooltip"),X=v("el-upload"),J=v("VideoCameraFilled"),D=v("el-slider"),B=yn("zLoading");return ie((O(),Q("div",Qo,[r("div",qo,[Ko,a(y,{modelValue:i.visible,"onUpdate:modelValue":A[0]||(A[0]=$=>i.visible=$),onChange:C},null,8,["modelValue"])]),r("div",{class:Y(["options",c.value])},[r("div",{class:"option",onClick:A[1]||(A[1]=$=>p(2))},[a(M,null,{default:u(()=>[r("div",Jo,[a(M,null,{default:u(()=>[a(_,null,{default:u(()=>[a(E)]),_:1}),es]),_:1})]),r("div",ts,[a(b,{type:"primary",link:""},{default:u(()=>[V("选择图片")]),_:1})]),ie(r("div",ns,[a(_,{size:"20px",color:"#2a3ff6"},{default:u(()=>[a(g)]),_:1})],512),[[le,i.type==2]])]),_:1})]),ie(a(G,{"max-height":"250px"},{default:u(()=>[a(R,null,{default:u(()=>[(O(!0),Q(pe,null,ge(ce(Zn),$=>(O(),ne(P,{style:{textAlign:"center"},span:6,key:$.id},{default:u(()=>[a(I,{onClick:z=>m($),class:Y(["el-img",l.value==$.id?"active":""]),src:$.url,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1})]),_:1},512),[[le,i.type==2]])],2),r("div",{class:Y(["options",c.value])},[r("div",{class:"option",onClick:A[3]||(A[3]=$=>p(1))},[a(M,null,{default:u(()=>[r("div",os,[a(M,null,{default:u(()=>[a(_,null,{default:u(()=>[a(F)]),_:1}),ss]),_:1})]),r("div",is,[a(U,{predefine:ce(d),onChange:S,onActiveChange:f,modelValue:i.color,"onUpdate:modelValue":A[2]||(A[2]=$=>i.color=$)},null,8,["predefine","modelValue"])]),ie(r("div",as,[a(_,{size:"20px",color:"#2a3ff6"},{default:u(()=>[a(g)]),_:1})],512),[[le,i.type==1]])]),_:1})])],2),r("div",{class:Y(["options",c.value])},[r("div",{class:"option",onClick:A[4]||(A[4]=$=>p(3))},[a(M,null,{default:u(()=>[r("div",ls,[a(M,null,{default:u(()=>[a(_,null,{default:u(()=>[a(k)]),_:1}),rs]),_:1})]),r("div",cs,[a(b,{type:"primary",link:""},{default:u(()=>[V("选择图片")]),_:1})]),ie(r("div",ds,[a(_,{size:"20px",color:"#2a3ff6"},{default:u(()=>[a(g)]),_:1})],512),[[le,i.type==3]])]),_:1})]),ie(a(G,{"max-height":"600px"},{default:u(()=>[a(R,null,{default:u(()=>[(O(!0),Q(pe,null,ge(ce(Qn),$=>(O(),ne(P,{span:6,style:{textAlign:"center"},key:$.id},{default:u(()=>[a(I,{onClick:z=>h($),class:Y(["el-view",s.value==$.id?"active":""]),src:$.url,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1024))),128))]),_:1}),ie(a(R,null,{default:u(()=>[a(P,null,{default:u(()=>[r("div",us,[r("div",ps,[a(M,null,{default:u(()=>[hs]),_:1})])])]),_:1}),a(P,{span:10,offset:4},{default:u(()=>[a(M,{spacer:"20"},{default:u(()=>[a(X,{action:"",accept:".jpg,.png,.hdr","show-file-list":!1,"auto-upload":!1,"on-change":w},{default:u(()=>[r("div",ms,[r("div",fs,[a(se,{effect:"dark",content:"该功能仅作预览，数据无法保存",placement:"top"},{default:u(()=>[a(_,{size:"60"},{default:u(()=>[a(j)]),_:1})]),_:1}),gs])])]),_:1}),a(X,{action:"",accept:".mp4","show-file-list":!1,"auto-upload":!1,"on-change":x},{default:u(()=>[r("div",_s,[r("div",ys,[a(se,{effect:"dark",content:"该功能仅作预览，数据无法保存",placement:"top"},{default:u(()=>[a(_,{size:"60"},{default:u(()=>[a(J)]),_:1})]),_:1}),vs])])]),_:1})]),_:1})]),_:1})]),_:1},512),[[le,i.type==3]]),ie(a(R,null,{default:u(()=>[a(P,null,{default:u(()=>[r("div",ws,[r("div",xs,[a(M,null,{default:u(()=>[r("div",Ms,[a(b,{type:"primary",link:""},{default:u(()=>[V("强度")]),_:1})])]),_:1}),r("div",bs,[a(D,{"show-input":"",onInput:L,modelValue:i.intensity,"onUpdate:modelValue":A[5]||(A[5]=$=>i.intensity=$),min:0,max:1,step:.01},null,8,["modelValue"])])]),r("div",Ss,[a(M,null,{default:u(()=>[r("div",Cs,[a(b,{type:"primary",link:""},{default:u(()=>[V(" 模糊")]),_:1})])]),_:1}),r("div",Ls,[a(D,{"show-input":"",onInput:L,modelValue:i.blurriness,"onUpdate:modelValue":A[6]||(A[6]=$=>i.blurriness=$),min:0,max:1,step:.01},null,8,["modelValue"])])])])]),_:1})]),_:1},512),[[le,i.type==3]])]),_:1},512),[[le,i.type==3]])],2)])),[[B,t.value]])}}},Es=Le(Ts,[["__scopeId","data-v-ce292eda"]]),Ze=o=>(Pe("data-v-946fee98"),o=o(),ke(),o),As={class:"edit-box"},Is={class:"header"},Ps=Ze(()=>r("span",null,"材质类型",-1)),ks={class:"options"},Rs={class:"option"},Vs=Ze(()=>r("span",null,"当前材质类型：",-1)),$s=Ze(()=>r("div",{class:"header"},[r("span",null,"材质")],-1)),Ds={class:"options"},Fs=["onClick"],Us={class:"icon-name"},Os={class:"check"},zs=Ze(()=>r("div",{class:"header"},"材质属性",-1)),Hs={class:"option space-between"},Ns={class:"option"},Gs={class:"grid-txt"},Bs={class:"grid-silder"},js=Ze(()=>r("div",{class:"header"},"当前材质自带贴图",-1)),Ys={class:"options"},Xs={key:0,class:"select"},Ws=Ze(()=>r("div",{class:"header"},"系统贴图",-1)),Zs=["onClick"],Qs={key:0,class:"select"},qs={__name:"EditMaterial",setup(o,{expose:e}){const n=xe(),{$bus:i}=Re().proxy,t=he({meshName:null,color:null,wireframe:!1,depthWrite:!0,opacity:1}),l=te(!1),s=te(""),c=te(null),d=te(null),p=ee(()=>(m.modelMaterialList.find(_=>_.uuid==m.selectMeshUuid)||{}).uuid?"":"disabled"),m=he({modelMaterialList:ee(()=>n.modelApi.modelMaterialList),originalMaterials:ee(()=>n.modelApi.originalMaterials),modelApi:ee(()=>n.modelApi),selectMeshUuid:ee(()=>n.selectMeshUuid)});Oe(()=>{i.on("update-model",()=>{Object.assign(t,{color:null,wireframe:!1,depthWrite:!0,opacity:1})})}),vn(()=>n.selectMeshUuid,E=>{const _=m.modelMaterialList.find(M=>M.uuid==E)||{};if(d.value=_.mapId,_.mapId){const{color:M,wireframe:b,depthWrite:g,opacity:I}=_.material,P=new de(M).getStyle();Object.assign(t,{color:P,wireframe:b,depthWrite:g,opacity:I});const R=m.originalMaterials.get(_.uuid);c.value={url:x(_),name:_.name,mapId:R.userData.mapId,material:_.material}}else c.value=null});const h=E=>{const _=Xt.find(M=>M.type==E);m.modelApi.onChangeModelMeshType(_)},w=E=>{const{name:_}=E;t.meshName=_;const M=m.modelApi.onChangeModelMaterial(_),{color:b,wireframe:g,depthWrite:I,opacity:P}=M.material;Object.assign(t,{color:new de(b).getStyle(),wireframe:g,depthWrite:I,opacity:P});const R=m.originalMaterials.get(E.uuid);c.value={url:x(E),name:E.name,mapId:E.mapId,material:R}},x=E=>{const _=m.originalMaterials.get(E.uuid),M=Array.isArray(_)?_:[_];let b;return M.forEach(g=>{if(g.map&&g.map.image){const I=document.createElement("canvas"),{width:P,height:R}=g.map.image;I.width=P,I.height=R,I.getContext("2d").drawImage(g.map.image,0,0),b=I.toDataURL("image/png",.5),I.remove()}}),b},f=()=>{m.modelApi.onSetModelMaterial(t)},S=E=>{E.visible=!E.visible,m.modelApi.onSetMeshVisible(E)},L=E=>{d.value=E.mapId,m.modelApi.onSetModelMap(E),re.success("当前材质贴图修改成功")},C=async E=>{try{l.value=!0,d.value=E.id;const _=m.modelMaterialList.find(M=>M.uuid==n.selectMeshUuid)||{};_.mapId=E.id,m.modelApi.onSetSystemModelMap(E),re.success("当前材质贴图修改成功")}finally{l.value=!1}},T=async E=>{const _=URL.createObjectURL(E.raw);await m.modelApi.onSetStorageModelMap(_,zt(E.name)),URL.revokeObjectURL(_),re.success("当前材质贴图修改成功")},A=()=>{Object.assign(t,{meshName:null,color:"#fff",wireframe:!1,depthWrite:!0,opacity:1}),s.value="",d.value=null,m.modelApi.initModelMaterial()};return e({getMeshConfig:()=>({materialType:s.value,meshList:m.modelApi.onGetEditMeshList()})}),(E,_)=>{const M=v("el-button"),b=v("el-option"),g=v("el-select"),I=v("el-space"),P=v("View"),R=v("el-icon"),G=v("Hide"),F=v("Check"),U=v("el-scrollbar"),k=v("el-color-picker"),j=v("WarnTriangleFilled"),se=v("el-tooltip"),X=v("el-switch"),J=v("el-slider"),D=v("el-image"),B=v("Select"),$=v("el-col"),z=v("el-upload"),W=v("el-row"),Z=yn("zLoading");return ie((O(),Q("div",As,[r("div",Is,[Ps,a(M,{type:"primary",icon:"Refresh",onClick:A},{default:u(()=>[V(" 重置 ")]),_:1})]),r("div",ks,[r("div",Rs,[a(I,null,{default:u(()=>[Vs,a(g,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=H=>s.value=H),onChange:h,placeholder:"请选择",size:"small",style:{width:"200px"}},{default:u(()=>[(O(!0),Q(pe,null,ge(ce(Xt),H=>(O(),ne(b,{key:H.type,label:`${H.type?H.type:""}(${H.describe})`,value:H.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),$s,r("div",Ds,[a(U,{"max-height":"200px"},{default:u(()=>[(O(!0),Q(pe,null,ge(m.modelMaterialList,H=>(O(),Q("div",{class:Y(["option",m.selectMeshUuid==H.uuid?"option-active":""]),onClick:Xe(me=>w(H),["stop"]),key:H.uuid},[a(I,null,{default:u(()=>[H.visible?(O(),ne(R,{key:0,onClick:me=>S(H),size:"18",color:"#409eff"},{default:u(()=>[a(P)]),_:2},1032,["onClick"])):(O(),ne(R,{key:1,size:"18",onClick:me=>S(H)},{default:u(()=>[a(G)]),_:2},1032,["onClick"])),r("div",Us,ye(H.name),1),ie(r("div",Os,[a(R,{size:"20px",color:"#2a3ff6"},{default:u(()=>[a(F)]),_:1})],512),[[le,m.selectMeshUuid==H.uuid]])]),_:2},1024)],10,Fs))),128))]),_:1})]),zs,r("div",{class:Y(["options",p.value])},[r("div",Hs,[a(I,null,{default:u(()=>[a(M,{type:"primary",link:""},{default:u(()=>[V("材质颜色")]),_:1}),a(k,{"color-format":"rgb",predefine:ce(We),onChange:f,modelValue:t.color,"onUpdate:modelValue":_[1]||(_[1]=H=>t.color=H)},null,8,["predefine","modelValue"])]),_:1}),a(I,null,{default:u(()=>[a(se,{effect:"dark",content:"注意：深度写入属性不支持模型“导出” ",placement:"top"},{default:u(()=>[a(R,null,{default:u(()=>[a(j,{size:20,color:"#ffb940"})]),_:1})]),_:1}),a(M,{type:"primary",link:""},{default:u(()=>[V("深度写入")]),_:1}),a(X,{onChange:f,modelValue:t.depthWrite,"onUpdate:modelValue":_[2]||(_[2]=H=>t.depthWrite=H)},null,8,["modelValue"])]),_:1}),a(I,null,{default:u(()=>[a(se,{effect:"dark",content:"注意：网格属性不支持模型“导出” ",placement:"top"},{default:u(()=>[a(R,null,{default:u(()=>[a(j,{size:20,color:"#ffb940"})]),_:1})]),_:1}),a(M,{type:"primary",link:""},{default:u(()=>[V("网格")]),_:1}),a(X,{onChange:f,modelValue:t.wireframe,"onUpdate:modelValue":_[3]||(_[3]=H=>t.wireframe=H)},null,8,["modelValue"])]),_:1})]),r("div",Ns,[r("div",Gs,[a(M,{type:"primary",link:""},{default:u(()=>[V("透明度 ")]),_:1})]),r("div",Bs,[a(J,{"show-input":"",onInput:f,onChange:f,modelValue:t.opacity,"onUpdate:modelValue":_[4]||(_[4]=H=>t.opacity=H),min:0,max:1,step:.01},null,8,["modelValue"])])])],2),js,r("div",Ys,[a(U,{"max-height":"140px"},{default:u(()=>[a(W,{justify:"center",align:"middle",style:{minHeight:"120px"}},{default:u(()=>[c.value?(O(),ne($,{key:0,span:10,offse:4,style:{textAlign:"center"}},{default:u(()=>[r("div",{onClick:_[5]||(_[5]=H=>L(c.value)),class:Y([d.value==c.value.mapId?"active":"","mesh-image"])},[a(D,{src:c.value.url,class:"mesh-map",fit:"cover"},null,8,["src"]),d.value==c.value.mapId?(O(),Q("div",Xs,[a(R,{color:"#18c174",size:26},{default:u(()=>[a(B)]),_:1})])):ve("",!0)],2)]),_:1})):ve("",!0),c.value?(O(),ne($,{key:1,span:8,style:{textAlign:"center"}},{default:u(()=>[a(z,{action:"",accept:".jpg,.png,.hdr","show-file-list":!1,"auto-upload":!1,"on-change":T},{default:u(()=>[a(se,{effect:"dark",content:"该功能仅仅作预览，数据无法保存 ",placement:"top"},{default:u(()=>[a(M,{type:"primary",icon:"UploadFilled"},{default:u(()=>[V("加载外部贴图")]),_:1})]),_:1})]),_:1})]),_:1})):ve("",!0)]),_:1})]),_:1})]),Ws,r("div",{class:Y(["options",p.value])},[a(U,{"max-height":"230px"},{default:u(()=>[a(W,null,{default:u(()=>[(O(!0),Q(pe,null,ge(ce(qn),H=>(O(),ne($,{span:6,style:{textAlign:"center"},key:H.id},{default:u(()=>[r("div",{onClick:me=>C(H),class:Y(["image-box",d.value==H.id?"active":""])},[a(D,{src:H.url,class:"el-map",fit:"cover"},null,8,["src"]),d.value==H.id?(O(),Q("div",Qs,[a(R,{color:"#18c174",size:26},{default:u(()=>[a(B)]),_:1})])):ve("",!0)],10,Zs)]),_:2},1024))),128))]),_:1})]),_:1})],2)])),[[Z,l.value]])}}},Ks=Le(qs,[["__scopeId","data-v-946fee98"]]),Js={class:"edit-box"},ei={class:"header"},ti=r("span",null,"模型动画",-1),ni=["onClick"],oi={class:"icon-name"},si={class:"check"},ii=r("div",{class:"header"},[r("span",null,"动画配置")],-1),ai={class:"option"},li=r("span",null," 循环方式 ",-1),ri={class:"option"},ci={class:"option"},di=r("span",null," 播放速度 ",-1),ui={class:"option"},pi={class:"option"},hi=r("span",null," 动作幅度 ",-1),mi={class:"option"},fi={class:"header"},gi=r("span",null,"轴动画",-1),_i={class:"options"},yi=r("span",null," 轴方向 ",-1),vi=r("span",null," 播放速度 ",-1),wi={__name:"EditAnimation",setup(o,{expose:e}){const n=xe(),{$bus:i}=Re().proxy,t=he({visible:!1,animationName:null,loop:"LoopRepeat",timeScale:1,weight:1,rotationVisible:!1,rotationType:"y",rotationSpeed:1}),l=ee(()=>t.visible?"":"disabled"),s=ee(()=>t.rotationVisible?"":"disabled"),c=he({modelAnimation:ee(()=>n.modelApi?n.modelApi.modelAnimation:[])});Oe(()=>{c.modelAnimation.length&&(t.animationName=c.modelAnimation[0].name),i.on("update-model",()=>{if(c.modelAnimation.length){const x=c.modelAnimation[0].name;t.animationName=x}Object.assign(t,{visible:!1,loop:"LoopRepeat",timeScale:1,weight:1,rotationVisible:!1,rotationType:"y",rotationSpeed:1})})});const d=()=>{const{visible:x}=t;x?m():n.modelApi.onClearAnimation()},p=({name:x})=>{t.animationName=x,n.modelApi.onStartModelAnimaion(t)},m=()=>{n.modelApi.onStartModelAnimaion(t)},h=()=>{n.modelApi.onSetRotation(t)},w=()=>{n.modelApi.onSetRotationType(t)};return e({config:t}),(x,f)=>{const S=v("el-switch"),L=v("Check"),C=v("el-icon"),T=v("el-space"),A=v("el-scrollbar"),y=v("el-empty"),E=v("Switch"),_=v("el-radio-button"),M=v("el-radio-group"),b=v("VideoPlay"),g=v("el-slider"),I=v("Sort");return O(),Q("div",Js,[r("div",ei,[ti,a(S,{modelValue:t.visible,"onUpdate:modelValue":f[0]||(f[0]=P=>t.visible=P),onChange:d},null,8,["modelValue"])]),r("div",{class:Y(["options",l.value])},[c.modelAnimation.length?(O(),ne(A,{key:0,"max-height":"250px"},{default:u(()=>[(O(!0),Q(pe,null,ge(c.modelAnimation,P=>(O(),Q("div",{class:Y(["option",t.animationName==P.name?"option-active":""]),onClick:R=>p(P),key:P.name},[a(T,null,{default:u(()=>[r("div",oi,ye(P.name),1),ie(r("div",si,[a(C,{size:"20px",color:"#2a3ff6"},{default:u(()=>[a(L)]),_:1})],512),[[le,t.animationName==P.name]])]),_:2},1024)],10,ni))),128))]),_:1})):(O(),ne(y,{key:1,description:"暂无动画","image-size":120}))],2),ii,r("div",{class:Y(["options",l.value])},[r("div",ai,[a(T,null,{default:u(()=>[a(C,null,{default:u(()=>[a(E)]),_:1}),li]),_:1})]),r("div",ri,[a(M,{modelValue:t.loop,"onUpdate:modelValue":f[1]||(f[1]=P=>t.loop=P),onChange:m},{default:u(()=>[a(_,{value:"LoopOnce"},{default:u(()=>[V("只执行一次")]),_:1}),a(_,{value:"LoopRepeat"},{default:u(()=>[V("无限循环")]),_:1}),a(_,{value:"LoopPingPong"},{default:u(()=>[V("来回循环")]),_:1})]),_:1},8,["modelValue"])]),r("div",ci,[a(T,null,{default:u(()=>[a(C,null,{default:u(()=>[a(b)]),_:1}),di]),_:1})]),r("div",ui,[a(g,{"show-input":"",modelValue:t.timeScale,"onUpdate:modelValue":f[2]||(f[2]=P=>t.timeScale=P),onChange:m,step:.01,min:0,max:1},null,8,["modelValue"])]),r("div",pi,[a(T,null,{default:u(()=>[a(C,null,{default:u(()=>[a(I)]),_:1}),hi]),_:1})]),r("div",mi,[a(g,{"show-input":"",modelValue:t.weight,"onUpdate:modelValue":f[3]||(f[3]=P=>t.weight=P),onChange:m,step:.01,min:0,max:1},null,8,["modelValue"])])],2),r("div",fi,[gi,a(S,{modelValue:t.rotationVisible,"onUpdate:modelValue":f[4]||(f[4]=P=>t.rotationVisible=P),onChange:h},null,8,["modelValue"])]),r("div",_i,[r("div",{class:Y(["option",s.value])},[a(T,null,{default:u(()=>[yi,a(M,{modelValue:t.rotationType,"onUpdate:modelValue":f[5]||(f[5]=P=>t.rotationType=P),onChange:w},{default:u(()=>[a(_,{value:"x"},{default:u(()=>[V("X轴")]),_:1}),a(_,{value:"y"},{default:u(()=>[V("Y轴")]),_:1}),a(_,{value:"z"},{default:u(()=>[V("Z轴")]),_:1})]),_:1},8,["modelValue"])]),_:1})],2),r("div",{class:Y(["option",s.value])},[a(T,null,{default:u(()=>[a(C,null,{default:u(()=>[a(b)]),_:1}),vi]),_:1})],2),r("div",{class:Y(["option",s.value])},[a(g,{onInput:h,"show-input":"",modelValue:t.rotationSpeed,"onUpdate:modelValue":f[6]||(f[6]=P=>t.rotationSpeed=P),step:.01,min:1,max:10},null,8,["modelValue"])],2)])])}}},xi={class:"edit-box"},Mi={class:"header"},bi=r("span",null,"辅助线/轴配置",-1),Si={class:"option space-between"},Ci=r("span",null," 模型轴旋转 ",-1),Li={class:"option"},Ti={class:"option"},Ei={class:"option"},Ai={class:"option space-between"},Ii=r("span",null," 模型位置 ",-1),Pi={class:"option"},ki={class:"grid-txt"},Ri={class:"grid-silder"},Vi={class:"option"},$i={class:"grid-txt"},Di={class:"grid-silder"},Fi={class:"option"},Ui={class:"grid-txt"},Oi={class:"grid-silder"},zi={class:"option space-between"},Hi=r("span",null," 网格辅助线 ",-1),Ni={class:"option"},Gi={class:"grid-txt"},Bi={class:"grid-silder"},ji={class:"option"},Yi={class:"grid-txt"},Xi={class:"grid-silder"},Wi={class:"option"},Zi={class:"grid-txt"},Qi={class:"grid-silder"},qi={class:"option"},Ki={class:"option"},Ji={class:"option space-between"},ea=r("span",null," 坐标轴辅助线 ",-1),ta={class:"grid-txt"},na={class:"grid-silder"},oa={__name:"EditAttribute",setup(o,{expose:e}){const n=xe(),{$bus:i}=Re().proxy,t=he({visible:!0,gridHelper:!1,x:0,y:-.59,z:-.1,positionX:0,positionY:-1,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8}),l=We,s=ee(()=>t.visible?"":"disabled"),c=ee(()=>{const{visible:A,gridHelper:y}=t;return y&&A?"":"disabled"}),d=ee(()=>{const{visible:A,axesHelper:y}=t;return y&&A?"":"disabled"});Oe(()=>{i.on("update-model",()=>{Object.assign(t,{visible:!0,gridHelper:!1,x:0,y:-.59,z:-.1,positionX:0,positionY:-1,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8})})});const p=()=>{},m=(A,y)=>{const E=y=="right";n.modelApi.onSetModelRotateOnAxis(A,E)},h=()=>{n.modelApi.onResultModelRotateOnAxis()},w=()=>{n.modelApi.onSetModelPosition(t)},x=()=>{t.positionX=0,t.positionY=-1,t.positionZ=0,n.modelApi.onResultModelPosition(t)},f=A=>{t.color=A,n.modelApi.onSetModelGridHelper(t)},S=()=>{n.modelApi.onSetModelGridHelper(t)},L=()=>{n.modelApi.onSetModelGridHelperSize(t)},C=()=>{n.modelApi.onSetModelAxesHelper(t)};return e({getAttributeConfig:()=>{const{x:A,y,z:E}=n.modelApi.model.rotation;return{...t,rotationX:A,rotationY:y,rotationZ:E}}}),(A,y)=>{const E=v("el-switch"),_=v("Setting"),M=v("el-icon"),b=v("el-space"),g=v("el-button"),I=v("Location"),P=v("el-slider"),R=v("Grid"),G=v("el-input-number"),F=v("el-color-picker"),U=v("Rank");return O(),Q("div",xi,[r("div",Mi,[bi,a(E,{modelValue:t.visible,"onUpdate:modelValue":y[0]||(y[0]=k=>t.visible=k),onChange:p},null,8,["modelValue"])]),r("div",{class:Y(["options",s.value])},[r("div",Si,[a(b,null,{default:u(()=>[a(M,null,{default:u(()=>[a(_)]),_:1}),Ci]),_:1}),a(g,{type:"primary",link:"",icon:"Refresh",onClick:h},{default:u(()=>[V(" 重置 ")]),_:1})]),r("div",Li,[a(g,{type:"info",icon:"RefreshRight",onClick:y[1]||(y[1]=k=>m("x","right"))}),a(g,{type:"primary",link:""},{default:u(()=>[V("X轴")]),_:1}),a(g,{type:"info",icon:"RefreshLeft",onClick:y[2]||(y[2]=k=>m("x","left"))})]),r("div",Ti,[a(g,{type:"info",icon:"RefreshRight",onClick:y[3]||(y[3]=k=>m("y","right"))}),a(g,{type:"primary",link:""},{default:u(()=>[V("Y轴")]),_:1}),a(g,{type:"info",icon:"RefreshLeft",onClick:y[4]||(y[4]=k=>m("y","left"))})]),r("div",Ei,[a(g,{type:"info",icon:"RefreshRight",onClick:y[5]||(y[5]=k=>m("z","right"))}),a(g,{type:"primary",link:""},{default:u(()=>[V("Z轴")]),_:1}),a(g,{type:"info",icon:"RefreshLeft",onClick:y[6]||(y[6]=k=>m("z","left"))})]),r("div",Ai,[a(b,null,{default:u(()=>[a(M,null,{default:u(()=>[a(I)]),_:1}),Ii]),_:1}),a(g,{type:"primary",link:"",icon:"Refresh",onClick:x},{default:u(()=>[V(" 重置 ")]),_:1})]),r("div",Pi,[r("div",ki,[a(g,{type:"primary",link:""},{default:u(()=>[V("X 轴")]),_:1})]),r("div",Ri,[a(P,{onInput:w,"show-input":"",modelValue:t.positionX,"onUpdate:modelValue":y[7]||(y[7]=k=>t.positionX=k),min:-10,max:10,step:.1},null,8,["modelValue"])])]),r("div",Vi,[r("div",$i,[a(g,{type:"primary",link:""},{default:u(()=>[V("Y 轴")]),_:1})]),r("div",Di,[a(P,{onInput:w,"show-input":"",modelValue:t.positionY,"onUpdate:modelValue":y[8]||(y[8]=k=>t.positionY=k),min:-10,max:10,step:.1},null,8,["modelValue"])])]),r("div",Fi,[r("div",Ui,[a(g,{type:"primary",link:""},{default:u(()=>[V("Z 轴")]),_:1})]),r("div",Oi,[a(P,{onInput:w,"show-input":"",modelValue:t.positionZ,"onUpdate:modelValue":y[9]||(y[9]=k=>t.positionZ=k),min:-10,max:10,step:.1},null,8,["modelValue"])])])],2),r("div",{class:Y(["options",s.value])},[r("div",zi,[a(b,null,{default:u(()=>[a(M,null,{default:u(()=>[a(R)]),_:1}),Hi]),_:1}),a(E,{modelValue:t.gridHelper,"onUpdate:modelValue":y[10]||(y[10]=k=>t.gridHelper=k),onChange:S},null,8,["modelValue"])])],2),r("div",{class:Y(["options",c.value])},[r("div",Ni,[r("div",Gi,[a(g,{type:"primary",link:""},{default:u(()=>[V("X 轴")]),_:1})]),r("div",Bi,[a(P,{"show-input":"",onInput:S,modelValue:t.x,"onUpdate:modelValue":y[11]||(y[11]=k=>t.x=k),min:-2,max:4,step:.01},null,8,["modelValue"])])]),r("div",ji,[r("div",Yi,[a(g,{type:"primary",link:""},{default:u(()=>[V("Y 轴")]),_:1})]),r("div",Xi,[a(P,{"show-input":"",onInput:S,modelValue:t.y,"onUpdate:modelValue":y[12]||(y[12]=k=>t.y=k),min:-2,max:4,step:.01},null,8,["modelValue"])])]),r("div",Wi,[r("div",Zi,[a(g,{type:"primary",link:""},{default:u(()=>[V("Z 轴")]),_:1})]),r("div",Qi,[a(P,{"show-input":"",onInput:S,modelValue:t.z,"onUpdate:modelValue":y[13]||(y[13]=k=>t.z=k),min:-2,max:4,step:.01},null,8,["modelValue"])])]),r("div",qi,[r("div",null,[a(g,{type:"primary",link:""},{default:u(()=>[V("大小")]),_:1}),a(G,{controls:!0,onChange:L,modelValue:t.size,"onUpdate:modelValue":y[14]||(y[14]=k=>t.size=k),min:1,max:40},null,8,["modelValue"])]),r("div",null,[a(g,{type:"primary",link:""},{default:u(()=>[V("分割数")]),_:1}),a(G,{controls:!0,onChange:L,modelValue:t.divisions,"onUpdate:modelValue":y[15]||(y[15]=k=>t.divisions=k),min:1,max:40},null,8,["modelValue"])])]),r("div",Ki,[a(b,null,{default:u(()=>[a(g,{type:"primary",link:""},{default:u(()=>[V("网格颜色")]),_:1}),a(F,{"color-format":"hex",predefine:ce(l),onChange:S,onActiveChange:f,modelValue:t.color,"onUpdate:modelValue":y[16]||(y[16]=k=>t.color=k)},null,8,["predefine","modelValue"])]),_:1})])],2),r("div",{class:Y(["options",s.value])},[r("div",Ji,[a(b,null,{default:u(()=>[a(M,null,{default:u(()=>[a(U)]),_:1}),ea]),_:1}),a(E,{modelValue:t.axesHelper,"onUpdate:modelValue":y[17]||(y[17]=k=>t.axesHelper=k),onChange:C},null,8,["modelValue"])]),r("div",{class:Y(["option",d.value])},[r("div",ta,[a(g,{type:"primary",link:""},{default:u(()=>[V("轴长度")]),_:1})]),r("div",na,[a(P,{onInput:C,modelValue:t.axesSize,"onUpdate:modelValue":y[18]||(y[18]=k=>t.axesSize=k),min:1,max:10,step:.2},null,8,["modelValue"])])],2)],2)])}}},He=o=>(Pe("data-v-70b883d5"),o=o(),ke(),o),sa={class:"edit-box"},ia={class:"header"},aa=He(()=>r("span",null,"模型灯光",-1)),la={class:"options"},ra={class:"option space-between"},ca=He(()=>r("span",null,"光源平面",-1)),da=He(()=>r("span",null,"平面颜色",-1)),ua={class:"grid-txt"},pa={class:"grid-silder"},ha={class:"grid-txt"},ma={class:"grid-silder"},fa={class:"options"},ga={class:"option space-between"},_a=He(()=>r("span",null,"环境光",-1)),ya={class:"color"},va={class:"silder"},wa={class:"options"},xa={class:"option space-between"},Ma=He(()=>r("span",null,"平行光",-1)),ba={class:"color"},Sa={class:"silder"},Ca={class:"grid-txt"},La={class:"grid-silder"},Ta={class:"grid-txt"},Ea={class:"grid-silder"},Aa={class:"grid-txt"},Ia={class:"grid-silder"},Pa={class:"grid-txt"},ka={class:"grid-silder"},Ra={class:"grid-txt"},Va={class:"grid-silder"},$a={class:"options"},Da={class:"option space-between"},Fa=He(()=>r("span",null,"点光源",-1)),Ua={class:"grid-txt"},Oa={class:"grid-silder"},za={class:"color"},Ha={class:"silder"},Na={class:"grid-txt"},Ga={class:"grid-silder"},Ba={class:"grid-txt"},ja={class:"grid-silder"},Ya={class:"grid-txt"},Xa={class:"grid-silder"},Wa={class:"options"},Za={class:"option space-between"},Qa=He(()=>r("span",null,"聚光灯",-1)),qa={class:"color"},Ka={class:"silder"},Ja={class:"grid-txt"},el={class:"grid-silder"},tl={class:"grid-txt"},nl={class:"grid-silder"},ol={class:"grid-txt"},sl={class:"grid-silder"},il={class:"grid-txt"},al={class:"grid-silder"},ll={class:"grid-txt"},rl={class:"grid-silder"},cl={class:"grid-txt"},dl={class:"grid-silder"},ul={class:"grid-txt"},pl={class:"grid-silder"},hl={class:"grid-txt"},ml={class:"grid-silder"},fl={class:"grid-txt"},gl={class:"grid-silder"},_l={__name:"EditLight",setup(o,{expose:e}){const n=xe(),{$bus:i}=Re().proxy,t=he({planeGeometry:!1,planeColor:"#000000",planeWidth:7,planeHeight:7,ambientLight:!0,ambientLightColor:"#fff",ambientLightIntensity:.8,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#fff",directionalLightIntensity:5,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistance:2.98,directionaShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:10,pointHorizontal:-4.21,pointVertical:-4.1,pointSistance:2.53,spotLight:!1,spotLightColor:"#00BABD",spotLightIntensity:900,spotHorizontal:-3.49,spotVertical:-4.37,spotSistance:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20}),l=We,s=ee(()=>{const{ambientLight:b}=t;return b?"":"disabled"}),c=ee(()=>{const{directionalLight:b}=t;return b?"":"disabled"}),d=ee(()=>{const{pointLight:b}=t;return b?"":"disabled"}),p=ee(()=>{const{spotLight:b}=t;return b?"":"disabled"}),m=ee(()=>{const{planeGeometry:b}=t;return b?"":"disabled"}),h=he({modelApi:ee(()=>n.modelApi)});Oe(()=>{i.on("update-model",()=>{_()})});const w=b=>{t.ambientLightColor=b,h.modelApi.onSetModelAmbientLight(t)},x=()=>{h.modelApi.onSetModelAmbientLight(t)},f=b=>{t.directionalLightColor=b,h.modelApi.onSetModelDirectionalLight(t)},S=()=>{t.directionalLight&&(t.planeGeometry=!0,h.modelApi.onSetModelPlaneGeometry(t)),h.modelApi.onSetModelDirectionalLight(t)},L=b=>{t.pointLightColor=b,h.modelApi.onSetModelPointLight(t)},C=()=>{h.modelApi.onSetModelPointLight(t)},T=b=>{t.spotLightColor=b,h.modelApi.onSetModelSpotLight(t)},A=()=>{t.spotLight&&(t.planeGeometry=!0,h.modelApi.onSetModelPlaneGeometry(t)),h.modelApi.onSetModelSpotLight(t)},y=b=>{t.planeColor=b,h.modelApi.onSetModelPlaneGeometry(t)},E=()=>{h.modelApi.onSetModelPlaneGeometry(t)},_=()=>{Object.assign(t,{planeGeometry:!1,planeColor:"#000000",planeWidth:7,planeHeight:7,ambientLight:!0,ambientLightColor:"#fff",ambientLightIntensity:.8,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#fff",directionalLightIntensity:5,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistance:2.98,directionaShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:10,pointHorizontal:-4.21,pointVertical:-4.1,pointSistance:2.53,spotLight:!1,spotLightColor:"#00BABD",spotLightIntensity:900,spotHorizontal:-3.49,spotVertical:-4.37,spotSistance:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20})},M=()=>{_(),h.modelApi.onResettingLight({ambientLight:!0})};return e({config:t}),(b,g)=>{const I=v("el-button"),P=v("Odometer"),R=v("el-icon"),G=v("el-space"),F=v("el-switch"),U=v("el-color-picker"),k=v("el-slider"),j=v("SetUp"),se=v("Place"),X=v("Orange"),J=v("el-scrollbar");return O(),Q("div",sa,[r("div",ia,[aa,a(I,{type:"primary",icon:"Refresh",onClick:M},{default:u(()=>[V(" 重置 ")]),_:1})]),a(J,{height:"calc(100vh - 130px)"},{default:u(()=>[r("div",la,[r("div",ra,[a(G,null,{default:u(()=>[a(R,null,{default:u(()=>[a(P)]),_:1}),ca]),_:1}),a(F,{modelValue:t.planeGeometry,"onUpdate:modelValue":g[0]||(g[0]=D=>t.planeGeometry=D),onChange:E},null,8,["modelValue"])]),r("div",{class:Y(["option",m.value])},[a(G,null,{default:u(()=>[da,a(U,{"color-format":"hex",modelValue:t.planeColor,"onUpdate:modelValue":g[1]||(g[1]=D=>t.planeColor=D),predefine:ce(l),onChange:E,onActiveChange:y},null,8,["modelValue","predefine"])]),_:1})],2),r("div",{class:Y(["option",m.value])},[r("div",ua,[a(I,{type:"primary",link:""},{default:u(()=>[V("宽度")]),_:1})]),r("div",pa,[a(k,{"show-input":"",onInput:E,modelValue:t.planeWidth,"onUpdate:modelValue":g[2]||(g[2]=D=>t.planeWidth=D),min:0,max:100,step:.1},null,8,["modelValue"])])],2),r("div",{class:Y(["option",m.value])},[r("div",ha,[a(I,{type:"primary",link:""},{default:u(()=>[V("高度")]),_:1})]),r("div",ma,[a(k,{"show-input":"",onInput:E,modelValue:t.planeHeight,"onUpdate:modelValue":g[3]||(g[3]=D=>t.planeHeight=D),min:0,max:100,step:.1},null,8,["modelValue"])])],2)]),r("div",fa,[r("div",ga,[a(G,null,{default:u(()=>[a(R,null,{default:u(()=>[a(P)]),_:1}),_a]),_:1}),a(F,{modelValue:t.ambientLight,"onUpdate:modelValue":g[4]||(g[4]=D=>t.ambientLight=D),onChange:x},null,8,["modelValue"])]),r("div",{class:Y(["option",s.value])},[r("div",ya,[a(U,{"color-format":"hex",modelValue:t.ambientLightColor,"onUpdate:modelValue":g[5]||(g[5]=D=>t.ambientLightColor=D),predefine:ce(l),onChange:x,onActiveChange:w},null,8,["modelValue","predefine"])]),r("div",va,[a(k,{"show-input":"",onInput:x,modelValue:t.ambientLightIntensity,"onUpdate:modelValue":g[6]||(g[6]=D=>t.ambientLightIntensity=D),min:-5,max:5,step:.01},null,8,["modelValue"])])],2)]),r("div",wa,[r("div",xa,[a(G,null,{default:u(()=>[a(R,null,{default:u(()=>[a(j)]),_:1}),Ma]),_:1}),a(F,{modelValue:t.directionalLight,"onUpdate:modelValue":g[7]||(g[7]=D=>t.directionalLight=D),onChange:S},null,8,["modelValue"])]),r("div",{class:Y(["option",c.value])},[r("div",ba,[a(U,{"color-format":"hex",modelValue:t.directionalLightColor,"onUpdate:modelValue":g[8]||(g[8]=D=>t.directionalLightColor=D),predefine:ce(l),onChange:S,onActiveChange:f},null,8,["modelValue","predefine"])]),r("div",Sa,[a(k,{"show-input":"",onInput:S,modelValue:t.directionalLightIntensity,"onUpdate:modelValue":g[9]||(g[9]=D=>t.directionalLightIntensity=D),min:-5,max:15,step:.01},null,8,["modelValue"])])],2),r("div",{class:Y(["option",c.value])},[r("div",Ca,[a(I,{type:"primary",link:""},{default:u(()=>[V("是否开启阴影")]),_:1})]),r("div",La,[a(F,{modelValue:t.directionaShadow,"onUpdate:modelValue":g[10]||(g[10]=D=>t.directionaShadow=D),onChange:S},null,8,["modelValue"])]),a(G,null,{default:u(()=>[r("div",Ta,[a(I,{type:"primary",link:""},{default:u(()=>[V("辅助线")]),_:1})]),r("div",Ea,[a(F,{modelValue:t.directionalLightHelper,"onUpdate:modelValue":g[11]||(g[11]=D=>t.directionalLightHelper=D),onChange:S},null,8,["modelValue"])])]),_:1})],2),r("div",{class:Y(["option",c.value])},[r("div",Aa,[a(I,{type:"primary",link:""},{default:u(()=>[V("水平方向")]),_:1})]),r("div",Ia,[a(k,{"show-input":"",onInput:S,modelValue:t.directionalHorizontal,"onUpdate:modelValue":g[12]||(g[12]=D=>t.directionalHorizontal=D),min:-10,max:10,step:.01},null,8,["modelValue"])])],2),r("div",{class:Y(["option",c.value])},[r("div",Pa,[a(I,{type:"primary",link:""},{default:u(()=>[V("垂直方向")]),_:1})]),r("div",ka,[a(k,{"show-input":"",onInput:S,modelValue:t.directionalVertical,"onUpdate:modelValue":g[13]||(g[13]=D=>t.directionalVertical=D),min:-10,max:10,step:.01},null,8,["modelValue"])])],2),r("div",{class:Y(["option",c.value])},[r("div",Ra,[a(I,{type:"primary",link:""},{default:u(()=>[V("光源距离")]),_:1})]),r("div",Va,[a(k,{"show-input":"",onInput:S,modelValue:t.directionalSistance,"onUpdate:modelValue":g[14]||(g[14]=D=>t.directionalSistance=D),min:0,max:10,step:.01},null,8,["modelValue"])])],2)]),r("div",$a,[r("div",Da,[a(G,null,{default:u(()=>[a(R,null,{default:u(()=>[a(se)]),_:1}),Fa]),_:1}),a(F,{modelValue:t.pointLight,"onUpdate:modelValue":g[15]||(g[15]=D=>t.pointLight=D),onChange:C},null,8,["modelValue"])]),r("div",{class:Y(["option",d.value])},[a(G,null,{default:u(()=>[r("div",Ua,[a(I,{type:"primary",link:""},{default:u(()=>[V("辅助线")]),_:1})]),r("div",Oa,[a(F,{modelValue:t.pointLightHelper,"onUpdate:modelValue":g[16]||(g[16]=D=>t.pointLightHelper=D),onChange:C},null,8,["modelValue"])])]),_:1})],2),r("div",{class:Y(["option",d.value])},[r("div",za,[a(U,{"color-format":"hex",modelValue:t.pointLightColor,"onUpdate:modelValue":g[17]||(g[17]=D=>t.pointLightColor=D),predefine:ce(l),onChange:C,onActiveChange:L},null,8,["modelValue","predefine"])]),r("div",Ha,[a(k,{"show-input":"",onInput:C,modelValue:t.pointLightIntensity,"onUpdate:modelValue":g[18]||(g[18]=D=>t.pointLightIntensity=D),min:-20,max:60,step:.1},null,8,["modelValue"])])],2),r("div",{class:Y(["option",d.value])},[r("div",Na,[a(I,{type:"primary",link:""},{default:u(()=>[V("水平方向")]),_:1})]),r("div",Ga,[a(k,{"show-input":"",onInput:C,modelValue:t.pointHorizontal,"onUpdate:modelValue":g[19]||(g[19]=D=>t.pointHorizontal=D),min:-10,max:10,step:.11},null,8,["modelValue"])])],2),r("div",{class:Y(["option",d.value])},[r("div",Ba,[a(I,{type:"primary",link:""},{default:u(()=>[V("垂直方向")]),_:1})]),r("div",ja,[a(k,{"show-input":"",onInput:C,modelValue:t.pointVertical,"onUpdate:modelValue":g[20]||(g[20]=D=>t.pointVertical=D),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),r("div",{class:Y(["option",d.value])},[r("div",Ya,[a(I,{type:"primary",link:""},{default:u(()=>[V("光源距离")]),_:1})]),r("div",Xa,[a(k,{"show-input":"",onInput:C,modelValue:t.pointSistance,"onUpdate:modelValue":g[21]||(g[21]=D=>t.pointSistance=D),min:0,max:10,step:.1},null,8,["modelValue"])])],2)]),r("div",Wa,[r("div",Za,[a(G,null,{default:u(()=>[a(R,null,{default:u(()=>[a(X)]),_:1}),Qa]),_:1}),a(F,{modelValue:t.spotLight,"onUpdate:modelValue":g[22]||(g[22]=D=>t.spotLight=D),onChange:A},null,8,["modelValue"])]),r("div",{class:Y(["option",p.value])},[r("div",qa,[a(U,{"color-format":"hex",modelValue:t.spotLightColor,"onUpdate:modelValue":g[23]||(g[23]=D=>t.spotLightColor=D),predefine:ce(l),onChange:A,onActiveChange:T},null,8,["modelValue","predefine"])]),r("div",Ka,[a(k,{"show-input":"",onInput:A,modelValue:t.spotLightIntensity,"onUpdate:modelValue":g[24]||(g[24]=D=>t.spotLightIntensity=D),min:0,max:2e3,step:.1},null,8,["modelValue"])])],2),r("div",{class:Y(["option",p.value])},[r("div",Ja,[a(I,{type:"primary",link:""},{default:u(()=>[V("是否开启阴影")]),_:1})]),r("div",el,[a(F,{modelValue:t.spotCastShadow,"onUpdate:modelValue":g[25]||(g[25]=D=>t.spotCastShadow=D),onChange:A},null,8,["modelValue"])]),a(G,null,{default:u(()=>[r("div",tl,[a(I,{type:"primary",link:""},{default:u(()=>[V("辅助线")]),_:1})]),r("div",nl,[a(F,{modelValue:t.spotLightHelper,"onUpdate:modelValue":g[26]||(g[26]=D=>t.spotLightHelper=D),onChange:A},null,8,["modelValue"])])]),_:1})],2),r("div",{class:Y(["option",p.value])},[r("div",ol,[a(I,{type:"primary",link:""},{default:u(()=>[V("水平方向")]),_:1})]),r("div",sl,[a(k,{"show-input":"",onInput:A,modelValue:t.spotHorizontal,"onUpdate:modelValue":g[27]||(g[27]=D=>t.spotHorizontal=D),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),r("div",{class:Y(["option",p.value])},[r("div",il,[a(I,{type:"primary",link:""},{default:u(()=>[V("垂直方向")]),_:1})]),r("div",al,[a(k,{"show-input":"",onInput:A,modelValue:t.spotVertical,"onUpdate:modelValue":g[28]||(g[28]=D=>t.spotVertical=D),min:-10,max:10,step:.1},null,8,["modelValue"])])],2),r("div",{class:Y(["option",p.value])},[r("div",ll,[a(I,{type:"primary",link:""},{default:u(()=>[V("光源距离")]),_:1})]),r("div",rl,[a(k,{"show-input":"",onInput:A,modelValue:t.spotSistance,"onUpdate:modelValue":g[29]||(g[29]=D=>t.spotSistance=D),min:0,max:10,step:.1},null,8,["modelValue"])])],2),r("div",{class:Y(["option",p.value])},[r("div",cl,[a(I,{type:"primary",link:""},{default:u(()=>[V("光线照射范围")]),_:1})]),r("div",dl,[a(k,{"show-input":"",onInput:A,modelValue:t.spotAngle,"onUpdate:modelValue":g[30]||(g[30]=D=>t.spotAngle=D),min:0,max:2,step:.01},null,8,["modelValue"])])],2),r("div",{class:Y(["option",p.value])},[r("div",ul,[a(I,{type:"primary",link:""},{default:u(()=>[V("边缘聚光度")]),_:1})]),r("div",pl,[a(k,{"show-input":"",onInput:A,modelValue:t.spotPenumbra,"onUpdate:modelValue":g[31]||(g[31]=D=>t.spotPenumbra=D),min:0,max:1,step:.01},null,8,["modelValue"])])],2),r("div",{class:Y(["option",p.value])},[r("div",hl,[a(I,{type:"primary",link:""},{default:u(()=>[V("投影聚焦度")]),_:1})]),r("div",ml,[a(k,{"show-input":"",onInput:A,modelValue:t.spotFocus,"onUpdate:modelValue":g[32]||(g[32]=D=>t.spotFocus=D),min:0,max:3,step:.01},null,8,["modelValue"])])],2),r("div",{class:Y(["option",p.value])},[r("div",fl,[a(I,{type:"primary",link:""},{default:u(()=>[V("光源照射距离")]),_:1})]),r("div",gl,[a(k,{"show-input":"",onInput:A,modelValue:t.spotDistance,"onUpdate:modelValue":g[33]||(g[33]=D=>t.spotDistance=D),min:1,max:500,step:1},null,8,["modelValue"])])],2)])]),_:1})])}}},yl=Le(_l,[["__scopeId","data-v-70b883d5"]]),vl={class:"edit-box"},wl={class:"header"},xl=r("span",null,"后期处理",-1),Ml={class:"options"},bl={class:"option space-between"},Sl=r("span",null," 辉光 ",-1),Cl={class:"option"},Ll={class:"grid-txt"},Tl={class:"grid-silder"},El={class:"option"},Al={class:"grid-txt"},Il={class:"grid-silder"},Pl={class:"option"},kl={class:"grid-txt"},Rl={class:"grid-silder"},Vl={class:"option"},$l={class:"grid-txt"},Dl={class:"grid-silder"},Fl={class:"options"},Ul={class:"option space-between"},Ol=r("span",null," 色调曝光度 ",-1),zl={class:"grid-silder"},Hl={class:"header"},Nl=r("span",null,"模型操作",-1),Gl={class:"options"},Bl=r("span",null," 模型分解 ",-1),jl={class:"grid-silder"},Yl=r("span",null," 模型材质操作 ",-1),Xl={class:"grid-silder"},Wl={class:"grid-silder"},Zl={__name:"EditLaterStage",setup(o,{expose:e}){const n=xe(),{$bus:i}=Re().proxy,t=ee(()=>{const{glow:C}=d;return C?"":"disabled"}),l=ee(()=>{const C=n.modelApi.modelMaterialList,T=C.filter(A=>A.type=="Mesh");return T.length<=1||T.length!=C.length||d.manageFlage?"disabled":""}),s=ee(()=>{const C=n.modelApi.modelMaterialList,T=C.filter(A=>A.type=="Mesh");return T.length<=1||T.length!=C.length?"disabled":""}),c=ee(()=>d.manageFlage?"":"disabled"),d=he({glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlage:!1,manageFlage:!1,toneMappingExposure:2,color:""});Oe(()=>{i.on("update-model",()=>{Object.assign(d,{glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlage:!1,toneMappingExposure:2})})});const p=()=>{n.modelApi.onSetFlowColor(d.color)},m=C=>{d.color=C,n.modelApi.onSetFlowColor(d.color)},h=()=>{n.modelApi.onSetUnrealBloomPass(d)},w=()=>{n.modelApi.setModelMeshDecompose(d)},x=()=>{d.decompose=0,n.modelApi.setModelMeshDrag(d)},f=C=>{n.modelApi.setTransformControlsType(C)},S=()=>{Object.assign(d,{glow:!1,threshold:.05,strength:.6,radius:1,decompose:0,transformType:"translate",manageFlage:!1,toneMappingExposure:2}),n.modelApi.initStageFlow()};return e({getStageConfig:()=>({meshPositonList:n.modelApi.getMeshDragPosition(),...d})}),(C,T)=>{const A=v("el-button"),y=v("Sunny"),E=v("el-icon"),_=v("el-space"),M=v("WarnTriangleFilled"),b=v("el-switch"),g=v("el-tooltip"),I=v("el-color-picker"),P=v("el-slider"),R=v("Umbrella"),G=v("Cpu"),F=v("Rank"),U=v("el-radio-button"),k=v("el-radio-group");return O(),Q("div",vl,[r("div",wl,[xl,a(A,{type:"primary",icon:"Refresh",onClick:S},{default:u(()=>[V(" 重置 ")]),_:1})]),r("div",Ml,[r("div",bl,[a(_,null,{default:u(()=>[a(E,null,{default:u(()=>[a(y)]),_:1}),Sl]),_:1}),a(g,{effect:"dark",content:"注意：辉光效果十分耗费性能，大模型文件开启会有卡顿，请谨慎使用 ",placement:"top"},{default:u(()=>[a(_,null,{default:u(()=>[a(E,null,{default:u(()=>[a(M,{size:20,color:"#ffb940"})]),_:1}),a(b,{modelValue:d.glow,"onUpdate:modelValue":T[0]||(T[0]=j=>d.glow=j),onChange:h},null,8,["modelValue"])]),_:1})]),_:1})])]),r("div",{class:Y(["options",t.value])},[r("div",Cl,[r("div",Ll,[a(A,{type:"primary",link:""},{default:u(()=>[V("颜色")]),_:1})]),r("div",Tl,[a(I,{"color-format":"hex",predefine:ce(We),onChange:p,onActiveChange:m,modelValue:d.color,"onUpdate:modelValue":T[1]||(T[1]=j=>d.color=j)},null,8,["predefine","modelValue"])])]),r("div",El,[r("div",Al,[a(A,{type:"primary",link:""},{default:u(()=>[V("强度")]),_:1})]),r("div",Il,[a(P,{"show-input":"",modelValue:d.strength,"onUpdate:modelValue":T[2]||(T[2]=j=>d.strength=j),onInput:h,step:.01,min:0,max:8},null,8,["modelValue"])])]),r("div",Pl,[r("div",kl,[a(A,{type:"primary",link:""},{default:u(()=>[V("半径")]),_:1})]),r("div",Rl,[a(P,{"show-input":"",modelValue:d.radius,"onUpdate:modelValue":T[3]||(T[3]=j=>d.radius=j),onInput:h,step:.01,min:0,max:5},null,8,["modelValue"])])]),r("div",Vl,[r("div",$l,[a(A,{type:"primary",link:""},{default:u(()=>[V("阈值")]),_:1})]),r("div",Dl,[a(P,{"show-input":"",modelValue:d.threshold,"onUpdate:modelValue":T[4]||(T[4]=j=>d.threshold=j),onInput:h,step:.01,min:0,max:1},null,8,["modelValue"])])])],2),r("div",Fl,[r("div",Ul,[a(_,null,{default:u(()=>[a(E,null,{default:u(()=>[a(R)]),_:1}),Ol]),_:1}),r("div",zl,[a(P,{"show-input":"",modelValue:d.toneMappingExposure,"onUpdate:modelValue":T[5]||(T[5]=j=>d.toneMappingExposure=j),onInput:h,step:.01,min:.5,max:10},null,8,["modelValue"])])])]),r("div",Hl,[a(_,null,{default:u(()=>[Nl,l.value=="disabled"?(O(),ne(g,{key:0,effect:"dark",content:"当前模型不可进行以下操作",placement:"top"},{default:u(()=>[a(E,null,{default:u(()=>[a(M,{size:20,color:"#ffb940"})]),_:1})]),_:1})):ve("",!0)]),_:1})]),r("div",Gl,[r("div",{class:Y(["option space-between",l.value])},[a(_,null,{default:u(()=>[a(E,null,{default:u(()=>[a(G)]),_:1}),Bl]),_:1}),r("div",jl,[a(P,{"show-input":"",modelValue:d.decompose,"onUpdate:modelValue":T[6]||(T[6]=j=>d.decompose=j),onInput:w,step:.01,min:0,max:800},null,8,["modelValue"])])],2),r("div",{class:Y(["option",s.value])},[a(_,null,{default:u(()=>[a(E,null,{default:u(()=>[a(F,{size:20})]),_:1}),Yl]),_:1}),r("div",Xl,[a(b,{modelValue:d.manageFlage,"onUpdate:modelValue":T[7]||(T[7]=j=>d.manageFlage=j),onChange:x},null,8,["modelValue"])])],2),r("div",{class:Y(["option",c.value])},[r("div",Wl,[a(k,{modelValue:d.transformType,"onUpdate:modelValue":T[8]||(T[8]=j=>d.transformType=j),onChange:f},{default:u(()=>[a(U,{value:"translate"},{default:u(()=>[V("拖拽")]),_:1}),a(U,{value:"rotate"},{default:u(()=>[V("旋转")]),_:1}),a(U,{value:"scale"},{default:u(()=>[V("缩放")]),_:1})]),_:1},8,["modelValue"])])],2)])])}}},kn=o=>(Pe("data-v-e2c730b1"),o=o(),ke(),o),Ql={class:"edit-box"},ql=kn(()=>r("div",{class:"header"},[r("span",null,"几何体模型材质列表")],-1)),Kl={class:"options"},Jl=["onClick"],er={class:"icon-name"},tr={class:"check"},nr={class:"icon-delete"},or=kn(()=>r("div",{class:"header"},[r("span",null,"几何体模型编辑")],-1)),sr={class:"options"},ir={class:"grid-txt"},ar={class:"grid-silder"},lr={key:1},rr={__name:"EditGeometry",setup(o){const e=xe(),n=he({materialName:null,type:null}),i=te(null),t=te([]),l=ee(()=>s.modelMaterialList.filter(w=>w.userData.geometry)!=0),s=he({modelMaterialList:ee(()=>e.modelApi.modelMaterialList),selectMeshUuid:ee(()=>e.selectMeshUuid)});vn(()=>e.selectMeshUuid,h=>{const{geometry:w}=s.modelMaterialList.find(x=>x.uuid==h)||{};if(w){const{type:x}=w;i.value={...w.parameters},n.type=x,t.value=Object.keys(i.value)}else t.value=[]});const c=({name:h,material:w,geometry:x})=>{n.materialName=w.name,e.modelApi.onChangeModelMaterial(h)},d=()=>{e.modelApi.onSetGeometryMesh(i.value,n.type)},p=h=>{e.modelApi.onDeleteGeometryMesh(h),e.selectMeshAction({}),re.success("删除成功")},m=h=>{let w={min:1,max:80,step:.01};return["width","height","radius","length","thetaLength","radiusTop","innerRadius","radiusBottom","q","outerRadius","arc","tube","p"].includes(h)&&(w={min:.1,max:10,step:.01}),["detail","capSegments","radialSegments","thetaStart","depthSegments","widthSegments","heightSegments"].includes(h)&&(w={min:0,max:10,step:1}),w};return(h,w)=>{const x=v("Check"),f=v("el-icon"),S=v("Delete"),L=v("el-space"),C=v("el-scrollbar"),T=v("el-button"),A=v("el-slider"),y=v("el-switch"),E=v("el-empty");return O(),Q("div",Ql,[l.value?(O(),Q(pe,{key:0},[ql,r("div",Kl,[a(C,{"max-height":"300px"},{default:u(()=>[(O(!0),Q(pe,null,ge(s.modelMaterialList,_=>(O(),Q("div",{class:Y(["option",s.selectMeshUuid==_.uuid?"option-active":""]),onClick:M=>c(_),key:_.uuid},[r("div",er,ye(_.name),1),a(L,null,{default:u(()=>[ie(r("div",tr,[a(f,{size:"20px",color:"#2a3ff6"},{default:u(()=>[a(x)]),_:1})],512),[[le,s.selectMeshUuid==_.uuid]]),r("div",nr,[a(f,{size:"18px",color:"#2a3ff6"},{default:u(()=>[a(S,{onClick:Xe(M=>p(_.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)])]),_:2},1024)],10,Jl))),128))]),_:1})]),or,r("div",sr,[(O(!0),Q(pe,null,ge(t.value,_=>(O(),Q("div",{class:"option",key:_},[r("div",ir,[a(T,{type:"primary",link:""},{default:u(()=>[V(ye(_),1)]),_:2},1024)]),r("div",ar,[typeof i.value[_]=="number"?(O(),ne(A,{key:0,"show-input":"",modelValue:i.value[_],"onUpdate:modelValue":M=>i.value[_]=M,min:m(_).min,max:m(_).max,step:m(_).step,onInput:d},null,8,["modelValue","onUpdate:modelValue","min","max","step"])):typeof i.value[_]=="string"?(O(),Q("div",lr,ye(i.value[_]),1)):typeof i.value[_]=="boolean"?(O(),ne(y,{key:2,onChange:d,modelValue:i.value[_],"onUpdate:modelValue":M=>i.value[_]=M},null,8,["modelValue","onUpdate:modelValue"])):ve("",!0)])]))),128))])],64)):(O(),ne(E,{key:1,description:"当前模型不支持使用该功能","image-size":120}))])}}},cr=Le(rr,[["__scopeId","data-v-e2c730b1"]]),Ct=o=>(Pe("data-v-23a98923"),o=o(),ke(),o),dr={class:"edit-box"},ur=Ct(()=>r("div",{class:"header"},[r("span",null," 多模型列表 ")],-1)),pr={class:"options"},hr=["onClick"],mr={class:"icon-name"},fr={class:"check"},gr={class:"icon-delete"},_r=Ct(()=>r("div",{class:"header"},[r("span",null,"模型编辑")],-1)),yr={class:"options"},vr={class:"option space-between"},wr=Ct(()=>r("span",null," 模型轴旋转 ",-1)),xr={class:"option"},Mr={class:"option space-between"},br=Ct(()=>r("span",null," 模型位置 ",-1)),Sr={class:"option"},Cr={class:"grid-txt"},Lr={class:"grid-silder"},Tr={class:"option"},Er={class:"grid-txt"},Ar={class:"grid-silder"},Ir={class:"option"},Pr={class:"grid-txt"},kr={class:"grid-silder"},Rr={__name:"EditMoreModel",setup(o){const e=xe(),n=te(null),i=he({position:{x:0,y:0,z:0}}),t=ee(()=>e.modelApi.manyModelGroup.children.map(x=>({name:x.name,uuid:x.uuid}))),l=h=>{n.value=h.uuid;const{position:w}=e.modelApi.chooseManyModel(h.uuid);Object.assign(i,{position:w})},s=()=>{e.modelApi.deleteManyModel(n.value),re.success("删除成功"),n.value=null},c=(h,w)=>{const x=w=="right";e.modelApi.setManyModelRotation(h,x,n.value)},d=()=>{e.modelApi.initManyModelRotation(n.value)},p=()=>{e.modelApi.setManyModelPosition(i.position,n.value)},m=()=>{const h=e.modelApi.initManyModelPosition(n.value);Object.assign(i,{position:h})};return(h,w)=>{const x=v("Check"),f=v("el-icon"),S=v("Delete"),L=v("el-space"),C=v("el-empty"),T=v("el-scrollbar"),A=v("Setting"),y=v("el-button"),E=v("Location"),_=v("el-slider");return O(),Q("div",dr,[ur,r("div",pr,[a(T,{height:"200px"},{default:u(()=>[t.value.length?(O(!0),Q(pe,{key:0},ge(t.value,M=>(O(),Q("div",{class:Y(["option",n.value==M.uuid?"option-active":""]),onClick:b=>l(M),key:M.uuid},[r("div",mr,ye(M.name),1),a(L,null,{default:u(()=>[ie(r("div",fr,[a(f,{size:"20px",color:"#2a3ff6"},{default:u(()=>[a(x)]),_:1})],512),[[le,n.value==M.uuid]]),ie(r("div",gr,[a(f,{size:"18px",color:"#2a3ff6"},{default:u(()=>[a(S,{onClick:Xe(b=>s(M.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)],512),[[le,n.value==M.uuid]])]),_:2},1024)],10,hr))),128)):(O(),ne(C,{key:1,description:"切换多模型“场景”拖拽添加模型","image-size":100}))]),_:1})]),_r,ie(r("div",yr,[r("div",vr,[a(L,null,{default:u(()=>[a(f,null,{default:u(()=>[a(A)]),_:1}),wr]),_:1}),a(y,{type:"primary",link:"",icon:"Refresh",onClick:d},{default:u(()=>[V(" 重置 ")]),_:1})]),r("div",xr,[a(L,null,{default:u(()=>[a(y,{type:"info",icon:"RefreshRight",onClick:w[0]||(w[0]=M=>c("x","right"))}),a(y,{type:"primary",link:""},{default:u(()=>[V("X轴")]),_:1}),a(y,{type:"info",icon:"RefreshLeft",onClick:w[1]||(w[1]=M=>c("x","left"))})]),_:1}),a(L,null,{default:u(()=>[a(y,{type:"info",icon:"RefreshRight",onClick:w[2]||(w[2]=M=>c("y","right"))}),a(y,{type:"primary",link:""},{default:u(()=>[V("Y轴")]),_:1}),a(y,{type:"info",icon:"RefreshLeft",onClick:w[3]||(w[3]=M=>c("y","left"))})]),_:1}),a(L,null,{default:u(()=>[a(y,{type:"info",icon:"RefreshRight",onClick:w[4]||(w[4]=M=>c("z","right"))}),a(y,{type:"primary",link:""},{default:u(()=>[V("Z轴")]),_:1}),a(y,{type:"info",icon:"RefreshLeft",onClick:w[5]||(w[5]=M=>c("z","left"))})]),_:1})]),r("div",Mr,[a(L,null,{default:u(()=>[a(f,null,{default:u(()=>[a(E)]),_:1}),br]),_:1}),a(y,{type:"primary",link:"",icon:"Refresh",onClick:m},{default:u(()=>[V(" 重置 ")]),_:1})]),r("div",Sr,[r("div",Cr,[a(y,{type:"primary",link:""},{default:u(()=>[V("X 轴")]),_:1})]),r("div",Lr,[a(_,{onInput:p,"show-input":"",modelValue:i.position.x,"onUpdate:modelValue":w[6]||(w[6]=M=>i.position.x=M),min:-10,max:10,step:.1},null,8,["modelValue"])])]),r("div",Tr,[r("div",Er,[a(y,{type:"primary",link:""},{default:u(()=>[V("Y 轴")]),_:1})]),r("div",Ar,[a(_,{onInput:p,"show-input":"",modelValue:i.position.y,"onUpdate:modelValue":w[7]||(w[7]=M=>i.position.y=M),min:-10,max:10,step:.1},null,8,["modelValue"])])]),r("div",Ir,[r("div",Pr,[a(y,{type:"primary",link:""},{default:u(()=>[V("Z 轴")]),_:1})]),r("div",kr,[a(_,{onInput:p,"show-input":"",modelValue:i.position.z,"onUpdate:modelValue":w[8]||(w[8]=M=>i.position.z=M),min:-10,max:10,step:.1},null,8,["modelValue"])])])],512),[[le,n.value]])])}}},Vr=Le(Rr,[["__scopeId","data-v-23a98923"]]),rt=o=>(Pe("data-v-94407ce0"),o=o(),ke(),o),$r={class:"edit-box"},Dr={class:"header"},Fr=rt(()=>r("span",null," 标签配置 ",-1)),Ur={class:"options"},Or={class:"option"},zr=rt(()=>r("span",null,"标签类型",-1)),Hr=rt(()=>r("span",{style:{color:"#18c174 "}},"(可拖拽添加多个)",-1)),Nr={class:"tag-box"},Gr={class:"icon"},Br=rt(()=>r("div",{class:"options"},[r("div",{class:"header"},"标签列表")],-1)),jr={class:"options"},Yr=["onClick"],Xr={class:"icon-name"},Wr={class:"check"},Zr={class:"icon-delete"},Qr=rt(()=>r("div",{class:"header"},[r("span",null," 标签编辑 ")],-1)),qr={key:0,class:"options"},Kr={class:"option"},Jr={class:"grid-txt"},ec={class:"grid-silder"},tc={class:"option"},nc={class:"grid-txt"},oc={class:"grid-silder"},sc={class:"option"},ic={class:"grid-txt"},ac={class:"grid-silder"},lc={class:"option"},rc={class:"grid-txt"},cc={class:"grid-silder"},dc={class:"option"},uc={class:"grid-txt"},pc={class:"grid-silder"},hc={class:"option"},mc={class:"grid-txt"},fc={class:"grid-silder"},gc={class:"option"},_c={class:"grid-txt"},yc={class:"grid-silder"},vc={class:"grid-txt"},wc={class:"grid-silder"},xc={class:"grid-txt"},Mc={class:"grid-silder"},bc={class:"option"},Sc={class:"grid-txt"},Cc={class:"grid-silder"},Lc={class:"option",style:{height:"auto"}},Tc={class:"grid-txt"},Ec={class:"grid-silder"},Ac={__name:"EditTags",setup(o,{expose:e}){const n=xe(),i=We,t=he({dragTagList:ee(()=>n.modelApi.dragTagList)}),l=ee(()=>{const x=[];for(const[f]of Object.entries(wn))x.push({name:f});return x}),s=he({}),c=(x,f)=>{n.modelApi.setDragTag(f),n.changeDragType("tags")},d=x=>{x.preventDefault()},p=()=>{s.uuid=null,n.modelApi.clearSceneTags()},m=x=>{Object.assign(s,{...x})},h=x=>{n.modelApi.deleteTag(x),s.uuid=null},w=()=>{n.modelApi.updateTagElement(s)};return e({config:t}),(x,f)=>{const S=v("el-button"),L=v("PriceTag"),C=v("el-icon"),T=v("el-space"),A=v("el-col"),y=v("el-row"),E=v("el-scrollbar"),_=v("Check"),M=v("Delete"),b=v("el-empty"),g=v("el-slider"),I=v("el-color-picker"),P=v("el-input");return O(),Q("div",$r,[r("div",Dr,[Fr,a(S,{type:"primary",icon:"Refresh",onClick:p},{default:u(()=>[V(" 重置 ")]),_:1})]),r("div",Ur,[r("div",Or,[a(T,null,{default:u(()=>[a(C,null,{default:u(()=>[a(L)]),_:1}),zr,Hr]),_:1})]),a(E,{"max-height":"150px"},{default:u(()=>[a(y,{class:"tag-row"},{default:u(()=>[(O(!0),Q(pe,null,ge(l.value,R=>(O(),ne(A,{draggable:"true",key:R.name,span:4,onDragstart:G=>c(G,R),onDrag:f[0]||(f[0]=G=>d(G))},{default:u(()=>[r("div",Nr,[r("div",Gr,[a(C,{size:"16px"},{default:u(()=>[(O(),ne(xn(R.name)))]),_:2},1024)])])]),_:2},1032,["onDragstart"]))),128))]),_:1})]),_:1})]),Br,r("div",jr,[t.dragTagList.length?(O(),ne(E,{key:0,"max-height":"170px"},{default:u(()=>[(O(!0),Q(pe,null,ge(t.dragTagList,R=>(O(),Q("div",{class:Y(["option",s.uuid==R.uuid?"option-active":""]),onClick:G=>m(R),key:R.uuid},[r("div",Xr,ye(R.innerText),1),a(T,null,{default:u(()=>[ie(r("div",Wr,[a(C,{size:"18px",color:"#2a3ff6"},{default:u(()=>[a(_)]),_:1})],512),[[le,s.uuid==R.uuid]]),r("div",Zr,[a(C,{size:"18px",color:"#2a3ff6"},{default:u(()=>[a(M,{onClick:Xe(G=>h(R.uuid),["stop"])},null,8,["onClick"])]),_:2},1024)])]),_:2},1024)],10,Yr))),128))]),_:1})):(O(),ne(b,{key:1,description:"暂无标签","image-size":100}))]),Qr,s.uuid?(O(),Q("div",qr,[r("div",Kr,[r("div",Jr,[a(S,{type:"primary",link:""},{default:u(()=>[V("容器高度")]),_:1})]),r("div",ec,[a(g,{onInput:w,"show-input":"",modelValue:s.height,"onUpdate:modelValue":f[1]||(f[1]=R=>s.height=R),min:1,max:500,step:1},null,8,["modelValue"])])]),r("div",tc,[r("div",nc,[a(S,{type:"primary",link:""},{default:u(()=>[V("容器宽度")]),_:1})]),r("div",oc,[a(g,{onInput:w,"show-input":"",modelValue:s.width,"onUpdate:modelValue":f[2]||(f[2]=R=>s.width=R),min:1,max:500,step:1},null,8,["modelValue"])])]),r("div",sc,[r("div",ic,[a(S,{type:"primary",link:""},{default:u(()=>[V("字体大小")]),_:1})]),r("div",ac,[a(g,{onInput:w,"show-input":"",modelValue:s.fontSize,"onUpdate:modelValue":f[3]||(f[3]=R=>s.fontSize=R),min:1,max:50,step:.1},null,8,["modelValue"])])]),r("div",lc,[r("div",rc,[a(S,{type:"primary",link:""},{default:u(()=>[V("标签坐标X")]),_:1})]),r("div",cc,[a(g,{onInput:w,"show-input":"",modelValue:s.positionX,"onUpdate:modelValue":f[4]||(f[4]=R=>s.positionX=R),min:-50,max:50,step:.01},null,8,["modelValue"])])]),r("div",dc,[r("div",uc,[a(S,{type:"primary",link:""},{default:u(()=>[V("标签坐标Y")]),_:1})]),r("div",pc,[a(g,{onInput:w,"show-input":"",modelValue:s.positionY,"onUpdate:modelValue":f[5]||(f[5]=R=>s.positionY=R),min:-50,max:50,step:.1},null,8,["modelValue"])])]),r("div",hc,[r("div",mc,[a(S,{type:"primary",link:""},{default:u(()=>[V("标签坐标Z")]),_:1})]),r("div",fc,[a(g,{onInput:w,"show-input":"",modelValue:s.positionZ,"onUpdate:modelValue":f[6]||(f[6]=R=>s.positionZ=R),min:-50,max:50,step:.1},null,8,["modelValue"])])]),r("div",gc,[r("div",_c,[a(S,{type:"primary",link:""},{default:u(()=>[V("背景颜色")]),_:1})]),r("div",yc,[a(I,{"color-format":"hex",predefine:ce(i),onChange:w,modelValue:s.backgroundColor,"onUpdate:modelValue":f[7]||(f[7]=R=>s.backgroundColor=R)},null,8,["predefine","modelValue"])]),r("div",vc,[a(S,{type:"primary",link:""},{default:u(()=>[V("图标颜色")]),_:1})]),r("div",wc,[a(I,{"color-format":"hex",predefine:ce(i),onChange:w,modelValue:s.iconColor,"onUpdate:modelValue":f[8]||(f[8]=R=>s.iconColor=R)},null,8,["predefine","modelValue"])]),r("div",xc,[a(S,{type:"primary",link:""},{default:u(()=>[V("字体颜色")]),_:1})]),r("div",Mc,[a(I,{"color-format":"hex",predefine:ce(i),onChange:w,modelValue:s.color,"onUpdate:modelValue":f[9]||(f[9]=R=>s.color=R)},null,8,["predefine","modelValue"])])]),r("div",bc,[r("div",Sc,[a(S,{type:"primary",link:""},{default:u(()=>[V("图标大小")]),_:1})]),r("div",Cc,[a(g,{onInput:w,"show-input":"",modelValue:s.iconSize,"onUpdate:modelValue":f[10]||(f[10]=R=>s.iconSize=R),min:1,max:50,step:.1},null,8,["modelValue"])])]),r("div",Lc,[r("div",Tc,[a(S,{type:"primary",link:""},{default:u(()=>[V("标签内容")]),_:1})]),r("div",Ec,[a(P,{type:"textarea",autosize:{minRows:3,maxRows:3},onInput:w,modelValue:s.innerText,"onUpdate:modelValue":f[11]||(f[11]=R=>s.innerText=R),modelModifiers:{trim:!0}},null,8,["modelValue"])])])])):ve("",!0)])}}},Ic=Le(Ac,[["__scopeId","data-v-94407ce0"]]),Pc={class:"model-panel"},kc={class:"panel-tabs"},Rc=["onClick"],Vc={class:"tab"},$c={class:"panel-edit"},Dc={__name:"index",setup(o,{expose:e}){const{$bus:n}=Re().proxy,i=[{name:"背景",key:"EditBackground",icon:"Picture"},{name:"材质",key:"EditMaterial",icon:"DataAnalysis"},{name:"后期/操作",key:"EditLaterStage",icon:"MagicStick"},{name:"灯光",key:"EditLight",icon:"Sunrise"},{name:"模型动画",key:"EditAnimation",icon:"VideoCameraFilled"},{name:"辅助线/轴配置",key:"EditAttribute",icon:"Box"},{name:"几何体模型配置",key:"EditGeometry",icon:"Cellphone"},{name:"标签配置",key:"EditTags",icon:"CollectionTag"},{name:"多模型配置",key:"EditMoreModel",icon:"Money"}],t=te("EditMaterial"),l=te(null),s=te(null),c=te(null),d=te(null),p=te(null),m=te(null),h=te(null),w=te(null),x=te(null);return Oe(()=>{n.on("update-tab",S=>{t.value=S})}),e({getPanelConfig:()=>({background:l.value.config,material:s.value.getMeshConfig(),animation:c.value.config,attribute:d.value.getAttributeConfig(),light:p.value.config,stage:m.value.getStageConfig(),tags:w.value.config})}),(S,L)=>{const C=v("el-icon"),T=v("el-tooltip"),A=v("el-scrollbar");return O(),Q("div",Pc,[r("ul",kc,[(O(),Q(pe,null,ge(i,y=>r("li",{key:y.key,class:Y(t.value==y.key?"active":""),onClick:E=>t.value=y.key},[a(T,{effect:"light",content:y.name,placement:"top"},{default:u(()=>[r("div",Vc,[a(C,{size:"20px",color:t.value==y.key?"#fff":""},{default:u(()=>[(O(),ne(xn(y.icon)))]),_:2},1032,["color"])])]),_:2},1032,["content"])],10,Rc)),64))]),r("div",$c,[a(A,{"max-height":"832px"},{default:u(()=>[ie(r("div",null,[a(Es,{ref_key:"background",ref:l},null,512)],512),[[le,t.value=="EditBackground"]]),ie(r("div",null,[a(Ks,{ref_key:"material",ref:s},null,512)],512),[[le,t.value=="EditMaterial"]]),ie(r("div",null,[a(Zl,{ref_key:"stage",ref:m},null,512)],512),[[le,t.value=="EditLaterStage"]]),ie(r("div",null,[a(wi,{ref_key:"animation",ref:c},null,512)],512),[[le,t.value=="EditAnimation"]]),ie(r("div",null,[a(yl,{ref_key:"light",ref:p},null,512)],512),[[le,t.value=="EditLight"]]),ie(r("div",null,[a(oa,{ref_key:"attribute",ref:d},null,512)],512),[[le,t.value=="EditAttribute"]]),ie(r("div",null,[a(cr,{ref_key:"geometry",ref:h},null,512)],512),[[le,t.value=="EditGeometry"]]),ie(r("div",null,[a(Ic,{ref_key:"tags",ref:w},null,512)],512),[[le,t.value=="EditTags"]]),ie(r("div",null,[a(Vr,{ref_key:"more",ref:x},null,512)],512),[[le,t.value=="EditMoreModel"]])]),_:1})])])}}},Fc=Le(Dc,[["__scopeId","data-v-7f124b24"]]),Uc={class:"model-choose"},Oc={class:"header"},zc={class:"options"},Hc={class:"option"},Nc=r("span",null,"普通模型",-1),Gc={class:"options"},Bc={class:"option"},jc=r("span",null,"动画模型",-1),Yc={class:"options"},Xc={class:"option"},Wc=r("span",null,"几何体模型",-1),Zc={key:0,style:{color:"#18c174 "}},Qc=["onDragstart"],qc={class:"geometry-name"},Kc={key:1,class:"geometry-box"},Jc={class:"icon"},ed=r("div",null,[r("span",null,"添加几何体模型")],-1),td={class:"options"},nd={class:"option"},od=r("span",null,"外部模型",-1),sd={class:"file-name"},id=r("span",null,"当前模型:",-1),ad={class:"upload"},ld={class:"icon"},rd=r("div",null,[r("span",null,"请选择(目前仅支持.glb, .obj, .gltf, .fbx, .stl格式)")],-1),cd={__name:"index",setup(o,{expose:e}){const n={oneModel:{text:"单模型",tooltip:"当前为单模型编辑模式，通过点击加载不同模型",draggable:!1,switchType:"many"},many:{text:"多模型",tooltip:"当前为多模型编辑模式：通过拖拽添加多个模型",draggable:!0,switchType:"oneModel"},geometry:{text:"几何体",tooltip:"当前为几何体模型编辑模式：通过拖拽添加多个几何体模型",draggable:!1,switchType:"oneModel"}},i=xe(),{$bus:t}=Re().proxy,l=ee(()=>Ft.filter(C=>!C.animation)),s=ee(()=>Ft.filter(C=>C.animation)),c=ee(()=>d.modeEditType=="many"?{textAlign:"center",cursor:"all-scroll"}:{textAlign:"center",cursor:"pointer"}),d=he({activeModelId:9,geometryVisible:!1,modeEditType:"oneModel",localModelName:null}),p=te({name:"变形金刚（3）",fileType:"glb",id:9,animation:!1,filePath:"threeFile/glb/glb-9.glb",icon:je("model-icon/4.png"),decomposeName:"transformers_3",key:"transformers-3"}),m=async C=>{if(C=="many")Mn.confirm("通过拖拽添加多个模型","切换为多模型编辑模式?",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{Object.assign(d,{modeEditType:C,localModelName:null,geometryVisible:!1}),i.changeDragType("manyModel"),i.modelApi.clearSceneModel(),re.success("切换成功：当前为多模型编辑模式")});else if(["geometry","oneModel"].includes(C)){t.emit("page-loading",!0);try{const{load:T}=await i.modelApi.onSwitchModel(p.value);T&&(Object.assign(d,{modeEditType:"oneModel",activeModelId:p.value.id,localModelName:null,geometryVisible:!1}),t.emit("update-model"),t.emit("page-loading",!1),i.changeDragType("oneModel"),re.success("切换成功：当前为单模型编辑模式"))}catch{t.emit("page-loading",!1)}}},h=async C=>{if(C.id==d.activeModelId||d.modeEditType=="many")return!1;p.value=C,Object.assign(d,{activeModelId:C.id,localModelName:null,modeEditType:"oneModel",geometryVisible:!1}),t.emit("page-loading",!0);try{const{load:T}=await i.modelApi.onSwitchModel(C);T&&(t.emit("update-model"),t.emit("page-loading",!1))}catch{t.emit("page-loading",!1)}},w=async()=>{Object.assign(d,{activeModelId:null,localModelName:null,modeEditType:"geometry",geometryVisible:!0}),i.modelApi.clearSceneModel()},x=(C,T)=>{i.modelApi.setDragGeometryModel(T),i.changeDragType("geometry")},f=C=>{C.preventDefault()},S=C=>{i.changeDragType("manyModel"),i.modelApi.setDragManyModel(C)},L=async C=>{d.localModelName=C.name;const A={filePath:URL.createObjectURL(C.raw),fileType:zt(C.name)};t.emit("page-loading",!0);try{const{load:y,filePath:E}=await i.modelApi.onSwitchModel(A);URL.revokeObjectURL(E),y&&(t.emit("update-model"),t.emit("page-loading",!1),Object.assign(d,{activeModelId:null,geometryVisible:!1}))}catch{d.localModelName=null,t.emit("page-loading",!1)}};return e({activeModel:p}),(C,T)=>{var j,se;const A=v("el-button"),y=v("el-tooltip"),E=v("Orange"),_=v("el-icon"),M=v("el-space"),b=v("el-image"),g=v("el-col"),I=v("el-row"),P=v("el-scrollbar"),R=v("Paperclip"),G=v("SwitchFilled"),F=v("Plus"),U=v("UploadFilled"),k=v("el-upload");return O(),Q("div",Uc,[r("div",Oc,[r("span",null,"当前场景编辑模式:"+ye((j=n[d.modeEditType])==null?void 0:j.text),1),a(y,{effect:"dark",content:(se=n[d.modeEditType])==null?void 0:se.tooltip,placement:"top"},{default:u(()=>[a(A,{type:"primary",icon:"Refresh",onClick:T[0]||(T[0]=X=>{var J;return m((J=n[d.modeEditType])==null?void 0:J.switchType)})},{default:u(()=>[V(" 切换场景 ")]),_:1})]),_:1},8,["content"])]),r("div",zc,[r("div",Hc,[a(M,null,{default:u(()=>[a(_,null,{default:u(()=>[a(E)]),_:1}),Nc]),_:1})]),a(P,{"max-height":"210px"},{default:u(()=>[a(I,null,{default:u(()=>[(O(!0),Q(pe,null,ge(l.value,X=>{var J;return O(),ne(g,{draggable:(J=n[d.modeEditType])==null?void 0:J.draggable,style:Yt(c.value),span:12,onDragstart:D=>S(X),onDrag:T[1]||(T[1]=D=>f(D)),key:X.id},{default:u(()=>[a(b,{draggable:"false",onClick:Xe(D=>h(X),["prevent"]),class:Y(["el-img",d.activeModelId==X.id?"active-model":""]),src:X.icon,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1032,["draggable","style","onDragstart"])}),128))]),_:1})]),_:1})]),r("div",Gc,[r("div",Bc,[a(M,null,{default:u(()=>[a(_,null,{default:u(()=>[a(R)]),_:1}),jc]),_:1})]),a(P,{"max-height":"210px"},{default:u(()=>[a(I,null,{default:u(()=>[(O(!0),Q(pe,null,ge(s.value,X=>{var J;return O(),ne(g,{draggable:(J=n[d.modeEditType])==null?void 0:J.draggable,style:Yt(c.value),span:12,onDragstart:D=>S(X),onDrag:T[2]||(T[2]=D=>f(D)),key:X.id},{default:u(()=>[a(b,{draggable:"false",onClick:D=>h(X),class:Y(["el-img",d.activeModelId==X.id?"active-model":""]),src:X.icon,fit:"cover"},null,8,["onClick","class","src"])]),_:2},1032,["draggable","style","onDragstart"])}),128))]),_:1})]),_:1})]),r("div",Yc,[r("div",Xc,[a(M,null,{default:u(()=>[a(_,null,{default:u(()=>[a(G)]),_:1}),Wc,d.geometryVisible?(O(),Q("span",Zc,"(可拖拽添加多个)")):ve("",!0)]),_:1})]),a(P,{"max-height":"120px"},{default:u(()=>[d.geometryVisible?(O(),ne(I,{key:0},{default:u(()=>[(O(!0),Q(pe,null,ge(ce(Kn),X=>(O(),ne(g,{style:{textAlign:"center"},span:8,key:X.type},{default:u(()=>[r("div",{class:Y(["geometry",d.activeModelId==X.id?"active-model":""]),draggable:"true",onDragstart:J=>x(J,X),onDrag:T[3]||(T[3]=J=>f(J))},[r("div",qc,[a(y,{effect:"dark",content:`${X.name}:${X.type}`,placement:"top"},{default:u(()=>[r("b",null,ye(X.name),1)]),_:2},1032,["content"])])],42,Qc)]),_:2},1024))),128))]),_:1})):(O(),Q("div",Kc,[r("div",{class:"geometry-add",onClick:w},[r("div",Jc,[a(_,{size:44},{default:u(()=>[a(F)]),_:1}),ed])])]))]),_:1})]),r("div",td,[r("div",nd,[a(M,null,{default:u(()=>[a(_,null,{default:u(()=>[a(U)]),_:1}),od]),_:1})]),r("div",sd,[id,a(y,{effect:"dark",content:d.localModelName,placement:"top"},{default:u(()=>[r("b",null,ye(d.localModelName),1)]),_:1},8,["content"])]),a(k,{action:"",accept:".glb,.obj,.gltf,.fbx,.stl",class:"file-box","show-file-list":!1,"auto-upload":!1,"on-change":L},{default:u(()=>[r("div",ad,[r("div",ld,[a(_,{size:44},{default:u(()=>[a(F)]),_:1}),rd])])]),_:1})])])}}};var Rn={exports:{}};/*!
* clipboard.js v2.0.11
* https://clipboardjs.com/
*
* Licensed MIT © Zeno Rocha
*/(function(o,e){(function(i,t){o.exports=t()})(zn,function(){return function(){var n={686:function(l,s,c){c.d(s,{default:function(){return D}});var d=c(279),p=c.n(d),m=c(370),h=c.n(m),w=c(817),x=c.n(w);function f(B){try{return document.execCommand(B)}catch{return!1}}var S=function($){var z=x()($);return f("cut"),z},L=S;function C(B){var $=document.documentElement.getAttribute("dir")==="rtl",z=document.createElement("textarea");z.style.fontSize="12pt",z.style.border="0",z.style.padding="0",z.style.margin="0",z.style.position="absolute",z.style[$?"right":"left"]="-9999px";var W=window.pageYOffset||document.documentElement.scrollTop;return z.style.top="".concat(W,"px"),z.setAttribute("readonly",""),z.value=B,z}var T=function($,z){var W=C($);z.container.appendChild(W);var Z=x()(W);return f("copy"),W.remove(),Z},A=function($){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},W="";return typeof $=="string"?W=T($,z):$ instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes($==null?void 0:$.type)?W=T($.value,z):(W=x()($),f("copy")),W},y=A;function E(B){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?E=function(z){return typeof z}:E=function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},E(B)}var _=function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=$.action,W=z===void 0?"copy":z,Z=$.container,H=$.target,me=$.text;if(W!=="copy"&&W!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(H!==void 0)if(H&&E(H)==="object"&&H.nodeType===1){if(W==="copy"&&H.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(W==="cut"&&(H.hasAttribute("readonly")||H.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(me)return y(me,{container:Z});if(H)return W==="cut"?L(H):y(H,{container:Z})},M=_;function b(B){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?b=function(z){return typeof z}:b=function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},b(B)}function g(B,$){if(!(B instanceof $))throw new TypeError("Cannot call a class as a function")}function I(B,$){for(var z=0;z<$.length;z++){var W=$[z];W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(B,W.key,W)}}function P(B,$,z){return $&&I(B.prototype,$),z&&I(B,z),B}function R(B,$){if(typeof $!="function"&&$!==null)throw new TypeError("Super expression must either be null or a function");B.prototype=Object.create($&&$.prototype,{constructor:{value:B,writable:!0,configurable:!0}}),$&&G(B,$)}function G(B,$){return G=Object.setPrototypeOf||function(W,Z){return W.__proto__=Z,W},G(B,$)}function F(B){var $=j();return function(){var W=se(B),Z;if($){var H=se(this).constructor;Z=Reflect.construct(W,arguments,H)}else Z=W.apply(this,arguments);return U(this,Z)}}function U(B,$){return $&&(b($)==="object"||typeof $=="function")?$:k(B)}function k(B){if(B===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}function j(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function se(B){return se=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},se(B)}function X(B,$){var z="data-clipboard-".concat(B);if($.hasAttribute(z))return $.getAttribute(z)}var J=function(B){R(z,B);var $=F(z);function z(W,Z){var H;return g(this,z),H=$.call(this),H.resolveOptions(Z),H.listenClick(W),H}return P(z,[{key:"resolveOptions",value:function(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof Z.action=="function"?Z.action:this.defaultAction,this.target=typeof Z.target=="function"?Z.target:this.defaultTarget,this.text=typeof Z.text=="function"?Z.text:this.defaultText,this.container=b(Z.container)==="object"?Z.container:document.body}},{key:"listenClick",value:function(Z){var H=this;this.listener=h()(Z,"click",function(me){return H.onClick(me)})}},{key:"onClick",value:function(Z){var H=Z.delegateTarget||Z.currentTarget,me=this.action(H)||"copy",ct=M({action:me,container:this.container,target:this.target(H),text:this.text(H)});this.emit(ct?"success":"error",{action:me,text:ct,trigger:H,clearSelection:function(){H&&H.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(Z){return X("action",Z)}},{key:"defaultTarget",value:function(Z){var H=X("target",Z);if(H)return document.querySelector(H)}},{key:"defaultText",value:function(Z){return X("text",Z)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(Z){var H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return y(Z,H)}},{key:"cut",value:function(Z){return L(Z)}},{key:"isSupported",value:function(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],H=typeof Z=="string"?[Z]:Z,me=!!document.queryCommandSupported;return H.forEach(function(ct){me=me&&!!document.queryCommandSupported(ct)}),me}}]),z}(p()),D=J},828:function(l){var s=9;if(typeof Element<"u"&&!Element.prototype.matches){var c=Element.prototype;c.matches=c.matchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector||c.webkitMatchesSelector}function d(p,m){for(;p&&p.nodeType!==s;){if(typeof p.matches=="function"&&p.matches(m))return p;p=p.parentNode}}l.exports=d},438:function(l,s,c){var d=c(828);function p(w,x,f,S,L){var C=h.apply(this,arguments);return w.addEventListener(f,C,L),{destroy:function(){w.removeEventListener(f,C,L)}}}function m(w,x,f,S,L){return typeof w.addEventListener=="function"?p.apply(null,arguments):typeof f=="function"?p.bind(null,document).apply(null,arguments):(typeof w=="string"&&(w=document.querySelectorAll(w)),Array.prototype.map.call(w,function(C){return p(C,x,f,S,L)}))}function h(w,x,f,S){return function(L){L.delegateTarget=d(L.target,x),L.delegateTarget&&S.call(w,L)}}l.exports=m},879:function(l,s){s.node=function(c){return c!==void 0&&c instanceof HTMLElement&&c.nodeType===1},s.nodeList=function(c){var d=Object.prototype.toString.call(c);return c!==void 0&&(d==="[object NodeList]"||d==="[object HTMLCollection]")&&"length"in c&&(c.length===0||s.node(c[0]))},s.string=function(c){return typeof c=="string"||c instanceof String},s.fn=function(c){var d=Object.prototype.toString.call(c);return d==="[object Function]"}},370:function(l,s,c){var d=c(879),p=c(438);function m(f,S,L){if(!f&&!S&&!L)throw new Error("Missing required arguments");if(!d.string(S))throw new TypeError("Second argument must be a String");if(!d.fn(L))throw new TypeError("Third argument must be a Function");if(d.node(f))return h(f,S,L);if(d.nodeList(f))return w(f,S,L);if(d.string(f))return x(f,S,L);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function h(f,S,L){return f.addEventListener(S,L),{destroy:function(){f.removeEventListener(S,L)}}}function w(f,S,L){return Array.prototype.forEach.call(f,function(C){C.addEventListener(S,L)}),{destroy:function(){Array.prototype.forEach.call(f,function(C){C.removeEventListener(S,L)})}}}function x(f,S,L){return p(document.body,f,S,L)}l.exports=m},817:function(l){function s(c){var d;if(c.nodeName==="SELECT")c.focus(),d=c.value;else if(c.nodeName==="INPUT"||c.nodeName==="TEXTAREA"){var p=c.hasAttribute("readonly");p||c.setAttribute("readonly",""),c.select(),c.setSelectionRange(0,c.value.length),p||c.removeAttribute("readonly"),d=c.value}else{c.hasAttribute("contenteditable")&&c.focus();var m=window.getSelection(),h=document.createRange();h.selectNodeContents(c),m.removeAllRanges(),m.addRange(h),d=m.toString()}return d}l.exports=s},279:function(l){function s(){}s.prototype={on:function(c,d,p){var m=this.e||(this.e={});return(m[c]||(m[c]=[])).push({fn:d,ctx:p}),this},once:function(c,d,p){var m=this;function h(){m.off(c,h),d.apply(p,arguments)}return h._=d,this.on(c,h,p)},emit:function(c){var d=[].slice.call(arguments,1),p=((this.e||(this.e={}))[c]||[]).slice(),m=0,h=p.length;for(m;m<h;m++)p[m].fn.apply(p[m].ctx,d);return this},off:function(c,d){var p=this.e||(this.e={}),m=p[c],h=[];if(m&&d)for(var w=0,x=m.length;w<x;w++)m[w].fn!==d&&m[w].fn._!==d&&h.push(m[w]);return h.length?p[c]=h:delete p[c],this}},l.exports=s,l.exports.TinyEmitter=s}},i={};function t(l){if(i[l])return i[l].exports;var s=i[l]={exports:{}};return n[l](s,s.exports,t),s.exports}return function(){t.n=function(l){var s=l&&l.__esModule?function(){return l.default}:function(){return l};return t.d(s,{a:s}),s}}(),function(){t.d=function(l,s){for(var c in s)t.o(s,c)&&!t.o(l,c)&&Object.defineProperty(l,c,{enumerable:!0,get:s[c]})}}(),function(){t.o=function(l,s){return Object.prototype.hasOwnProperty.call(l,s)}}(),t(686)}().default})})(Rn);var dd=Rn.exports;const ud=Hn(dd),pd={class:"code"},hd={class:"dialog-footer"},md={__name:"index",setup(o,{expose:e}){const n=te(!1),i=te(null),t=he({width:400,height:300}),l=ee(()=>{const d=i.value.replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,"'$1'"),p=`${Jn}?modelConfig=`+d;return`<iframe  width="${t.width}" height="${t.height}" src="${p}" allowfullscreen></iframe>`}),s=d=>{n.value=!0,i.value=JSON.stringify(d)},c=()=>{const d=new ud(".copy-button",{text:()=>l.value});d.on("success",p=>{re.success("复制成功,将代码粘贴至你的项目中即可"),d.destroy(),n.value=!1}),d.on("error",()=>{console.log("复制失败"),d.destroy()})};return e({showDialog:s}),(d,p)=>{const m=v("el-scrollbar"),h=v("el-text"),w=v("el-input-number"),x=v("el-col"),f=v("el-row"),S=v("el-button"),L=v("el-dialog");return O(),ne(L,{modelValue:n.value,"onUpdate:modelValue":p[2]||(p[2]=C=>n.value=C),title:"将当前编辑效果嵌入你的项目",width:"600px","close-on-click-modal":!1},{footer:u(()=>[r("span",hd,[a(S,{type:"primary",class:"copy-button",onClick:c},{default:u(()=>[V(" 复制代码 ")]),_:1})])]),default:u(()=>[a(m,{"max-height":"400px"},{default:u(()=>[r("code",pd,ye(l.value),1)]),_:1}),a(f,{style:{marginTop:"10px"}},{default:u(()=>[a(x,{span:12},{default:u(()=>[a(h,{type:"primary"},{default:u(()=>[V("容器宽度")]),_:1}),a(w,{class:"number-style",precision:0,modelValue:t.width,"onUpdate:modelValue":p[0]||(p[0]=C=>t.width=C)},null,8,["modelValue"])]),_:1}),a(x,{span:12},{default:u(()=>[a(h,{type:"primary"},{default:u(()=>[V("容器高度")]),_:1}),a(w,{class:"number-style",precision:0,modelValue:t.height,"onUpdate:modelValue":p[1]||(p[1]=C=>t.height=C)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},fd=Le(md,[["__scopeId","data-v-5000b3b9"]]);let qe,Pt,Ge,ft;function kt(o,e=1/0,n=null){Pt||(Pt=new bt(2,2,1,1)),Ge||(Ge=new bn({uniforms:{blitTexture:new eo(o)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Ge.uniforms.blitTexture.value=o,Ge.defines.IS_SRGB=o.colorSpace==at,Ge.needsUpdate=!0,ft||(ft=new N(Pt,Ge),ft.frustumCulled=!1);const i=new Sn,t=new Ye;t.add(ft),n===null&&(n=qe=new Cn({antialias:!1}));const l=Math.min(o.image.width,e),s=Math.min(o.image.height,e);n.setSize(l,s),n.clear(),n.render(t,i);const c=document.createElement("canvas"),d=c.getContext("2d");c.width=l,c.height=s,d.drawImage(n.domElement,0,0,l,s);const p=new to(c);return p.minFilter=o.minFilter,p.magFilter=o.magFilter,p.wrapS=o.wrapS,p.wrapT=o.wrapT,p.name=o.name,qe&&(qe.forceContextLoss(),qe.dispose(),qe=null),p}const on={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Bt{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Cd(e)}),this.register(function(e){return new Ld(e)}),this.register(function(e){return new Id(e)}),this.register(function(e){return new Pd(e)}),this.register(function(e){return new kd(e)}),this.register(function(e){return new Rd(e)}),this.register(function(e){return new Td(e)}),this.register(function(e){return new Ed(e)}),this.register(function(e){return new Ad(e)}),this.register(function(e){return new Vd(e)}),this.register(function(e){return new $d(e)}),this.register(function(e){return new Dd(e)}),this.register(function(e){return new Fd(e)}),this.register(function(e){return new Ud(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,i,t){const l=new Sd,s=[];for(let c=0,d=this.pluginCallbacks.length;c<d;c++)s.push(this.pluginCallbacks[c](l));l.setPlugins(s),l.write(e,n,t).catch(i)}parseAsync(e,n){const i=this;return new Promise(function(t,l){i.parse(e,t,l,n)})}}const K={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Rt="KHR_mesh_quantization",we={};we[ao]=K.NEAREST;we[lo]=K.NEAREST_MIPMAP_NEAREST;we[ro]=K.NEAREST_MIPMAP_LINEAR;we[Se]=K.LINEAR;we[co]=K.LINEAR_MIPMAP_NEAREST;we[uo]=K.LINEAR_MIPMAP_LINEAR;we[po]=K.CLAMP_TO_EDGE;we[ho]=K.REPEAT;we[it]=K.MIRRORED_REPEAT;const sn={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},gd=new de,an=12,_d=1179937895,yd=2,ln=8,vd=1313821514,wd=5130562;function et(o,e){return o.length===e.length&&o.every(function(n,i){return n===e[i]})}function xd(o){return new TextEncoder().encode(o).buffer}function Md(o){return et(o.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function bd(o,e,n){const i={min:new Array(o.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(o.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let t=e;t<e+n;t++)for(let l=0;l<o.itemSize;l++){let s;o.itemSize>4?s=o.array[t*o.itemSize+l]:(l===0?s=o.getX(t):l===1?s=o.getY(t):l===2?s=o.getZ(t):l===3&&(s=o.getW(t)),o.normalized===!0&&(s=Ut.normalize(s,o.array))),i.min[l]=Math.min(i.min[l],s),i.max[l]=Math.max(i.max[l],s)}return i}function Vn(o){return Math.ceil(o/4)*4}function Vt(o,e=0){const n=Vn(o.byteLength);if(n!==o.byteLength){const i=new Uint8Array(n);if(i.set(new Uint8Array(o)),e!==0)for(let t=o.byteLength;t<n;t++)i[t]=e;return i.buffer}return o}function rn(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function cn(o,e){if(o.toBlob!==void 0)return new Promise(i=>o.toBlob(i,e));let n;return e==="image/jpeg"?n=.92:e==="image/webp"&&(n=.8),o.convertToBlob({type:e,quality:n})}class Sd{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+Ln}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,n,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const t=this,l=t.buffers,s=t.json;i=t.options;const c=t.extensionsUsed,d=t.extensionsRequired,p=new Blob(l,{type:"application/octet-stream"}),m=Object.keys(c),h=Object.keys(d);if(m.length>0&&(s.extensionsUsed=m),h.length>0&&(s.extensionsRequired=h),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=p.size),i.binary===!0){const w=new FileReader;w.readAsArrayBuffer(p),w.onloadend=function(){const x=Vt(w.result),f=new DataView(new ArrayBuffer(ln));f.setUint32(0,x.byteLength,!0),f.setUint32(4,wd,!0);const S=Vt(xd(JSON.stringify(s)),32),L=new DataView(new ArrayBuffer(ln));L.setUint32(0,S.byteLength,!0),L.setUint32(4,vd,!0);const C=new ArrayBuffer(an),T=new DataView(C);T.setUint32(0,_d,!0),T.setUint32(4,yd,!0);const A=an+L.byteLength+S.byteLength+f.byteLength+x.byteLength;T.setUint32(8,A,!0);const y=new Blob([C,L,S,f,x],{type:"application/octet-stream"}),E=new FileReader;E.readAsArrayBuffer(y),E.onloadend=function(){n(E.result)}}}else if(s.buffers&&s.buffers.length>0){const w=new FileReader;w.readAsDataURL(p),w.onloadend=function(){const x=w.result;s.buffers[0].uri=x,n(s)}}else n(s)}serializeUserData(e,n){if(Object.keys(e.userData).length===0)return;const i=this.options,t=this.extensionsUsed;try{const l=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&l.gltfExtensions){n.extensions===void 0&&(n.extensions={});for(const s in l.gltfExtensions)n.extensions[s]=l.gltfExtensions[s],t[s]=!0;delete l.gltfExtensions}Object.keys(l).length>0&&(n.extras=l)}catch(l){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+l.message)}}getUID(e,n=!1){if(this.uids.has(e)===!1){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(n)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new q;for(let t=0,l=e.count;t<l;t++)if(Math.abs(i.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const n=this.cache;if(n.attributesNormalized.has(e))return n.attributesNormalized.get(e);const i=e.clone(),t=new q;for(let l=0,s=i.count;l<s;l++)t.fromBufferAttribute(i,l),t.x===0&&t.y===0&&t.z===0?t.setX(1):t.normalize(),i.setXYZ(l,t.x,t.y,t.z);return n.attributesNormalized.set(e,i),i}applyTextureTransform(e,n){let i=!1;const t={};(n.offset.x!==0||n.offset.y!==0)&&(t.offset=n.offset.toArray(),i=!0),n.rotation!==0&&(t.rotation=n.rotation,i=!0),(n.repeat.x!==1||n.repeat.y!==1)&&(t.scale=n.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=t,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,n){if(e===n)return e;function i(x){return x.colorSpace===at?function(S){return S<.04045?S*.0773993808:Math.pow(S*.9478672986+.0521327014,2.4)}:function(S){return S}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Tt&&(e=kt(e)),n instanceof Tt&&(n=kt(n));const t=e?e.image:null,l=n?n.image:null,s=Math.max(t?t.width:0,l?l.width:0),c=Math.max(t?t.height:0,l?l.height:0),d=rn();d.width=s,d.height=c;const p=d.getContext("2d",{willReadFrequently:!0});p.fillStyle="#00ffff",p.fillRect(0,0,s,c);const m=p.getImageData(0,0,s,c);if(t){p.drawImage(t,0,0,s,c);const x=i(e),f=p.getImageData(0,0,s,c).data;for(let S=2;S<f.length;S+=4)m.data[S]=x(f[S]/256)*256}if(l){p.drawImage(l,0,0,s,c);const x=i(n),f=p.getImageData(0,0,s,c).data;for(let S=1;S<f.length;S+=4)m.data[S]=x(f[S]/256)*256}p.putImageData(m,0,0);const w=(e||n).clone();return w.source=new no(d),w.colorSpace=oo,w.channel=(e||n).channel,e&&n&&e.channel!==n.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),w}processBuffer(e){const n=this.json,i=this.buffers;return n.buffers||(n.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,n,i,t,l){const s=this.json;s.bufferViews||(s.bufferViews=[]);let c;switch(n){case K.BYTE:case K.UNSIGNED_BYTE:c=1;break;case K.SHORT:case K.UNSIGNED_SHORT:c=2;break;default:c=4}let d=e.itemSize*c;l===K.ARRAY_BUFFER&&(d=Math.ceil(d/4)*4);const p=Vn(t*d),m=new DataView(new ArrayBuffer(p));let h=0;for(let f=i;f<i+t;f++){for(let S=0;S<e.itemSize;S++){let L;e.itemSize>4?L=e.array[f*e.itemSize+S]:(S===0?L=e.getX(f):S===1?L=e.getY(f):S===2?L=e.getZ(f):S===3&&(L=e.getW(f)),e.normalized===!0&&(L=Ut.normalize(L,e.array))),n===K.FLOAT?m.setFloat32(h,L,!0):n===K.INT?m.setInt32(h,L,!0):n===K.UNSIGNED_INT?m.setUint32(h,L,!0):n===K.SHORT?m.setInt16(h,L,!0):n===K.UNSIGNED_SHORT?m.setUint16(h,L,!0):n===K.BYTE?m.setInt8(h,L):n===K.UNSIGNED_BYTE&&m.setUint8(h,L),h+=c}h%d!==0&&(h+=d-h%d)}const w={buffer:this.processBuffer(m.buffer),byteOffset:this.byteOffset,byteLength:p};return l!==void 0&&(w.target=l),l===K.ARRAY_BUFFER&&(w.byteStride=d),this.byteOffset+=p,s.bufferViews.push(w),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const n=this,i=n.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(t){const l=new FileReader;l.readAsArrayBuffer(e),l.onloadend=function(){const s=Vt(l.result),c={buffer:n.processBuffer(s),byteOffset:n.byteOffset,byteLength:s.byteLength};n.byteOffset+=s.byteLength,t(i.bufferViews.push(c)-1)}})}processAccessor(e,n,i,t){const l=this.json,s={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let c;if(e.array.constructor===Float32Array)c=K.FLOAT;else if(e.array.constructor===Int32Array)c=K.INT;else if(e.array.constructor===Uint32Array)c=K.UNSIGNED_INT;else if(e.array.constructor===Int16Array)c=K.SHORT;else if(e.array.constructor===Uint16Array)c=K.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)c=K.BYTE;else if(e.array.constructor===Uint8Array)c=K.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(i===void 0&&(i=0),(t===void 0||t===1/0)&&(t=e.count),t===0)return null;const d=bd(e,i,t);let p;n!==void 0&&(p=e===n.index?K.ELEMENT_ARRAY_BUFFER:K.ARRAY_BUFFER);const m=this.processBufferView(e,c,i,t,p),h={bufferView:m.id,byteOffset:m.byteOffset,componentType:c,count:t,max:d.max,min:d.min,type:s[e.itemSize]};return e.normalized===!0&&(h.normalized=!0),l.accessors||(l.accessors=[]),l.accessors.push(h)-1}processImage(e,n,i,t="image/png"){if(e!==null){const l=this,s=l.cache,c=l.json,d=l.options,p=l.pending;s.images.has(e)||s.images.set(e,{});const m=s.images.get(e),h=t+":flipY/"+i.toString();if(m[h]!==void 0)return m[h];c.images||(c.images=[]);const w={mimeType:t},x=rn();x.width=Math.min(e.width,d.maxTextureSize),x.height=Math.min(e.height,d.maxTextureSize);const f=x.getContext("2d",{willReadFrequently:!0});if(i===!0&&(f.translate(0,x.height),f.scale(1,-1)),e.data!==void 0){n!==Tn&&console.error("GLTFExporter: Only RGBAFormat is supported.",n),(e.width>d.maxTextureSize||e.height>d.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const L=new Uint8ClampedArray(e.height*e.width*4);for(let C=0;C<L.length;C+=4)L[C+0]=e.data[C+0],L[C+1]=e.data[C+1],L[C+2]=e.data[C+2],L[C+3]=e.data[C+3];f.putImageData(new ImageData(L,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)f.drawImage(e,0,0,x.width,x.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");d.binary===!0?p.push(cn(x,t).then(L=>l.processBufferViewImage(L)).then(L=>{w.bufferView=L})):x.toDataURL!==void 0?w.uri=x.toDataURL(t):p.push(cn(x,t).then(L=>new FileReader().readAsDataURL(L)).then(L=>{w.uri=L}));const S=c.images.push(w)-1;return m[h]=S,S}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const n=this.json;n.samplers||(n.samplers=[]);const i={magFilter:we[e.magFilter],minFilter:we[e.minFilter],wrapS:we[e.wrapS],wrapT:we[e.wrapT]};return n.samplers.push(i)-1}processTexture(e){const i=this.options,t=this.cache,l=this.json;if(t.textures.has(e))return t.textures.get(e);l.textures||(l.textures=[]),e instanceof Tt&&(e=kt(e,i.maxTextureSize));let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const c={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(c.name=e.name),this._invokeAll(function(p){p.writeTexture&&p.writeTexture(e,c)});const d=l.textures.push(c)-1;return t.textures.set(e,d),d}processMaterial(e){const n=this.cache,i=this.json;if(n.materials.has(e))return n.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const t={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const l=e.color.toArray().concat([e.opacity]);if(et(l,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=l),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const c=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),d={index:this.processTexture(c),channel:c.channel};this.applyTextureTransform(d,c),t.pbrMetallicRoughness.metallicRoughnessTexture=d}if(e.map){const c={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(c,e.map),t.pbrMetallicRoughness.baseColorTexture=c}if(e.emissive){const c=e.emissive;if(Math.max(c.r,c.g,c.b)>0&&(t.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const p={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(p,e.emissiveMap),t.emissiveTexture=p}}if(e.normalMap){const c={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(c.scale=e.normalScale.x),this.applyTextureTransform(c,e.normalMap),t.normalTexture=c}if(e.aoMap){const c={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(c.strength=e.aoMapIntensity),this.applyTextureTransform(c,e.aoMap),t.occlusionTexture=c}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===lt&&(t.doubleSided=!0),e.name!==""&&(t.name=e.name),this.serializeUserData(e,t),this._invokeAll(function(c){c.writeMaterial&&c.writeMaterial(e,t)});const s=i.materials.push(t)-1;return n.materials.set(e,s),s}processMesh(e){const n=this.cache,i=this.json,t=[e.geometry.uuid];if(Array.isArray(e.material))for(let y=0,E=e.material.length;y<E;y++)t.push(e.material[y].uuid);else t.push(e.material.uuid);const l=t.join(":");if(n.meshes.has(l))return n.meshes.get(l);const s=e.geometry;let c;e.isLineSegments?c=K.LINES:e.isLineLoop?c=K.LINE_LOOP:e.isLine?c=K.LINE_STRIP:e.isPoints?c=K.POINTS:c=e.material.wireframe?K.LINES:K.TRIANGLES;const d={},p={},m=[],h=[],w={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},x=s.getAttribute("normal");x!==void 0&&!this.isNormalizedNormalAttribute(x)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(x)));let f=null;for(let y in s.attributes){if(y.slice(0,5)==="morph")continue;const E=s.attributes[y];if(y=w[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),n.attributes.has(this.getUID(E))){p[y]=n.attributes.get(this.getUID(E));continue}f=null;const M=E.array;y==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new Ue(new Uint16Array(M),E.itemSize,E.normalized));const b=this.processAccessor(f||E,s);b!==null&&(y.startsWith("_")||this.detectMeshQuantization(y,E),p[y]=b,n.attributes.set(this.getUID(E),b))}if(x!==void 0&&s.setAttribute("normal",x),Object.keys(p).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const y=[],E=[],_={};if(e.morphTargetDictionary!==void 0)for(const M in e.morphTargetDictionary)_[e.morphTargetDictionary[M]]=M;for(let M=0;M<e.morphTargetInfluences.length;++M){const b={};let g=!1;for(const I in s.morphAttributes){if(I!=="position"&&I!=="normal"){g||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),g=!0);continue}const P=s.morphAttributes[I][M],R=I.toUpperCase(),G=s.attributes[I];if(n.attributes.has(this.getUID(P,!0))){b[R]=n.attributes.get(this.getUID(P,!0));continue}const F=P.clone();if(!s.morphTargetsRelative)for(let U=0,k=P.count;U<k;U++)for(let j=0;j<P.itemSize;j++)j===0&&F.setX(U,P.getX(U)-G.getX(U)),j===1&&F.setY(U,P.getY(U)-G.getY(U)),j===2&&F.setZ(U,P.getZ(U)-G.getZ(U)),j===3&&F.setW(U,P.getW(U)-G.getW(U));b[R]=this.processAccessor(F,s),n.attributes.set(this.getUID(G,!0),b[R])}h.push(b),y.push(e.morphTargetInfluences[M]),e.morphTargetDictionary!==void 0&&E.push(_[M])}d.weights=y,E.length>0&&(d.extras={},d.extras.targetNames=E)}const S=Array.isArray(e.material);if(S&&s.groups.length===0)return null;let L=!1;if(S&&s.index===null){const y=[];for(let E=0,_=s.attributes.position.count;E<_;E++)y[E]=E;s.setIndex(y),L=!0}const C=S?e.material:[e.material],T=S?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,E=T.length;y<E;y++){const _={mode:c,attributes:p};if(this.serializeUserData(s,_),h.length>0&&(_.targets=h),s.index!==null){let b=this.getUID(s.index);(T[y].start!==void 0||T[y].count!==void 0)&&(b+=":"+T[y].start+":"+T[y].count),n.attributes.has(b)?_.indices=n.attributes.get(b):(_.indices=this.processAccessor(s.index,s,T[y].start,T[y].count),n.attributes.set(b,_.indices)),_.indices===null&&delete _.indices}const M=this.processMaterial(C[T[y].materialIndex]);M!==null&&(_.material=M),m.push(_)}L===!0&&s.setIndex(null),d.primitives=m,i.meshes||(i.meshes=[]),this._invokeAll(function(y){y.writeMesh&&y.writeMesh(e,d)});const A=i.meshes.push(d)-1;return n.meshes.set(l,A),A}detectMeshQuantization(e,n){if(this.extensionsUsed[Rt])return;let i;switch(n.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}n.normalized&&(i+=" normalized");const t=e.split("_",1)[0];on[t]&&on[t].includes(i)&&(this.extensionsUsed[Rt]=!0,this.extensionsRequired[Rt]=!0)}processCamera(e){const n=this.json;n.cameras||(n.cameras=[]);const i=e.isOrthographicCamera,t={type:i?"orthographic":"perspective"};return i?t.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:t.perspective={aspectRatio:e.aspect,yfov:Ut.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(t.name=e.type),n.cameras.push(t)-1}processAnimation(e,n){const i=this.json,t=this.nodeMap;i.animations||(i.animations=[]),e=Bt.Utils.mergeMorphTargetTracks(e.clone(),n);const l=e.tracks,s=[],c=[];for(let d=0;d<l.length;++d){const p=l[d],m=xt.parseTrackName(p.name);let h=xt.findNode(n,m.nodeName);const w=sn[m.propertyName];if(m.objectName==="bones"&&(h.isSkinnedMesh===!0?h=h.skeleton.getBoneByName(m.objectIndex):h=void 0),!h||!w){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',p.name);continue}const x=1;let f=p.values.length/p.times.length;w===sn.morphTargetInfluences&&(f/=h.morphTargetInfluences.length);let S;p.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(S="CUBICSPLINE",f/=3):p.getInterpolation()===so?S="STEP":S="LINEAR",c.push({input:this.processAccessor(new Ue(p.times,x)),output:this.processAccessor(new Ue(p.values,f)),interpolation:S}),s.push({sampler:c.length-1,target:{node:t.get(h),path:w}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:c,channels:s}),i.animations.length-1}processSkin(e){const n=this.json,i=this.nodeMap,t=n.nodes[i.get(e)],l=e.skeleton;if(l===void 0)return null;const s=e.skeleton.bones[0];if(s===void 0)return null;const c=[],d=new Float32Array(l.bones.length*16),p=new St;for(let h=0;h<l.bones.length;++h)c.push(i.get(l.bones[h])),p.copy(l.boneInverses[h]),p.multiply(e.bindMatrix).toArray(d,h*16);return n.skins===void 0&&(n.skins=[]),n.skins.push({inverseBindMatrices:this.processAccessor(new Ue(d,16)),joints:c,skeleton:i.get(s)}),t.skin=n.skins.length-1}processNode(e){const n=this.json,i=this.options,t=this.nodeMap;n.nodes||(n.nodes=[]);const l={};if(i.trs){const c=e.quaternion.toArray(),d=e.position.toArray(),p=e.scale.toArray();et(c,[0,0,0,1])||(l.rotation=c),et(d,[0,0,0])||(l.translation=d),et(p,[1,1,1])||(l.scale=p)}else e.matrixAutoUpdate&&e.updateMatrix(),Md(e.matrix)===!1&&(l.matrix=e.matrix.elements);if(e.name!==""&&(l.name=String(e.name)),this.serializeUserData(e,l),e.isMesh||e.isLine||e.isPoints){const c=this.processMesh(e);c!==null&&(l.mesh=c)}else e.isCamera&&(l.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const c=[];for(let d=0,p=e.children.length;d<p;d++){const m=e.children[d];if(m.visible||i.onlyVisible===!1){const h=this.processNode(m);h!==null&&c.push(h)}}c.length>0&&(l.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,l)});const s=n.nodes.push(l)-1;return t.set(e,s),s}processScene(e){const n=this.json,i=this.options;n.scenes||(n.scenes=[],n.scene=0);const t={};e.name!==""&&(t.name=e.name),n.scenes.push(t);const l=[];for(let s=0,c=e.children.length;s<c;s++){const d=e.children[s];if(d.visible||i.onlyVisible===!1){const p=this.processNode(d);p!==null&&l.push(p)}}l.length>0&&(t.nodes=l),this.serializeUserData(e,t)}processObjects(e){const n=new Ye;n.name="AuxScene";for(let i=0;i<e.length;i++)n.children.push(e[i]);this.processScene(n)}processInput(e){const n=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});const i=[];for(let t=0;t<e.length;t++)e[t]instanceof Ye?this.processScene(e[t]):i.push(e[t]);i.length>0&&this.processObjects(i);for(let t=0;t<this.skins.length;++t)this.processSkin(this.skins[t]);for(let t=0;t<n.animations.length;++t)this.processAnimation(n.animations[t],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}_invokeAll(e){for(let n=0,i=this.plugins.length;n<i;n++)e(this.plugins[n])}}class Cd{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,n){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,t=i.json,l=i.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(1-e.penumbra)*e.angle,s.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),l[this.name]||(t.extensions=t.extensions||{},t.extensions[this.name]={lights:[]},l[this.name]=!0);const c=t.extensions[this.name].lights;c.push(s),n.extensions=n.extensions||{},n.extensions[this.name]={light:c.length-1}}}class Ld{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,n){if(!e.isMeshBasicMaterial)return;const t=this.writer.extensionsUsed;n.extensions=n.extensions||{},n.extensions[this.name]={},t[this.name]=!0,n.pbrMetallicRoughness.metallicFactor=0,n.pbrMetallicRoughness.roughnessFactor=.9}}class Td{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,t=i.extensionsUsed,l={};if(l.clearcoatFactor=e.clearcoat,e.clearcoatMap){const s={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(s,e.clearcoatMap),l.clearcoatTexture=s}if(l.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const s={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(s,e.clearcoatRoughnessMap),l.clearcoatRoughnessTexture=s}if(e.clearcoatNormalMap){const s={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(s.scale=e.clearcoatNormalScale.x),i.applyTextureTransform(s,e.clearcoatNormalMap),l.clearcoatNormalTexture=s}n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Ed{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const t=this.writer.extensionsUsed,l={};l.dispersion=e.dispersion,n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Ad{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,t=i.extensionsUsed,l={};if(l.iridescenceFactor=e.iridescence,e.iridescenceMap){const s={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(s,e.iridescenceMap),l.iridescenceTexture=s}if(l.iridescenceIor=e.iridescenceIOR,l.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],l.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const s={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(s,e.iridescenceThicknessMap),l.iridescenceThicknessTexture=s}n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Id{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,t=i.extensionsUsed,l={};if(l.transmissionFactor=e.transmission,e.transmissionMap){const s={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(s,e.transmissionMap),l.transmissionTexture=s}n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Pd{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,t=i.extensionsUsed,l={};if(l.thicknessFactor=e.thickness,e.thicknessMap){const s={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(s,e.thicknessMap),l.thicknessTexture=s}l.attenuationDistance=e.attenuationDistance,l.attenuationColor=e.attenuationColor.toArray(),n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class kd{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const t=this.writer.extensionsUsed,l={};l.ior=e.ior,n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Rd{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(gd)&&!e.specularIntensityMap&&!e.specularColorMap)return;const i=this.writer,t=i.extensionsUsed,l={};if(e.specularIntensityMap){const s={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(s,e.specularIntensityMap),l.specularTexture=s}if(e.specularColorMap){const s={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(s,e.specularColorMap),l.specularColorTexture=s}l.specularFactor=e.specularIntensity,l.specularColorFactor=e.specularColor.toArray(),n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Vd{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,t=i.extensionsUsed,l={};if(e.sheenRoughnessMap){const s={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(s,e.sheenRoughnessMap),l.sheenRoughnessTexture=s}if(e.sheenColorMap){const s={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(s,e.sheenColorMap),l.sheenColorTexture=s}l.sheenRoughnessFactor=e.sheenRoughness,l.sheenColorFactor=e.sheenColor.toArray(),n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class $d{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,n){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const i=this.writer,t=i.extensionsUsed,l={};if(e.anisotropyMap){const s={index:i.processTexture(e.anisotropyMap)};i.applyTextureTransform(s,e.anisotropyMap),l.anisotropyTexture=s}l.anisotropyStrength=e.anisotropy,l.anisotropyRotation=e.anisotropyRotation,n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Dd{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,n){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const t=this.writer.extensionsUsed,l={};l.emissiveStrength=e.emissiveIntensity,n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Fd{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,n){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const i=this.writer,t=i.extensionsUsed,l={};if(e.bumpMap){const s={index:i.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};i.applyTextureTransform(s,e.bumpMap),l.bumpTexture=s}l.bumpFactor=e.bumpScale,n.extensions=n.extensions||{},n.extensions[this.name]=l,t[this.name]=!0}}class Ud{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,n){if(!e.isInstancedMesh)return;const i=this.writer,t=e,l=new Float32Array(t.count*3),s=new Float32Array(t.count*4),c=new Float32Array(t.count*3),d=new St,p=new q,m=new Me,h=new q;for(let x=0;x<t.count;x++)t.getMatrixAt(x,d),d.decompose(p,m,h),p.toArray(l,x*3),m.toArray(s,x*4),h.toArray(c,x*3);const w={TRANSLATION:i.processAccessor(new Ue(l,3)),ROTATION:i.processAccessor(new Ue(s,4)),SCALE:i.processAccessor(new Ue(c,3))};t.instanceColor&&(w._COLOR_0=i.processAccessor(t.instanceColor)),n.extensions=n.extensions||{},n.extensions[this.name]={attributes:w},i.extensionsUsed[this.name]=!0,i.extensionsRequired[this.name]=!0}}Bt.Utils={insertKeyframe:function(o,e){const i=o.getValueSize(),t=new o.TimeBufferType(o.times.length+1),l=new o.ValueBufferType(o.values.length+i),s=o.createInterpolant(new o.ValueBufferType(i));let c;if(o.times.length===0){t[0]=e;for(let d=0;d<i;d++)l[d]=0;c=0}else if(e<o.times[0]){if(Math.abs(o.times[0]-e)<.001)return 0;t[0]=e,t.set(o.times,1),l.set(s.evaluate(e),0),l.set(o.values,i),c=0}else if(e>o.times[o.times.length-1]){if(Math.abs(o.times[o.times.length-1]-e)<.001)return o.times.length-1;t[t.length-1]=e,t.set(o.times,0),l.set(o.values,0),l.set(s.evaluate(e),o.values.length),c=t.length-1}else for(let d=0;d<o.times.length;d++){if(Math.abs(o.times[d]-e)<.001)return d;if(o.times[d]<e&&o.times[d+1]>e){t.set(o.times.slice(0,d+1),0),t[d+1]=e,t.set(o.times.slice(d+1),d+2),l.set(o.values.slice(0,(d+1)*i),0),l.set(s.evaluate(e),(d+1)*i),l.set(o.values.slice((d+1)*i),(d+2)*i),c=d+1;break}}return o.times=t,o.values=l,c},mergeMorphTargetTracks:function(o,e){const n=[],i={},t=o.tracks;for(let l=0;l<t.length;++l){let s=t[l];const c=xt.parseTrackName(s.name),d=xt.findNode(e,c.nodeName);if(c.propertyName!=="morphTargetInfluences"||c.propertyIndex===void 0){n.push(s);continue}if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),s=s.clone(),s.setInterpolation(io)}const p=d.morphTargetInfluences.length,m=d.morphTargetDictionary[c.propertyIndex];if(m===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+c.propertyIndex);let h;if(i[d.uuid]===void 0){h=s.clone();const x=new h.ValueBufferType(p*h.times.length);for(let f=0;f<h.times.length;f++)x[f*p+m]=h.values[f];h.name=(c.nodeName||"")+".morphTargetInfluences",h.values=x,i[d.uuid]=h,n.push(h);continue}const w=s.createInterpolant(new s.ValueBufferType(1));h=i[d.uuid];for(let x=0;x<h.times.length;x++)h.values[x*p+m]=w.evaluate(h.times[x]);for(let x=0;x<s.times.length;x++){const f=this.insertKeyframe(h,s.times[x]);h.values[f*p+m]=s.values[x]}}return o.tracks=n,o}};class $n extends mo{constructor(e){super(e),this.type=dt}parse(e){const s=function(b,g){switch(b){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(g||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(g||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(g||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(g||""))}},m=`
`,h=function(b,g,I){g=g||1024;let R=b.pos,G=-1,F=0,U="",k=String.fromCharCode.apply(null,new Uint16Array(b.subarray(R,R+128)));for(;0>(G=k.indexOf(m))&&F<g&&R<b.byteLength;)U+=k,F+=k.length,R+=128,k+=String.fromCharCode.apply(null,new Uint16Array(b.subarray(R,R+128)));return-1<G?(b.pos+=F+G+1,U+k.slice(0,G)):!1},w=function(b){const g=/^#\?(\S+)/,I=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,P=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,R=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,F={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let U,k;for((b.pos>=b.byteLength||!(U=h(b)))&&s(1,"no header found"),(k=U.match(g))||s(3,"bad initial token"),F.valid|=1,F.programtype=k[1],F.string+=U+`
`;U=h(b),U!==!1;){if(F.string+=U+`
`,U.charAt(0)==="#"){F.comments+=U+`
`;continue}if((k=U.match(I))&&(F.gamma=parseFloat(k[1])),(k=U.match(P))&&(F.exposure=parseFloat(k[1])),(k=U.match(R))&&(F.valid|=2,F.format=k[1]),(k=U.match(G))&&(F.valid|=4,F.height=parseInt(k[1],10),F.width=parseInt(k[2],10)),F.valid&2&&F.valid&4)break}return F.valid&2||s(3,"missing format specifier"),F.valid&4||s(3,"missing image size specifier"),F},x=function(b,g,I){const P=g;if(P<8||P>32767||b[0]!==2||b[1]!==2||b[2]&128)return new Uint8Array(b);P!==(b[2]<<8|b[3])&&s(3,"wrong scanline width");const R=new Uint8Array(4*g*I);R.length||s(4,"unable to allocate buffer space");let G=0,F=0;const U=4*P,k=new Uint8Array(4),j=new Uint8Array(U);let se=I;for(;se>0&&F<b.byteLength;){F+4>b.byteLength&&s(1),k[0]=b[F++],k[1]=b[F++],k[2]=b[F++],k[3]=b[F++],(k[0]!=2||k[1]!=2||(k[2]<<8|k[3])!=P)&&s(3,"bad rgbe scanline format");let X=0,J;for(;X<U&&F<b.byteLength;){J=b[F++];const B=J>128;if(B&&(J-=128),(J===0||X+J>U)&&s(3,"bad scanline data"),B){const $=b[F++];for(let z=0;z<J;z++)j[X++]=$}else j.set(b.subarray(F,F+J),X),X+=J,F+=J}const D=P;for(let B=0;B<D;B++){let $=0;R[G]=j[B+$],$+=P,R[G+1]=j[B+$],$+=P,R[G+2]=j[B+$],$+=P,R[G+3]=j[B+$],G+=4}se--}return R},f=function(b,g,I,P){const R=b[g+3],G=Math.pow(2,R-128)/255;I[P+0]=b[g+0]*G,I[P+1]=b[g+1]*G,I[P+2]=b[g+2]*G,I[P+3]=1},S=function(b,g,I,P){const R=b[g+3],G=Math.pow(2,R-128)/255;I[P+0]=ut.toHalfFloat(Math.min(b[g+0]*G,65504)),I[P+1]=ut.toHalfFloat(Math.min(b[g+1]*G,65504)),I[P+2]=ut.toHalfFloat(Math.min(b[g+2]*G,65504)),I[P+3]=ut.toHalfFloat(1)},L=new Uint8Array(e);L.pos=0;const C=w(L),T=C.width,A=C.height,y=x(L.subarray(L.pos),T,A);let E,_,M;switch(this.type){case Et:M=y.length/4;const b=new Float32Array(M*4);for(let I=0;I<M;I++)f(y,I*4,b,I*4);E=b,_=Et;break;case dt:M=y.length/4;const g=new Uint16Array(M*4);for(let I=0;I<M;I++)S(y,I*4,g,I*4);E=g,_=dt;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:T,height:A,data:E,header:C.string,gamma:C.gamma,exposure:C.exposure,type:_}}setDataType(e){return this.type=e,this}load(e,n,i,t){function l(s,c){switch(s.type){case Et:case dt:s.colorSpace=fo,s.minFilter=Se,s.magFilter=Se,s.generateMipmaps=!1,s.flipY=!0;break}n&&n(s,c)}return super.load(e,l,i,t)}}function Od(o){this.scene.background=new de(o),document.getElementById("video").pause()}function zd(o){document.getElementById("video").pause();const n=new Ae().load(o);this.scene.background=n,this.scene.backgroundIntensity=1,n.dispose()}function Hd(o){return new Promise(e=>{document.getElementById("video").pause();const{blurriness:i,intensity:t,viewImg:l}=o,s=new Ae().load(l);s.mapping=Ht,this.scene.background=s,this.scene.environment=s,this.scene.backgroundIntensity=t,this.scene.backgroundBlurriness=i,s.dispose(),e()})}function Nd(o){const{blurriness:e,intensity:n}=o;this.scene.backgroundIntensity=n,this.scene.backgroundBlurriness=e}function Gd(o,e){return new Promise(async n=>{document.getElementById("video").pause();let t,l;e=="hdr"?t=new $n:t=new Ae,l=await t.loadAsync(o),l.mapping=Ht,this.scene.background=l,l.dispose(),n()})}function Bd(o){return new Promise(async e=>{const n=new FileReader,i=document.getElementById("video"),{clientHeight:t,clientWidth:l}=this.container;n.onload=c=>{i.src=c.target.result,i.width=l,i.height=t,i.play()},n.readAsDataURL(o.raw);const s=new go(i);this.scene.background=s,this.scene.minFilter=Se,this.scene.magFilter=Se,this.scene.format=_o,s.dispose(),e()})}const jd={onSetSceneColor:Od,onSetSceneImage:zd,onSetSceneViewImage:Hd,onSetSceneViewConfig:Nd,onSetStorageViewImage:Gd,onSetStorageViewVideo:Bd},Ie=xe();function Yd(){this.modelMaterialList=[];let o=0;this.model.traverse(e=>{e.isMesh&&e.material&&(e.castShadow=!0,e.frustumCulled=!1,Array.isArray(e.material)?(e.material=e.material[0],this.setMaterialMeshParams(e,o)):this.setMaterialMeshParams(e,o))})}function Xd(o,e){const n=o.clone();Object.assign(o.userData,{rotation:n.rotation,scale:n.scale,position:n.position});const i=o.material.clone();o.mapId=o.name+"_"+e,o.material=i;const{mapId:t,uuid:l,userData:s,type:c,name:d,isMesh:p,visible:m}=o,{color:h,wireframe:w,depthWrite:x,opacity:f}=o.material,L={mapId:t,uuid:l,userData:s,type:c,name:d,isMesh:p,visible:m,material:{color:h,wireframe:w,depthWrite:x,opacity:f}};this.modelMaterialList.push(L);const C=o.material.clone();C.userData.mapId=o.name+"_"+e,this.originalMaterials.set(o.uuid,C)}function Wd(){this.model.updateMatrixWorld();const o=new Mt().setFromObject(this.model),e=o.getSize(new q),n=o.getCenter(new q),i=Math.max(e.x,e.y,e.z),l=2.5/(i>1?i:.5);this.model.scale.set(l,l,l),this.model.position.sub(n.multiplyScalar(l)),this.controls.maxDistance=e.length()*10,this.camera.position.set(0,2,6),this.camera.updateProjectionMatrix()}function Zd(o){let e={};return o.forEach(n=>{if(n.map&&n.map.image){const i=document.createElement("canvas");i.width=75,i.height=75,i.getContext("2d").drawImage(n.map.image,0,0),e={url:i.toDataURL("image/png",.5)},i.remove()}}),e}function Qd(o){const{color:e,wireframe:n,depthWrite:i,opacity:t}=JSON.parse(JSON.stringify(o)),l=Ie.selectMesh.uuid,s=this.scene.getObjectByProperty("uuid",l);if(s&&s.material){const{name:d,map:p}=s.material;Object.assign(s.material,{map:p,name:d,transparent:!0,color:new de(e),wireframe:n,depthWrite:i,opacity:t})}const c=this.modelMaterialList.find(d=>d.uuid==l)||{};Object.assign(c.material,{color:new de(e),wireframe:n,depthWrite:i,opacity:t})}function qd(o){const e=this.scene.getObjectByProperty("uuid",o.uuid);e.visible=o.visible}function Kd({mapId:o,meshName:e}){const n=Ie.selectMesh.uuid,i=this.scene.getObjectByProperty("uuid",n),t=this.originalMaterials.get(n);i.material=t.clone(),i.mapId=o,i.meshFrom=e}function Jd({id:o,url:e}){return new Promise(n=>{const i=Ie.selectMesh.uuid,t=this.scene.getObjectByProperty("uuid",i),l=new Ae().load(e),s=t.material.clone();s.map=l,s.map.wrapS=it,s.map.wrapT=it,s.map.flipY=!1,s.map.colorSpace=at,s.map.minFilter=Se,s.map.magFilter=Se,t.material=s,t.mapId=o,t.meshFrom=o,l.dispose(),n()})}function eu(o,e){return new Promise(async n=>{const i=Ie.selectMesh.uuid,t=this.scene.getObjectByProperty("uuid",i);let l,s;e=="hdr"?l=new $n:l=new Ae,s=await l.loadAsync(o);const c=t.material.clone();c.map=s,c.map.wrapS=it,c.map.wrapT=it,c.map.flipY=!1,c.map.colorSpace=at,c.map.minFilter=Se,c.map.magFilter=Se,t.material=c,s.dispose(),n()})}function tu(o){const e=this.model.getObjectByName(o);return this.outlinePass.selectedObjects=[e],Ie.selectMeshAction(e),e}function nu(o){const{clientHeight:e,clientWidth:n,offsetLeft:i,offsetTop:t}=this.container;this.mouse.x=(o.clientX-i)/n*2-1,this.mouse.y=-((o.clientY-t)/e)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);let l;if(this.model&&(l=this.model),this.geometryGroup.children.length&&(l=this.geometryGroup),!l)return!1;const c=this.raycaster.intersectObjects(l.children,!0).filter(d=>d.object.isMesh&&d.object.material);if(c.length>0){const d=c[0].object;if(this.outlinePass.visibleEdgeColor=new de("#FF8C00"),this.outlinePass.hiddenEdgeColor=new de("#8a90f3"),this.outlinePass.selectedObjects=[d],Ie.selectMeshAction(d),this.transformControls){const p=new Mt().setFromObject(d),{dragPosition:m}=d.userData;if(m)this.transformControls.position.copy(m);else{const h=p.getCenter(new q);d.userData.dragPosition=h,this.transformControls.position.copy(h)}this.transformControls.attach(d)}}else this.transformControls||(this.outlinePass.selectedObjects=[],Ie.selectMeshAction({}))}function ou(){const o=[];return this.model.traverse(e=>{if(e.isMesh&&e.material){const{color:n,opacity:i,depthWrite:t,wireframe:l}=e.material,s={meshName:e.name,meshFrom:e.meshFrom,color:n.getStyle(),opacity:i,depthWrite:t,wireframe:l,visible:e.visible,type:e.material.type};o.push(s)}}),o}function su(o){this.model.traverse(e=>{if(e.isMesh&&e.material){const{name:n,color:i,map:t,wireframe:l,depthWrite:s,opacity:c}=e.material;if(o.type)e.material=new Nt[o.type]({map:t,transparent:!0,color:i,name:n});else{const d=this.originalMaterials.get(e.uuid);e.material=d}s&&(e.material.depthWrite=s),c&&(e.material.opacity=c),l&&(e.material.wireframe=l),e.material.side=lt}})}function iu(o){this.modelMaterialList=[],this.model.traverse(e=>{const{name:n}=e;e.castShadow=!0,e.frustumCulled=!1,e.isMesh&&e.material&&(this.modelMaterialList.push(e),this.originalMaterials.set(e.uuid,e.material),e.mapId=n)})}function au(){this.model.traverse(o=>{if(o.isMesh&&o.material){const e=this.originalMaterials.get(o.uuid);o.material=e.clone(),o.mapId=e.userData.mapId,o.visible=!0,o.meshFrom=null}}),this.modelMaterialList.forEach(o=>{o.visible=!0;const e=this.originalMaterials.get(o.uuid);o.mapId=e.userData.mapId;const{color:n,wireframe:i,depthWrite:t,opacity:l}=e;Object.assign(o.material,{color:n,wireframe:i,depthWrite:t,opacity:l})}),Ie.selectMeshAction({})}const lu={getModelMaterialList:Yd,setModelPositionSize:Wd,getModelMaps:Zd,onSetModelMaterial:Qd,onSetModelMap:Kd,onSetSystemModelMap:Jd,onSetStorageModelMap:eu,onChangeModelMaterial:tu,onMouseClickModel:nu,onGetEditMeshList:ou,onChangeModelMeshType:su,onSetGeometryMeshList:iu,onSetMeshVisible:qd,initModelMaterial:au,setMaterialMeshParams:Xd};var st={Linear:{None:function(o){return o}},Quadratic:{In:function(o){return o*o},Out:function(o){return o*(2-o)},InOut:function(o){return(o*=2)<1?.5*o*o:-.5*(--o*(o-2)-1)}},Cubic:{In:function(o){return o*o*o},Out:function(o){return--o*o*o+1},InOut:function(o){return(o*=2)<1?.5*o*o*o:.5*((o-=2)*o*o+2)}},Quartic:{In:function(o){return o*o*o*o},Out:function(o){return 1- --o*o*o*o},InOut:function(o){return(o*=2)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2)}},Quintic:{In:function(o){return o*o*o*o*o},Out:function(o){return--o*o*o*o*o+1},InOut:function(o){return(o*=2)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2)}},Sinusoidal:{In:function(o){return 1-Math.cos(o*Math.PI/2)},Out:function(o){return Math.sin(o*Math.PI/2)},InOut:function(o){return .5*(1-Math.cos(Math.PI*o))}},Exponential:{In:function(o){return o===0?0:Math.pow(1024,o-1)},Out:function(o){return o===1?1:1-Math.pow(2,-10*o)},InOut:function(o){return o===0?0:o===1?1:(o*=2)<1?.5*Math.pow(1024,o-1):.5*(-Math.pow(2,-10*(o-1))+2)}},Circular:{In:function(o){return 1-Math.sqrt(1-o*o)},Out:function(o){return Math.sqrt(1- --o*o)},InOut:function(o){return(o*=2)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1)}},Elastic:{In:function(o){return o===0?0:o===1?1:-Math.pow(2,10*(o-1))*Math.sin((o-1.1)*5*Math.PI)},Out:function(o){return o===0?0:o===1?1:Math.pow(2,-10*o)*Math.sin((o-.1)*5*Math.PI)+1},InOut:function(o){return o===0?0:o===1?1:(o*=2,o<1?-.5*Math.pow(2,10*(o-1))*Math.sin((o-1.1)*5*Math.PI):.5*Math.pow(2,-10*(o-1))*Math.sin((o-1.1)*5*Math.PI)+1)}},Back:{In:function(o){var e=1.70158;return o*o*((e+1)*o-e)},Out:function(o){var e=1.70158;return--o*o*((e+1)*o+e)+1},InOut:function(o){var e=2.5949095;return(o*=2)<1?.5*(o*o*((e+1)*o-e)):.5*((o-=2)*o*((e+1)*o+e)+2)}},Bounce:{In:function(o){return 1-st.Bounce.Out(1-o)},Out:function(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},InOut:function(o){return o<.5?st.Bounce.In(o*2)*.5:st.Bounce.Out(o*2-1)*.5+.5}}},tt;typeof self>"u"&&typeof process<"u"&&process.hrtime?tt=function(){var o=process.hrtime();return o[0]*1e3+o[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?tt=self.performance.now.bind(self.performance):Date.now!==void 0?tt=Date.now:tt=function(){return new Date().getTime()};var Fe=tt,Dn=function(){function o(){this._tweens={},this._tweensAddedDuringUpdate={}}return o.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(n){return e._tweens[n]})},o.prototype.removeAll=function(){this._tweens={}},o.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},o.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},o.prototype.update=function(e,n){e===void 0&&(e=Fe()),n===void 0&&(n=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var t=0;t<i.length;t++){var l=this._tweens[i[t]],s=!n;l&&l.update(e,s)===!1&&!n&&delete this._tweens[i[t]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},o}(),Be={Linear:function(o,e){var n=o.length-1,i=n*e,t=Math.floor(i),l=Be.Utils.Linear;return e<0?l(o[0],o[1],i):e>1?l(o[n],o[n-1],n-i):l(o[t],o[t+1>n?n:t+1],i-t)},Bezier:function(o,e){for(var n=0,i=o.length-1,t=Math.pow,l=Be.Utils.Bernstein,s=0;s<=i;s++)n+=t(1-e,i-s)*t(e,s)*o[s]*l(i,s);return n},CatmullRom:function(o,e){var n=o.length-1,i=n*e,t=Math.floor(i),l=Be.Utils.CatmullRom;return o[0]===o[n]?(e<0&&(t=Math.floor(i=n*(1+e))),l(o[(t-1+n)%n],o[t],o[(t+1)%n],o[(t+2)%n],i-t)):e<0?o[0]-(l(o[0],o[0],o[1],o[1],-i)-o[0]):e>1?o[n]-(l(o[n],o[n],o[n-1],o[n-1],i-n)-o[n]):l(o[t?t-1:0],o[t],o[n<t+1?n:t+1],o[n<t+2?n:t+2],i-t)},Utils:{Linear:function(o,e,n){return(e-o)*n+o},Bernstein:function(o,e){var n=Be.Utils.Factorial;return n(o)/n(e)/n(o-e)},Factorial:function(){var o=[1];return function(e){var n=1;if(o[e])return o[e];for(var i=e;i>1;i--)n*=i;return o[e]=n,n}}(),CatmullRom:function(o,e,n,i,t){var l=(n-o)*.5,s=(i-e)*.5,c=t*t,d=t*c;return(2*e-2*n+l+s)*d+(-3*e+3*n-2*l-s)*c+l*t+e}}},jt=function(){function o(){}return o.nextId=function(){return o._nextId++},o._nextId=0,o}(),Fn=new Dn,ru=function(){function o(e,n){n===void 0&&(n=Fn),this._object=e,this._group=n,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=st.Linear.None,this._interpolationFunction=Be.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=jt.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return o.prototype.getId=function(){return this._id},o.prototype.isPlaying=function(){return this._isPlaying},o.prototype.isPaused=function(){return this._isPaused},o.prototype.to=function(e,n){return this._valuesEnd=Object.create(e),n!==void 0&&(this._duration=n),this},o.prototype.duration=function(e){return this._duration=e,this},o.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e!==void 0?typeof e=="string"?Fe()+parseFloat(e):e:Fe(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},o.prototype._setupProperties=function(e,n,i,t){for(var l in i){var s=e[l],c=Array.isArray(s),d=c?"array":typeof s,p=!c&&Array.isArray(i[l]);if(!(d==="undefined"||d==="function")){if(p){var m=i[l];if(m.length===0)continue;m=m.map(this._handleRelativeValue.bind(this,s)),i[l]=[s].concat(m)}if((d==="object"||c)&&s&&!p){n[l]=c?[]:{};for(var h in s)n[l][h]=s[h];t[l]=c?[]:{},this._setupProperties(s,n[l],i[l],t[l])}else typeof n[l]>"u"&&(n[l]=s),c||(n[l]*=1),p?t[l]=i[l].slice().reverse():t[l]=n[l]||0}}},o.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},o.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},o.prototype.pause=function(e){return e===void 0&&(e=Fe()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},o.prototype.resume=function(e){return e===void 0&&(e=Fe()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},o.prototype.stopChainedTweens=function(){for(var e=0,n=this._chainedTweens.length;e<n;e++)this._chainedTweens[e].stop();return this},o.prototype.group=function(e){return this._group=e,this},o.prototype.delay=function(e){return this._delayTime=e,this},o.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},o.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},o.prototype.yoyo=function(e){return this._yoyo=e,this},o.prototype.easing=function(e){return this._easingFunction=e,this},o.prototype.interpolation=function(e){return this._interpolationFunction=e,this},o.prototype.chain=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._chainedTweens=e,this},o.prototype.onStart=function(e){return this._onStartCallback=e,this},o.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},o.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},o.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},o.prototype.onStop=function(e){return this._onStopCallback=e,this},o.prototype.update=function(e,n){if(e===void 0&&(e=Fe()),n===void 0&&(n=!0),this._isPaused)return!0;var i,t,l=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>l)return!1;n&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),t=(e-this._startTime)/this._duration,t=this._duration===0||t>1?1:t;var s=this._easingFunction(t);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,s),this._onUpdateCallback&&this._onUpdateCallback(this._object,t),t===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var c=0,d=this._chainedTweens.length;c<d;c++)this._chainedTweens[c].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},o.prototype._updateProperties=function(e,n,i,t){for(var l in i)if(n[l]!==void 0){var s=n[l]||0,c=i[l],d=Array.isArray(e[l]),p=Array.isArray(c),m=!d&&p;m?e[l]=this._interpolationFunction(c,t):typeof c=="object"&&c?this._updateProperties(e[l],s,c,t):(c=this._handleRelativeValue(s,c),typeof c=="number"&&(e[l]=s+(c-s)*t))}},o.prototype._handleRelativeValue=function(e,n){return typeof n!="string"?n:n.charAt(0)==="+"||n.charAt(0)==="-"?e+parseFloat(n):parseFloat(n)},o.prototype._swapEndStartRepeatValues=function(e){var n=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=n},o}(),cu="18.6.4",du=jt.nextId,Ce=Fn,uu=Ce.getAll.bind(Ce),pu=Ce.removeAll.bind(Ce),hu=Ce.add.bind(Ce),mu=Ce.remove.bind(Ce),fu=Ce.update.bind(Ce),Ve={Easing:st,Group:Dn,Interpolation:Be,now:Fe,Sequence:jt,nextId:du,Tween:ru,VERSION:cu,getAll:uu,removeAll:pu,add:hu,remove:mu,update:fu};const $e=new En,ue=new q,Ee=new q,ae=new Me,dn={X:new q(1,0,0),Y:new q(0,1,0),Z:new q(0,0,1)},$t={type:"change"},un={type:"mouseDown",mode:null},pn={type:"mouseUp",mode:null},hn={type:"objectChange"};class gu extends Ot{constructor(e,n){super(),n===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),n=document),this.isTransformControls=!0,this.visible=!1,this.domElement=n,this.domElement.style.touchAction="none";const i=new Mu;this._gizmo=i,this.add(i);const t=new bu;this._plane=t,this.add(t);const l=this;function s(T,A){let y=A;Object.defineProperty(l,T,{get:function(){return y!==void 0?y:A},set:function(E){y!==E&&(y=E,t[T]=E,i[T]=E,l.dispatchEvent({type:T+"-changed",value:E}),l.dispatchEvent($t))}}),l[T]=A,t[T]=A,i[T]=A}s("camera",e),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const c=new q,d=new q,p=new Me,m=new Me,h=new q,w=new Me,x=new q,f=new q,S=new q,L=0,C=new q;s("worldPosition",c),s("worldPositionStart",d),s("worldQuaternion",p),s("worldQuaternionStart",m),s("cameraPosition",h),s("cameraQuaternion",w),s("pointStart",x),s("pointEnd",f),s("rotationAxis",S),s("rotationAngle",L),s("eye",C),this._offset=new q,this._startNorm=new q,this._endNorm=new q,this._cameraScale=new q,this._parentPosition=new q,this._parentQuaternion=new Me,this._parentQuaternionInv=new Me,this._parentScale=new q,this._worldScaleStart=new q,this._worldQuaternionInv=new Me,this._worldScale=new q,this._positionStart=new q,this._quaternionStart=new Me,this._scaleStart=new q,this._getPointer=_u.bind(this),this._onPointerDown=vu.bind(this),this._onPointerHover=yu.bind(this),this._onPointerMove=wu.bind(this),this._onPointerUp=xu.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&$e.setFromCamera(e,this.camera);const n=Dt(this._gizmo.picker[this.mode],$e);n?this.axis=n.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&$e.setFromCamera(e,this.camera);const n=Dt(this._plane,$e,!0);n&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(n.point).sub(this.worldPositionStart)),this.dragging=!0,un.mode=this.mode,this.dispatchEvent(un)}}pointerMove(e){const n=this.axis,i=this.mode,t=this.object;let l=this.space;if(i==="scale"?l="local":(n==="E"||n==="XYZE"||n==="XYZ")&&(l="world"),t===void 0||n===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&$e.setFromCamera(e,this.camera);const s=Dt(this._plane,$e,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&n!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),n.indexOf("X")===-1&&(this._offset.x=0),n.indexOf("Y")===-1&&(this._offset.y=0),n.indexOf("Z")===-1&&(this._offset.z=0),l==="local"&&n!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),t.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(l==="local"&&(t.position.applyQuaternion(ae.copy(this._quaternionStart).invert()),n.search("X")!==-1&&(t.position.x=Math.round(t.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(t.position.y=Math.round(t.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(t.position.z=Math.round(t.position.z/this.translationSnap)*this.translationSnap),t.position.applyQuaternion(this._quaternionStart)),l==="world"&&(t.parent&&t.position.add(ue.setFromMatrixPosition(t.parent.matrixWorld)),n.search("X")!==-1&&(t.position.x=Math.round(t.position.x/this.translationSnap)*this.translationSnap),n.search("Y")!==-1&&(t.position.y=Math.round(t.position.y/this.translationSnap)*this.translationSnap),n.search("Z")!==-1&&(t.position.z=Math.round(t.position.z/this.translationSnap)*this.translationSnap),t.parent&&t.position.sub(ue.setFromMatrixPosition(t.parent.matrixWorld))));else if(i==="scale"){if(n.search("XYZ")!==-1){let c=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(c*=-1),Ee.set(c,c,c)}else ue.copy(this.pointStart),Ee.copy(this.pointEnd),ue.applyQuaternion(this._worldQuaternionInv),Ee.applyQuaternion(this._worldQuaternionInv),Ee.divide(ue),n.search("X")===-1&&(Ee.x=1),n.search("Y")===-1&&(Ee.y=1),n.search("Z")===-1&&(Ee.z=1);t.scale.copy(this._scaleStart).multiply(Ee),this.scaleSnap&&(n.search("X")!==-1&&(t.scale.x=Math.round(t.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Y")!==-1&&(t.scale.y=Math.round(t.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),n.search("Z")!==-1&&(t.scale.z=Math.round(t.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const c=20/this.worldPosition.distanceTo(ue.setFromMatrixPosition(this.camera.matrixWorld));let d=!1;n==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ue.copy(this.rotationAxis).cross(this.eye))*c):(n==="X"||n==="Y"||n==="Z")&&(this.rotationAxis.copy(dn[n]),ue.copy(dn[n]),l==="local"&&ue.applyQuaternion(this.worldQuaternion),ue.cross(this.eye),ue.length()===0?d=!0:this.rotationAngle=this._offset.dot(ue.normalize())*c),(n==="E"||d)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&n!=="E"&&n!=="XYZE"?(t.quaternion.copy(this._quaternionStart),t.quaternion.multiply(ae.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),t.quaternion.copy(ae.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),t.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($t),this.dispatchEvent(hn)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(pn.mode=this.mode,this.dispatchEvent(pn)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($t),this.dispatchEvent(hn),this.pointStart.copy(this.pointEnd))}getRaycaster(){return $e}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function _u(o){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:o.button};{const e=this.domElement.getBoundingClientRect();return{x:(o.clientX-e.left)/e.width*2-1,y:-(o.clientY-e.top)/e.height*2+1,button:o.button}}}function yu(o){if(this.enabled)switch(o.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(o));break}}function vu(o){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(o.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(o)),this.pointerDown(this._getPointer(o)))}function wu(o){this.enabled&&this.pointerMove(this._getPointer(o))}function xu(o){this.enabled&&(this.domElement.releasePointerCapture(o.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(o)))}function Dt(o,e,n){const i=e.intersectObject(o,!0);for(let t=0;t<i.length;t++)if(i[t].object.visible||n)return i[t];return!1}const gt=new yo,oe=new q(0,1,0),mn=new q(0,0,0),fn=new St,_t=new Me,wt=new Me,be=new q,gn=new St,nt=new q(1,0,0),De=new q(0,1,0),ot=new q(0,0,1),yt=new q,Ke=new q,Je=new q;class Mu extends Ot{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new An({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=new vo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const t=n.clone();t.opacity=.5;const l=e.clone();l.color.setHex(16711680);const s=e.clone();s.color.setHex(65280);const c=e.clone();c.color.setHex(255);const d=e.clone();d.color.setHex(16711680),d.opacity=.5;const p=e.clone();p.color.setHex(65280),p.opacity=.5;const m=e.clone();m.color.setHex(255),m.opacity=.5;const h=e.clone();h.opacity=.25;const w=e.clone();w.color.setHex(16776960),w.opacity=.25,e.clone().color.setHex(16776960);const f=e.clone();f.color.setHex(7895160);const S=new _e(0,.04,.1,12);S.translate(0,.05,0);const L=new fe(.08,.08,.08);L.translate(0,.04,0);const C=new Wt;C.setAttribute("position",new Zt([0,0,0,1,0,0],3));const T=new _e(.0075,.0075,.5,3);T.translate(0,.25,0);function A(U,k){const j=new Qe(U,.0075,3,64,k*Math.PI*2);return j.rotateY(Math.PI/2),j.rotateX(Math.PI/2),j}function y(){const U=new Wt;return U.setAttribute("position",new Zt([0,0,0,1,1,1],3)),U}const E={X:[[new N(S,l),[.5,0,0],[0,0,-Math.PI/2]],[new N(S,l),[-.5,0,0],[0,0,Math.PI/2]],[new N(T,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new N(S,s),[0,.5,0]],[new N(S,s),[0,-.5,0],[Math.PI,0,0]],[new N(T,s)]],Z:[[new N(S,c),[0,0,.5],[Math.PI/2,0,0]],[new N(S,c),[0,0,-.5],[-Math.PI/2,0,0]],[new N(T,c),null,[Math.PI/2,0,0]]],XYZ:[[new N(new pt(.1,0),h.clone()),[0,0,0]]],XY:[[new N(new fe(.15,.15,.01),m.clone()),[.15,.15,0]]],YZ:[[new N(new fe(.15,.15,.01),d.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new fe(.15,.15,.01),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},_={X:[[new N(new _e(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new N(new _e(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new N(new _e(.2,0,.6,4),i),[0,.3,0]],[new N(new _e(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new N(new _e(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new N(new _e(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new N(new pt(.2,0),i)]],XY:[[new N(new fe(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new N(new fe(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new fe(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new N(new pt(.01,2),t),null,null,null,"helper"]],END:[[new N(new pt(.01,2),t),null,null,null,"helper"]],DELTA:[[new Te(y(),t),null,null,null,"helper"]],X:[[new Te(C,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Te(C,t.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Te(C,t.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},b={XYZE:[[new N(A(.5,1),f),null,[0,Math.PI/2,0]]],X:[[new N(A(.5,.5),l)]],Y:[[new N(A(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new N(A(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new N(A(.75,1),w),null,[0,Math.PI/2,0]]]},g={AXIS:[[new Te(C,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},I={XYZE:[[new N(new wo(.25,10,8),i)]],X:[[new N(new Qe(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new N(new Qe(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new N(new Qe(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new N(new Qe(.75,.1,2,24),i)]]},P={X:[[new N(L,l),[.5,0,0],[0,0,-Math.PI/2]],[new N(T,l),[0,0,0],[0,0,-Math.PI/2]],[new N(L,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new N(L,s),[0,.5,0]],[new N(T,s)],[new N(L,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new N(L,c),[0,0,.5],[Math.PI/2,0,0]],[new N(T,c),[0,0,0],[Math.PI/2,0,0]],[new N(L,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new N(new fe(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new N(new fe(.15,.15,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new fe(.15,.15,.01),p),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new N(new fe(.1,.1,.1),h.clone())]]},R={X:[[new N(new _e(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new N(new _e(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new N(new _e(.2,0,.6,4),i),[0,.3,0]],[new N(new _e(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new N(new _e(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new N(new _e(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new N(new fe(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new N(new fe(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new N(new fe(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new N(new fe(.2,.2,.2),i),[0,0,0]]]},G={X:[[new Te(C,t.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Te(C,t.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Te(C,t.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function F(U){const k=new Ot;for(const j in U)for(let se=U[j].length;se--;){const X=U[j][se][0].clone(),J=U[j][se][1],D=U[j][se][2],B=U[j][se][3],$=U[j][se][4];X.name=j,X.tag=$,J&&X.position.set(J[0],J[1],J[2]),D&&X.rotation.set(D[0],D[1],D[2]),B&&X.scale.set(B[0],B[1],B[2]),X.updateMatrix();const z=X.geometry.clone();z.applyMatrix4(X.matrix),X.geometry=z,X.renderOrder=1/0,X.position.set(0,0,0),X.rotation.set(0,0,0),X.scale.set(1,1,1),k.add(X)}return k}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=F(E)),this.add(this.gizmo.rotate=F(b)),this.add(this.gizmo.scale=F(P)),this.add(this.picker.translate=F(_)),this.add(this.picker.rotate=F(I)),this.add(this.picker.scale=F(R)),this.add(this.helper.translate=F(M)),this.add(this.helper.rotate=F(g)),this.add(this.helper.scale=F(G)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:wt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let t=[];t=t.concat(this.picker[this.mode].children),t=t.concat(this.gizmo[this.mode].children),t=t.concat(this.helper[this.mode].children);for(let l=0;l<t.length;l++){const s=t[l];s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition);let c;if(this.camera.isOrthographicCamera?c=(this.camera.top-this.camera.bottom)/this.camera.zoom:c=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(c*this.size/4),s.tag==="helper"){s.visible=!1,s.name==="AXIS"?(s.visible=!!this.axis,this.axis==="X"&&(ae.setFromEuler(gt.set(0,0,0)),s.quaternion.copy(i).multiply(ae),Math.abs(oe.copy(nt).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(ae.setFromEuler(gt.set(0,0,Math.PI/2)),s.quaternion.copy(i).multiply(ae),Math.abs(oe.copy(De).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(ae.setFromEuler(gt.set(0,Math.PI/2,0)),s.quaternion.copy(i).multiply(ae),Math.abs(oe.copy(ot).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(ae.setFromEuler(gt.set(0,Math.PI/2,0)),oe.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(fn.lookAt(mn,oe,De)),s.quaternion.multiply(ae),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),ue.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ue.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(ue),s.visible=this.dragging):(s.quaternion.copy(i),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1));continue}s.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(oe.copy(nt).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(oe.copy(De).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(oe.copy(ot).applyQuaternion(i).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(oe.copy(ot).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(oe.copy(nt).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(oe.copy(De).applyQuaternion(i).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(_t.copy(i),oe.copy(this.eye).applyQuaternion(ae.copy(i).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(fn.lookAt(this.eye,mn,De)),s.name==="X"&&(ae.setFromAxisAngle(nt,Math.atan2(-oe.y,oe.z)),ae.multiplyQuaternions(_t,ae),s.quaternion.copy(ae)),s.name==="Y"&&(ae.setFromAxisAngle(De,Math.atan2(oe.x,oe.z)),ae.multiplyQuaternions(_t,ae),s.quaternion.copy(ae)),s.name==="Z"&&(ae.setFromAxisAngle(ot,Math.atan2(oe.y,oe.x)),ae.multiplyQuaternions(_t,ae),s.quaternion.copy(ae))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(d){return s.name===d}))&&(s.material.color.setHex(16776960),s.material.opacity=1)}super.updateMatrixWorld(e)}}class bu extends N{constructor(){super(new bt(1e5,1e5,2,2),new An({visible:!1,wireframe:!0,side:lt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let n=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(n="local"),yt.copy(nt).applyQuaternion(n==="local"?this.worldQuaternion:wt),Ke.copy(De).applyQuaternion(n==="local"?this.worldQuaternion:wt),Je.copy(ot).applyQuaternion(n==="local"?this.worldQuaternion:wt),oe.copy(Ke),this.mode){case"translate":case"scale":switch(this.axis){case"X":oe.copy(this.eye).cross(yt),be.copy(yt).cross(oe);break;case"Y":oe.copy(this.eye).cross(Ke),be.copy(Ke).cross(oe);break;case"Z":oe.copy(this.eye).cross(Je),be.copy(Je).cross(oe);break;case"XY":be.copy(Je);break;case"YZ":be.copy(yt);break;case"XZ":oe.copy(Je),be.copy(Ke);break;case"XYZ":case"E":be.set(0,0,0);break}break;case"rotate":default:be.set(0,0,0)}be.length()===0?this.quaternion.copy(this.cameraQuaternion):(gn.lookAt(ue.set(0,0,0),be,oe),this.quaternion.setFromRotationMatrix(gn)),super.updateMatrixWorld(e)}}function Su(o){const{glow:e,threshold:n,strength:i,radius:t,toneMappingExposure:l,color:s}=o;this.glowUnrealBloomPass=e,e?(this.unrealBloomPass.threshold=n,this.unrealBloomPass.strength=i,this.unrealBloomPass.radius=t,this.renderer.toneMappingExposure=l,this.shaderPass.material.uniforms.glowColor.value=new de(s),((this.effectComposer.passes||[]).find(p=>p.name=="ShaderColor")||{}).name||this.effectComposer.addPass(this.shaderPass)):(this.unrealBloomPass.threshold=0,this.unrealBloomPass.strength=0,this.unrealBloomPass.radius=0,this.renderer.toneMappingExposure=l,this.shaderPass.material.uniforms.glowColor.value=new de,this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose(),this.effectComposer.removePass(this.shaderPass))}function Cu({decompose:o}){if(this.glowMaterialList.length<=1)return!1;const e=(t,l)=>{const s=new Ve.Tween(t.position);s.to(l,500),s.onUpdate(function(c){t.position.set(c.x||0,c.y||0,c.z||0)}),s.start()},n=this.glowMaterialList.length,i=2*Math.PI/n;this.glowMaterialList.forEach((t,l)=>{const s=this.model.getObjectByName(t),{decomposeName:c}=this.model;if(s.type=="Mesh")if(At[c]&&At[c][t]){const d={x:0,y:0,z:0},{x:p,y:m,z:h}=At[c][t];p=="straight"?d.x+=o:p=="burden"&&(d.x-=o),m=="straight"?d.y+=o:m=="burden"&&(d.y-=o),h=="straight"?d.z+=o:h=="burden"&&(d.z-=o),e(s,d)}else{const d=l*i,p=o*Math.cos(d),m=o*Math.sin(d);e(s,{x:p,y:m,z:0})}})}function Lu({manageFlage:o}){o?(this.transformControls||(this.transformControls=new gu(this.camera,this.renderer.domElement),this.transformControls.setMode("translate"),this.transformControls.addEventListener("dragging-changed",e=>{this.controls.enabled=!e.value}),this.transformControls.size=1,this.scene.add(this.transformControls)),this.transformControls.attach()):this.transformControls&&(this.transformControls.detach(),this.transformControls.dispose(),this.scene.remove(this.transformControls),this.transformControls=null)}function Tu(o){this.transformControls.setMode(o)}function Eu(){const o=[];return this.modelMaterialList.forEach(e=>{const n=this.model.getObjectByProperty("name",e.name),{rotation:i,scale:t,position:l}=n,s={name:e.name,rotation:{x:i.x,y:i.y,z:i.z},scale:{x:t.x,y:t.y,z:t.z},position:{x:l.x,y:l.y,z:l.z}};o.push(s)}),o}function Au(o){this.shaderPass.material.uniforms.glowColor.value=new de(o)}function Iu(){this.renderer.toneMappingExposure=2,Object.assign(this.unrealBloomPass,{threshold:0,strength:0,radius:0}),this.shaderPass.material.uniforms.glowColor.value=new de,this.glowUnrealBloomPass=!1,this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose(),this.transformControls&&(this.transformControls.detach(),this.transformControls.dispose(),this.scene.remove(this.transformControls),this.transformControls=null),this.effectComposer.removePass(this.shaderPass),this.model.traverse(o=>{if(o.isMesh&&o.material){const{rotation:e,scale:n,position:i}=o.userData;o.rotation.set(e.x,e.y,e.z),o.scale.set(n.x,n.y,n.z),o.position.set(i.x,i.y,i.z)}})}const Pu={onSetUnrealBloomPass:Su,setModelMeshDecompose:Cu,setModelMeshDrag:Lu,getMeshDragPosition:Eu,onSetFlowColor:Au,initStageFlow:Iu,setTransformControlsType:Tu};function ku({ambientLight:o,ambientLightColor:e,ambientLightIntensity:n}){this.ambientLight.visible=o,this.ambientLight.intensity=n,this.ambientLight.color.set(e)}function Ru(o){const{directionaShadow:e,directionalHorizontal:n,directionalVertical:i,directionalSistance:t,directionalLight:l,directionalLightColor:s,directionalLightIntensity:c,directionalLightHelper:d}=o;this.directionalLight.visible=l,this.directionalLightHelper.visible=d&&l,this.directionalLight.intensity=c,this.directionalLight.castShadow=e,this.directionalLight.color.set(s);const{x:p,y:m,z:h}=Gt(n,i,t);this.directionalLight.position.set(p,m,h),this.directionalLightHelper.update()}function Vu(o){const{pointHorizontal:e,pointVertical:n,pointSistance:i,pointLight:t,pointLightColor:l,pointLightIntensity:s,pointLightHelper:c}=o;this.pointLight.visible=t,this.pointLightHelper.visible=t&&c,this.pointLight.intensity=s,this.pointLight.color.set(l);const{x:d,y:p,z:m}=Gt(e,n,i);this.pointLight.position.set(d,p,m),this.pointLightHelper.update()}function $u(o){const{spotDistance:e,spotCastShadow:n,spotLightHelper:i,spotFocus:t,spotPenumbra:l,spotAngle:s,spotLight:c,spotLightColor:d,spotLightIntensity:p,spotHorizontal:m,spotVertical:h,spotSistance:w}=o;this.spotLight.visible=c,this.spotLightHelper.visible=c&&i,this.spotLight.intensity=p,this.spotLight.angle=s,this.spotLight.penumbra=l,this.spotLight.shadow.focus=t,this.spotLight.castShadow=n,this.spotLight.distance=e,this.spotLight.color.set(d);const{x,y:f,z:S}=Gt(m,h,w);this.spotLight.position.set(x,f,S),this.spotLightHelper.update()}function Du({planeGeometry:o,planeColor:e,planeWidth:n,planeHeight:i}){this.planeGeometry.visible=o,this.planeGeometry.geometry=new bt(n,i),this.planeGeometry.material.color.set(e),this.planeGeometry.material.side=lt,this.planeGeometry.geometry.verticesNeedUpdate=!0}function Fu({ambientLight:o}){const e={planeGeometry:!1,planeColor:"#939393",planeWidth:7,planeHeight:7,ambientLight:o,ambientLightColor:"#fff",ambientLightIntensity:.8,directionalLight:!1,directionalLightHelper:!0,directionalLightColor:"#1E90FF",directionalLightIntensity:1,directionalHorizontal:-1.26,directionalVertical:-3.85,directionalSistance:2.98,directionaShadow:!0,pointLight:!1,pointLightHelper:!0,pointLightColor:"#1E90FF",pointLightIntensity:1,pointHorizontal:-4.21,pointVertical:-4.1,pointSistance:2.53,spotLight:!1,spotLightColor:"#323636",spotLightIntensity:400,spotHorizontal:-3.49,spotVertical:-4.37,spotSistance:4.09,spotAngle:.5,spotPenumbra:1,spotFocus:1,spotCastShadow:!0,spotLightHelper:!0,spotDistance:20};this.onSetModelAmbientLight(e),this.onSetModelDirectionalLight(e),this.onSetModelPointLight(e),this.onSetModelSpotLight(e),this.onSetModelPlaneGeometry(e)}const Uu={onSetModelAmbientLight:ku,onSetModelDirectionalLight:Ru,onSetModelPointLight:Vu,onSetModelSpotLight:$u,onSetModelPlaneGeometry:Du,onResettingLight:Fu};function Ou(o){this.onSetModelAnimaion(o),cancelAnimationFrame(this.animationFrame),this.animationFrameFun()}function zu({animationName:o,loop:e,timeScale:n,weight:i}){this.animationMixer=new xo(this.model);const t=Mo.findByName(this.modelAnimation,o);t&&(this.animateClipAction=this.animationMixer.clipAction(t),this.animateClipAction.setEffectiveTimeScale(n),this.animateClipAction.setEffectiveWeight(i),this.animateClipAction.setLoop(this.loopMap[e]),this.animateClipAction.play())}function Hu(){this.animationFrame=requestAnimationFrame(()=>this.animationFrameFun()),this.animationMixer&&this.animationMixer.update(this.animationClock.getDelta())}function Nu(){this.animateClipAction&&(this.animationMixer.stopAllAction(),this.animationMixer.update(0),cancelAnimationFrame(this.animationFrame))}function Gu(o){const{rotationVisible:e,rotationType:n,rotationSpeed:i}=o;e?(cancelAnimationFrame(this.rotationAnimationFrame),this.rotationAnimationFun(n,i)):(cancelAnimationFrame(this.rotationAnimationFrame),this.model.rotation.set(0,0,0))}function Bu(o){const{rotationType:e,rotationSpeed:n}=o;this.model.rotation.set(0,0,0),cancelAnimationFrame(this.rotationAnimationFrame),this.rotationAnimationFun(e,n)}function ju(o,e){this.rotationAnimationFrame=requestAnimationFrame(()=>this.rotationAnimationFun(o,e)),this.model.rotation[o]+=e/50}function Yu(o){this.modelAnimation=o.animations||[]}const Xu={onStartModelAnimaion:Ou,onSetModelAnimaion:zu,animationFrameFun:Hu,onClearAnimation:Nu,onSetRotation:Gu,onSetRotationType:Bu,rotationAnimationFun:ju,getModelAnimaionList:Yu};function Wu(o,e){const n=Math.PI/2,{x:i,y:t,z:l}=this.model.rotation,s={x:i,y:t,z:l};s[o]+=e?n:-n;const c=new Ve.Tween({x:i,y:t,z:l});c.to(s,500),c.onUpdate(d=>{this.model.rotation[o]=d[o]}),c.start()}function Zu(){this.model.rotation.x=0,this.model.rotation.y=0,this.model.rotation.z=0}function Qu({positionX:o,positionY:e,positionZ:n}){const i=new Ve.Tween(this.model.position),t={x:o,y:e,z:n};i.to(t,500),i.onUpdate(l=>{this.model.position.set(l.x||0,l.y||0,l.z||0)}),i.start()}function qu({positionX:o,positionY:e,positionZ:n}){this.model.position.set(o,e,n)}function Ku(){this.camera.position.set(0,2,6),this.camera.lookAt(0,0,0)}function Ju(){return this.camera.position}function ep({x:o,y:e,z:n,gridHelper:i,color:t}){this.gridHelper.visible=i,this.gridHelper.material.color.set(t);const l=new Ve.Tween(this.gridHelper.position),s={x:o,y:e,z:n};l.to(s,500),l.onUpdate(c=>{this.gridHelper.position.set(c.x||0,c.y||0,c.z||0)}),l.start()}function tp({x:o,y:e,z:n,size:i,divisions:t,color:l,gridHelper:s}){this.scene.remove(this.gridHelper),this.gridHelper.geometry.dispose(),this.gridHelper.material.dispose(),this.gridHelper=new vt(i,t,l,l),this.gridHelper.position.set(o,e,n),this.gridHelper.material.linewidth=.1,this.gridHelper.material.color.set(l),this.gridHelper.visible=s,this.scene.add(this.gridHelper)}function np({axesHelper:o,axesSize:e}){this.scene.remove(this.axesHelper),this.axesHelper.geometry.dispose(),this.axesHelper.material.dispose(),this.axesHelper=new In(e),this.axesHelper.position.set(0,-.5,0),this.axesHelper.visible=o,this.scene.add(this.axesHelper)}const op={onSetModelRotateOnAxis:Wu,onResultModelRotateOnAxis:Zu,onSetModelPosition:Qu,onResultModelPosition:qu,onResetModelCamera:Ku,onGetModelCamera:Ju,onSetModelGridHelper:ep,onSetModelGridHelperSize:tp,onSetModelAxesHelper:np},sp=xe();function ip(o){const e=this.scene.getObjectByProperty("uuid",o);this.modelMaterialList=this.modelMaterialList.filter(n=>n.uuid!=o),this.glowMaterialList=this.modelMaterialList.map(n=>n.name),e.clear(),this.geometryGroup.remove(e)}function ap(o,e){const n=sp.selectMesh.uuid,i=this.scene.getObjectByProperty("uuid",n),t=Object.keys(o).map(s=>o[s]),l=new Nt[e](...t);i.geometry=l}const lp={onDeleteGeometryMesh:ip,onSetGeometryMesh:ap};function rp(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!jn(o)}function cp(o){this.dragTag=o,this.dragTag.id=Pn(4,7)}function dp(){const{clientHeight:o,clientWidth:e,offsetLeft:n,offsetTop:i}=this.container,{clientX:t,clientY:l,name:s}=this.dragTag;this.mouse.x=(t-n)/e*2-1,this.mouse.y=-((l-i)/o)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const c=this.raycaster.intersectObjects(this.scene.children,!0);if(c.length>0){let d=document.createElement("div");const p="rgba(0,127,127,"+(Math.random()*.5+.25)+")",m=this.dragTagList.length+1,w=Nn({render(){let E;return a("div",null,[a("div",{className:"element-tag",style:{width:"60px",height:"40px",fontSize:"6px",color:"#ffffffbf",backgroundColor:p}},[a("span",{className:"tag-txt"},[`标签-${m}`])]),a("div",{className:"tag-icon"},[a(Gn,null,rp(E=Bn(wn[s]))?E:{default:()=>[E]})])])}}).mount(document.createElement("div"));d.appendChild(w.$el);let x=new bo(d);const{x:f,y:S,z:L}=c[0].point;x.position.set(f,S,L),x.scale.set(.01,.01,.01);const{uuid:C,position:T,element:{innerText:A}}=x,y={uuid:C,positionX:T.x,positionY:T.y,positionZ:T.z,innerText:A,width:60,height:40,fontSize:6,backgroundColor:p,color:"#ffffffbf",iconColor:"#fff",iconSize:12,iconName:s,hover:!1};this.dragTagList.length==0&&this.container.appendChild(this.css3DRenderer.domElement),this.dragTagList.push(y),this.scene.add(x)}else re.warning("当前角度无法获取鼠标位置请调整“相机角度”在添加")}function up(){if(this.dragTagList.length==0)return!1;this.dragTagList.forEach(o=>{const e=this.scene.getObjectByProperty("uuid",o.uuid);this.scene.remove(e);var n=e.element;n&&n.parentNode&&n.parentNode.removeChild(n)}),this.dragTagList=[],this.container.removeChild(this.css3DRenderer.domElement)}function pp(o){const e=this.scene.getObjectByProperty("uuid",o);this.scene.remove(e);var n=e.element;if(n&&n.parentNode&&n.parentNode.removeChild(n),this.dragTagList=this.dragTagList.filter(i=>i.uuid!=o),this.dragTagList.length==0)return this.container.removeChild(this.css3DRenderer.domElement),!1}function hp(o){const e=this.scene.getObjectByProperty("uuid",o.uuid);if(e){const n=e.element.querySelector(".element-tag"),i=e.element.querySelector(".tag-icon"),t=e.element.querySelector(".tag-txt"),{height:l,backgroundColor:s,width:c,fontSize:d,color:p,innerText:m,iconColor:h,iconSize:w,positionY:x,positionX:f,positionZ:S}=o;n.style.height=l+"px",n.style.backgroundColor=s,n.style.boxShadow=`0px 0px 4px ${s}`,n.style.width=c+"px",n.style.fontSize=d+"px",n.style.color=p,t.innerText=m,i.style.fontSize=w+"px",i.style.color=h;const L=new Ve.Tween(e.position),C={x:f,y:x,z:S};L.to(C,500),L.onUpdate(A=>{e.position.set(A.x||0,A.y||0,A.z||0)}),L.start();const T=this.dragTagList.find(A=>A.uuid==o.uuid);Object.assign(T,o)}}const mp={create3dTags:dp,setDragTag:cp,clearSceneTags:up,deleteTag:pp,updateTagElement:hp};function fp(o){const e=this.scene.getObjectByProperty("uuid",o);if(this.outlinePass.visibleEdgeColor=new de("#409eff"),this.outlinePass.hiddenEdgeColor=new de("#0099cc"),this.outlinePass.selectedObjects=[e],e){const{position:n,rotation:i,userData:t}=e.clone();return e.userData={...t,position:n,rotation:i},{position:{...n},rotation:{...i}}}return{}}function gp(o){const e=this.scene.getObjectByProperty("uuid",o);this.manyModelGroup.remove(e),this.outlinePass.selectedObjects=[]}function _p(o,e,n){const i=this.scene.getObjectByProperty("uuid",n),t=Math.PI/2,{x:l,y:s,z:c}=i.rotation,d={x:l,y:s,z:c};d[o]+=e?t:-t;const p=new Ve.Tween({x:l,y:s,z:c});p.to(d,500),p.onUpdate(m=>{i.rotation[o]=m[o]}),p.start()}function yp(o){const e=this.scene.getObjectByProperty("uuid",o),{userData:{rotation:n}}=e;e.rotation.set(n.x,n.y,n.z)}function vp(o,e){const n=this.scene.getObjectByProperty("uuid",e),i=new Ve.Tween(n.position),t={x:o.x,y:o.y,z:o.z};i.to(t,500),i.onUpdate(l=>{n.position.set(l.x||0,l.y||0,l.z||0)}),i.start()}function wp(o){const e=this.scene.getObjectByProperty("uuid",o),{userData:{position:n}}=e;return e.position.set(n.x||0,n.y||0,n.z||0),{...n}}const xp={chooseManyModel:fp,deleteManyModel:gp,setManyModelRotation:_p,initManyModelRotation:yp,setManyModelPosition:vp,initManyModelPosition:wp},Mp={...jd,...lu,...Pu,...Uu,...Xu,...op,...lp,...mp,...xp};class Un{constructor(e){this.container=document.querySelector(e),this.camera,this.scene=null,this.renderer,this.controls,this.model,this.geometryGroup=new Qt,this.manyModelGroup=new Qt,this.loadingManager=new So,this.fileLoaderMap={glb:new ht,fbx:new Co(this.loadingManager),gltf:new ht,obj:new Lo(this.loadingManager),stl:new To},this.modelAnimation,this.animationMixer,this.animationClock=new Eo,this.animationFrame=null,this.rotationAnimationFrame=null,this.animateClipAction=null,this.loopMap={LoopOnce:Ao,LoopRepeat:Io,LoopPingPong:Po},this.gridHelper,this.axesHelper,this.ambientLight,this.directionalLight,this.directionalLightHelper,this.pointLight,this.pointLightHelper,this.spotLight,this.spotLightHelper,this.planeGeometry,this.modelMaterialList=[],this.originalMaterials=new Map,this.effectComposer,this.outlinePass,this.renderAnimation=null,this.raycaster=new En,this.mouse=new It,this.glowComposer,this.glowRenderPass,this.unrealBloomPass,this.shaderPass,this.glowMaterialList,this.materials={},this.transformControls,this.glowUnrealBloomPass=!1,this.onWindowResizesListener,this.onMouseClickListener,this.modelProgressCallback=n=>n,this.dragGeometryModel={},this.loadingStatus=!0,this.css3DRenderer=null,this.css3dControls=null,this.dragTag={},this.dragTagList=[],this.activeDragManyModel={}}init(){return new Promise(async(e,n)=>{this.initRender(),this.initCamera(),this.initScene(),this.initControls(),this.createHelper(),this.createLight(),this.addEvenListMouseListener();const i=await this.setModel({filePath:"threeFile/glb/glb-9.glb",fileType:"glb",decomposeName:"transformers_3"});this.createEffectComposer(),this.sceneAnimation(),e(i)})}async initScene(){this.scene=new Ye;const e=new Ae().load(je("image/view-4.png"));e.mapping=Ht,this.scene.background=e,this.scene.environment=e,this.scene.backgroundIntensity=1,this.scene.backgroundBlurriness=1,e.dispose()}initCamera(){const{clientHeight:e,clientWidth:n}=this.container;this.camera=new Sn(50,n/e,1,2e3)}initRender(){this.renderer=new Cn({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio);const{clientHeight:e,clientWidth:n}=this.container;this.renderer.setSize(n,e),this.renderer.toneMapping=ko,this.renderer.autoClear=!0,this.renderer.outputColorSpace=at,this.renderer.toneMappingExposure=2,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Ro,this.container.appendChild(this.renderer.domElement),this.css3DRenderer=new Vo,this.css3DRenderer.setSize(n,e),this.css3DRenderer.domElement.style.position="absolute",this.css3DRenderer.domElement.style.pointerEvents="none",this.css3DRenderer.domElement.style.top=0}async openCameraAR(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){let e=document.getElementById("video");const n={video:{width:1280,height:720,facingMode:"user"}};navigator.mediaDevices.getUserMedia(n).then(function(i){e.srcObject=i,e.play()}).catch(function(i){console.error("Unable to access the camera/webcam.",i)})}else alert("MediaDevices interface not available"),console.error("MediaDevices interface not available.")}sceneAnimation(){this.renderAnimation=requestAnimationFrame(()=>this.sceneAnimation()),this.loadingStatus&&(this.glowUnrealBloomPass?this.setMeshFlow():(this.effectComposer.render(),this.controls.update()),Ve.update(),this.dragTagList.length&&(this.css3DRenderer.render(this.scene,this.camera),this.css3dControls.update()))}addEvenListMouseListener(){this.onWindowResizesListener=this.onWindowResizes.bind(this),window.addEventListener("resize",this.onWindowResizesListener),this.onMouseClickListener=this.onMouseClickModel.bind(this),this.container.addEventListener("click",this.onMouseClickListener)}initControls(){this.controls=new qt(this.camera,this.renderer.domElement),this.controls.enablePan=!1,this.controls.enableDamping=!0,this.controls.target.set(0,0,0),this.controls.update(),this.css3dControls=new qt(this.camera,this.css3DRenderer.domElement),this.css3dControls.enablePan=!1,this.css3dControls.enableDamping=!0,this.css3dControls.target.set(0,0,0),this.css3dControls.update()}setModel({filePath:e,fileType:n,decomposeName:i}){return new Promise((t,l)=>{this.loadingStatus=!1;let s;if(["glb","gltf"].includes(n)){const c=new Kt;c.setDecoderPath("draco/gltf/"),c.setDecoderConfig({type:"js"}),c.preload(),s=new ht().setDRACOLoader(c)}else s=this.fileLoaderMap[n];s.load(e,c=>{switch(n){case"glb":this.model=c.scene;break;case"fbx":this.model=c;break;case"gltf":this.model=c.scene;break;case"obj":this.model=c;break;case"stl":const d=new Ne,p=new N(c,d);this.model=p;break}this.model.decomposeName=i,this.getModelMaterialList(),this.setModelPositionSize(),this.glowMaterialList=this.modelMaterialList.map(d=>d.name),this.scene.add(this.model),this.loadingStatus=!0,t(!0),this.getModelAnimaionList(c)},c=>{this.modelProgressCallback(c.loaded)},c=>{re.error("文件错误"),console.log(c),t(!0)})})}setMeshFlow(){this.scene.traverse(e=>{e instanceof vt&&(this.materials.gridHelper=e.material,e.material=new Ne({color:"#000"})),e instanceof Ye&&(this.materials.scene=e.background,this.materials.environment=e.environment,e.background=null,e.environment=null),!this.glowMaterialList.includes(e.name)&&e.isMesh&&(this.materials[e.uuid]=e.material,e.material=new Ne({color:"#000"}))}),this.glowComposer.render(),this.scene.traverse(e=>{this.materials[e.uuid]&&(e.material=this.materials[e.uuid],delete this.materials[e.uuid]),e instanceof vt&&(e.material=this.materials.gridHelper,delete this.materials.gridHelper),e instanceof Ye&&(e.background=this.materials.scene,e.environment=this.materials.environment,delete this.materials.scene,delete this.materials.environment)}),this.effectComposer.render(),this.controls.update()}setGeometryModel(e){return new Promise((n,i)=>{const{clientHeight:t,clientWidth:l,offsetLeft:s,offsetTop:c}=this.container;this.mouse.x=(e.clientX-s)/l*2-1,this.mouse.y=-((e.clientY-c)/t)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const d=this.raycaster.intersectObjects(this.scene.children,!0);if(d.length>0){const{type:p}=e,m=["id","name","modelType","type"],h=Object.keys(e).filter(M=>!m.includes(M)).map(M=>e[M]),w=new Nt[p](...h),f=["#FF4500","#90EE90","#00CED1","#1E90FF","#C71585","#FF4500","#FAD400","#1F93FF","#90F090","#C71585"][Math.ceil(Math.random()*10)],S=new Ne({color:new de(f),side:lt}),L=new N(w,S),{x:C,y:T,z:A}=d[0].point;L.position.set(C,T,A);const y=L.clone();Object.assign(L.userData,{rotation:y.rotation,scale:y.scale,position:y.position}),L.name=p+"_"+Pn(4,5),L.userData.geometry=!0,this.geometryGroup.add(L),this.model=this.geometryGroup,this.onSetGeometryMeshList(L),this.glowMaterialList=this.modelMaterialList.map(M=>M.name),this.setModelMeshDrag({transformType:!0}),this.scene.add(this.model);const _=new Mt().setFromObject(this.model).getSize(new q);this.controls.maxDistance=_.length()*10,this.loadingStatus=!0,n(!0)}else re.warning("当前角度无法获取鼠标位置请调整“相机角度”在添加")})}onProgress(e){typeof e=="function"&&(this.modelProgressCallback=e)}createHelper(){this.gridHelper=new vt(6,18,"#fff","rgb(193,193,193)"),this.gridHelper.position.set(0,-.59,-.1),this.gridHelper.visible=!1,this.scene.add(this.gridHelper),this.axesHelper=new In(2),this.axesHelper.visible=!1,this.scene.add(this.axesHelper),this.renderer.shadowMap.enabled=!0}createLight(){this.ambientLight=new $o("#fff",.8),this.ambientLight.visible=!0,this.scene.add(this.ambientLight),this.directionalLight=new Do("#fff",5),this.directionalLight.position.set(-1.44,2.2,1),this.directionalLight.castShadow=!0,this.directionalLight.visible=!1,this.scene.add(this.directionalLight),this.directionalLightHelper=new Fo(this.directionalLight,.3),this.directionalLightHelper.visible=!1,this.scene.add(this.directionalLightHelper),this.pointLight=new Uo(16711680,5,100),this.pointLight.visible=!1,this.scene.add(this.pointLight),this.pointLightHelper=new Oo(this.pointLight,.5),this.pointLightHelper.visible=!1,this.scene.add(this.pointLightHelper),this.spotLight=new zo("#00BABD",900),this.spotLight.visible=!1,this.spotLight.map=new Ae().load(je("image/model-bg-1.jpg")),this.spotLight.map=new Ae().load(je("image/model-bg-1.jpg")),this.spotLight.decay=2,this.spotLight.shadow.mapSize.width=1920,this.spotLight.shadow.mapSize.height=1080,this.spotLight.shadow.camera.near=1,this.spotLight.shadow.camera.far=10,this.scene.add(this.spotLight),this.spotLightHelper=new Ho(this.spotLight),this.spotLightHelper.visible=!1,this.scene.add(this.spotLightHelper);const e=new bt(4,4);var n=new Ne({color:"#000000"});this.planeGeometry=new N(e,n),this.planeGeometry.rotation.x=-Math.PI/2,this.planeGeometry.position.set(0,-1.2,0),this.planeGeometry.receiveShadow=!0,this.planeGeometry.visible=!1,this.scene.add(this.planeGeometry)}createEffectComposer(){if(!this.container)return!1;const{clientHeight:e,clientWidth:n}=this.container;this.effectComposer=new Jt(this.renderer,new en(n,e));const i=new tn(this.scene,this.camera);this.effectComposer.addPass(i),this.outlinePass=new No(new It(n,e),this.model,this.camera),this.outlinePass.visibleEdgeColor=new de("#FF8C00"),this.outlinePass.hiddenEdgeColor=new de("#8a90f3"),this.outlinePass.edgeGlow=2,this.outlinePass.usePatternTexture=!1,this.outlinePass.edgeThickness=1,this.outlinePass.edgeStrength=4,this.outlinePass.pulsePeriod=200,this.effectComposer.addPass(this.outlinePass);let t=new Go;this.effectComposer.addPass(t);let l=new nn(Bo);const s=this.renderer.getPixelRatio();l.uniforms.resolution.value.set(1/(n*s),1/(e*s)),l.renderToScreen=!0,l.needsSwap=!0,this.effectComposer.addPass(l),this.unrealBloomPass=new jo(new It(n,e),1.5,.4,.85);const c={minFilter:Se,format:Tn,stencilBuffer:!1},d=new en(n*2,e*2,c);this.glowComposer=new Jt(this.renderer,d),this.glowComposer.renderToScreen=!1,this.glowRenderPass=new tn(this.scene,this.camera),this.glowComposer.addPass(this.glowRenderPass),this.glowComposer.addPass(this.unrealBloomPass),this.shaderPass=new nn(new bn({uniforms:{baseTexture:{value:null},bloomTexture:{value:this.glowComposer.renderTarget2.texture},tDiffuse:{value:null},glowColor:{value:null}},vertexShader:Yo,fragmentShader:Xo,defines:{}}),"baseTexture"),this.shaderPass.material.uniforms.glowColor.value=new de,this.shaderPass.renderToScreen=!0,this.shaderPass.needsSwap=!0,this.shaderPass.name="ShaderColor"}onSwitchModel(e){return new Promise(async(n,i)=>{try{if(e.modelType&&e.modelType=="geometry"){this.modelAnimation=[],this.camera.fov=80,this.camera.updateProjectionMatrix();const t=await this.setGeometryModel(e);this.outlinePass.renderScene=this.geometryGroup,n()}else{this.clearSceneModel(),this.camera.fov=50,this.geometryGroup.clear();const t=await this.setModel(e);this.outlinePass.renderScene=this.model,n({load:t,filePath:e.filePath})}}catch{i()}})}onWindowResizes(){if(!this.container)return!1;const{clientHeight:e,clientWidth:n}=this.container;if(this.camera.aspect=n/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(n,e),this.css3DRenderer.setSize(n,e),this.effectComposer){var i=this.effectComposer.passes[3];const t=this.renderer.getPixelRatio();i.uniforms.resolution.value.set(1/(n*t),1/(e*t)),this.effectComposer.setSize(n,e)}this.glowComposer&&this.glowComposer.setSize(n,e)}onDownloadSceneCover(){var e=document.createElement("a"),n=this.renderer.domElement;e.href=n.toDataURL("image/png"),e.download=`${new Date().toLocaleString()}.png`,e.click(),re.success("下载成功")}onExporterModel(e){const n=new Bt,i={trs:!0,animations:this.modelAnimation,binary:e=="glb",embedImages:!0,onlyVisible:!0,includeCustomExtensions:!0};n.parse(this.scene,function(t){t instanceof ArrayBuffer?l(t,`${new Date().toLocaleString()}.glb`):s(JSON.stringify(t),`${new Date().toLocaleString()}.gltf`);function l(c,d){const p=new Blob([c],{type:"application/octet-stream"}),m=URL.createObjectURL(p),h=document.createElement("a");h.href=m,h.download=d,h.click(),URL.revokeObjectURL(m),re.success("导出成功")}function s(c,d){const p=new Blob([c],{type:"application/json"}),m=URL.createObjectURL(p),h=document.createElement("a");h.href=m,h.download=d,h.click(),URL.revokeObjectURL(m),re.success("导出成功")}},t=>{re.error(t)},i)}onClearModelData(){cancelAnimationFrame(this.rotationAnimationFrame),cancelAnimationFrame(this.renderAnimation),cancelAnimationFrame(this.animationFrame),this.container.removeEventListener("click",this.onMouseClickListener),window.removeEventListener("resize",this.onWindowResizesListener),this.scene.traverse(e=>{e.type==="Mesh"&&(e.geometry.dispose(),e.material.dispose())}),this.scene.clear(),this.renderer.dispose(),this.renderer.clear(),this.container=null,this.camera=null,this.scene=null,this.renderer=null,this.controls=null,this.model=null,this.fileLoaderMap=null,this.modelAnimation=null,this.animationMixer=null,this.animationClock=null,this.animationFrame=null,this.rotationAnimationFrame=null,this.animateClipAction=null,this.loopMap=null,this.gridHelper=null,this.axesHelper=null,this.ambientLight=null,this.directionalLight=null,this.directionalLightHelper=null,this.pointLight=null,this.pointLightHelper=null,this.spotLight=null,this.spotLightHelper=null,this.planeGeometry=null,this.modelMaterialList=[],this.originalMaterials.clear(),this.effectComposer=null,this.outlinePass=null,this.renderAnimation=null,this.raycaster=null,this.mouse=null,this.glowComposer&&(this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose()),this.glowComposer=null,this.unrealBloomPass=null,this.shaderPass=null,this.glowMaterialList=null,this.materials=null,this.transformControls=null,this.dragGeometryModel=null,this.glowUnrealBloomPass=!1,this.css3DRenderer=null,this.css3dControls=null,this.dragTag={},this.dragTagList=[],this.activeDragManyModel={}}clearSceneModel(){this.scene.traverse(i=>{["Mesh"].includes(i.type)&&(i.geometry.dispose(),i.material.dispose())}),this.dragGeometryModel={},this.activeDragManyModel={},this.geometryGroup.clear(),this.scene.remove(this.geometryGroup),this.manyModelGroup.clear(),this.scene.remove(this.manyModelGroup),this.scene.children.filter(i=>i.userData.type=="manyModel").forEach(i=>{this.scene.remove(i)}),this.scene.remove(this.model),this.model=null,cancelAnimationFrame(this.animationFrame),cancelAnimationFrame(this.rotationAnimationFrame),this.glowUnrealBloomPass=!1,this.glowMaterialList=[],this.modelMaterialList=[],this.originalMaterials.clear(),this.materials={},this.transformControls&&(this.transformControls.detach(),this.transformControls.dispose(),this.scene.remove(this.transformControls),this.transformControls=null),this.glowComposer&&(this.glowComposer.renderer.clear(),this.glowComposer.renderer.dispose()),this.effectComposer&&this.effectComposer.removePass(this.shaderPass),this.renderer.toneMappingExposure=2,this.outlinePass.selectedObjects=[],Object.assign(this.unrealBloomPass,{threshold:0,strength:0,radius:0}),this.shaderPass.material.uniforms.glowColor.value=new de;const n={gridHelper:!1,x:0,y:-.59,z:-.1,positionX:0,positionY:-1,positionZ:0,divisions:18,size:6,color:"rgb(193,193,193)",axesHelper:!1,axesSize:1.8};this.onResettingLight({ambientLight:!1}),this.onSetModelGridHelper(n),this.onSetModelGridHelperSize(n),this.onSetModelAxesHelper(n),this.clearSceneTags()}setDragGeometryModel(e){this.dragGeometryModel=e}setDragManyModel(e){this.activeDragManyModel=e}onLoadManyModel(e){return new Promise((n,i)=>{const{clientHeight:t,clientWidth:l,offsetLeft:s,offsetTop:c}=this.container,{filePath:d,fileType:p,name:m}=e;this.mouse.x=(e.clientX-s)/l*2-1,this.mouse.y=-((e.clientY-c)/t)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const h=this.raycaster.intersectObjects(this.scene.children,!0);if(h.length>0){this.loadingStatus=!1;let w;if(["glb","gltf"].includes(p)){const f=new Kt;f.setDecoderPath("draco/gltf/"),f.setDecoderConfig({type:"js"}),f.preload(),w=new ht().setDRACOLoader(f)}else w=this.fileLoaderMap[p];let x;w.load(d,f=>{switch(p){case"glb":x=f.scene;break;case"fbx":x=f;break;case"gltf":x=f.scene;break;case"obj":x=f;break;case"stl":const M=new Ne;x=new N(f,M);break}const{x:S,y:L,z:C}=h[0].point;x.position.set(S,L,C);const A=new Mt().setFromObject(x).getSize(new q),y=Math.max(A.x,A.y,A.z),_=1.2/(y>1?y:.5);x.scale.set(_,_,_),x.name=m,x.userData={type:"manyModel",...x.userData},this.manyModelGroup.add(x),this.model=this.manyModelGroup,this.outlinePass.renderScene=this.model,this.getModelMaterialList(),this.glowMaterialList=this.modelMaterialList.map(M=>M.name),this.scene.add(this.model),this.loadingStatus=!0,n({load:!0})},f=>{this.modelProgressCallback(f.loaded)},f=>{re.error(f),i()})}else i(),re.warning("当前角度无法获取鼠标位置请调整“相机角度”在添加")})}chooseManyModel(e){const n=this.scene.children.find(i=>i.uuid==e);this.model=n,this.outlinePass.renderScene=this.model,this.getModelMaterialList()}}Object.assign(Un.prototype,{...Mp});const On=o=>(Pe("data-v-92d2f21e"),o=o(),ke(),o),bp={key:0,id:"loading-mark"},Sp={class:"loading-box"},Cp={class:"loading"},Lp=On(()=>r("img",{src:Yn},null,-1)),Tp={class:"progress-txt"},Ep=On(()=>r("div",{class:"loading-txt"}," 模型文件首次加载时间较长请耐心等待..... ",-1)),Ap={__name:"PageLoading",props:{percentage:{type:Number,default:0},loading:{type:Boolean,default:!1}},setup(o){const e=o;return(n,i)=>e.loading?(O(),Q("div",bp,[r("div",Sp,[r("div",Cp,[Lp,r("div",Tp,[V(" 当前模型已加载 "),r("b",null,ye(e.percentage),1),V(" M ")]),Ep])])])):ve("",!0)}},Ip=Le(Ap,[["__scopeId","data-v-92d2f21e"]]),Lt=o=>(Pe("data-v-09afa67d"),o=o(),ke(),o),Pp={class:"model-page"},kp={class:"model-header"},Rp={class:"header-lf"},Vp=Lt(()=>r("span",null," 基于Three.js+Vue3+Element-Plus开发的3d模型可视化编辑系统 ",-1)),$p=Lt(()=>r("span",null,"作者:answer ",-1)),Dp={class:"header-lr"},Fp={class:"model-container"},Up={class:"camera-icon"},Op=Lt(()=>r("div",{id:"mesh-txt"},null,-1)),zp={class:"edit-panel",style:{minWidth:"380px"}},Hp=Lt(()=>r("video",{id:"video",loop:"loop",playsinline:"",autoplay:"",style:{display:"none"}},null,-1)),Np={__name:"index",setup(o){const e=xe(),n=Wn(),{$bus:i,$local:t}=Re().proxy,l=te(!1),s=te(0),c=te(null),d=te(null),p=te(null),m=te(!1),h=ee(()=>{var _;if(c.value){const M=(_=d.value)==null?void 0:_.activeModel;return!!(M!=null&&M.filePath&&["oneModel","tags"].includes(e.modelType))}return!1}),w=()=>{e.modelApi.onResetModelCamera()},x=()=>{const _=t.get(mt);if(!Array.isArray(_)){let M=[];Ft.forEach(b=>{M.push({...Wo,fileInfo:{...b}})}),t.set(mt,M)}},f=async _=>{const{dragGeometryModel:M,dragTag:b,activeDragManyModel:g}=e.modelApi,{clientX:I,clientY:P}=_;if(M.id&&e.modelType=="geometry"&&(M.clientX=I,M.clientY=P,e.modelApi.onSwitchModel(M),i.emit("update-tab","EditGeometry")),b.id&&e.modelType=="tags"&&(b.clientX=I,b.clientY=P,e.modelApi.create3dTags(b)),e.modelType=="manyModel"){g.clientX=I,g.clientY=P,i.emit("page-loading",!0);try{const{load:R}=await e.modelApi.onLoadManyModel(g);R&&(i.emit("update-model"),i.emit("update-tab","EditMoreModel"),i.emit("page-loading",!1))}catch{i.emit("page-loading",!1)}}},S=()=>{var M;const _=c.value.getPanelConfig();if(_.camera=e.modelApi.onGetModelCamera(),_.fileInfo=(M=d.value)==null?void 0:M.activeModel,_.fileInfo.filePath){t.set(Zo,_);const{href:b}=n.resolve({path:"/preview"});window.open(b,"_blank")}else re.warning("当前模型暂不支持“效果预览”")},L=()=>{var M;const _=c.value.getPanelConfig();_.camera=e.modelApi.onGetModelCamera(),_.fileInfo=(M=d.value)==null?void 0:M.activeModel,p.value.showDialog(_)},C=()=>{const _=document.documentElement;m.value?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():_.requestFullscreen?_.requestFullscreen():_.webkitRequestFullscreen&&_.webkitRequestFullscreen()},T=()=>{Mn.confirm(" 确认要更新当前模型数据至“模板库”?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"success"}).then(()=>{var M;const _=c.value.getPanelConfig();if(_.camera=e.modelApi.onGetModelCamera(),_.fileInfo=(M=d.value)==null?void 0:M.activeModel,_.fileInfo.filePath){const b=t.get(mt)||[],{id:g}=_.fileInfo;Object.assign(b.filter(I=>g===I.fileInfo.id)[0],_),t.set(mt,b),re.success("更新成功")}else re.warning("当前模型暂不支持“数据保存”")}).catch(()=>{})},A=()=>{e.modelApi.onDownloadSceneCover()},y=_=>{e.modelApi.onExporterModel(_)},E=_=>{const M=document.fullscreenElement||document.webkitFullscreenElement;m.value=!!M};return Oe(async()=>{l.value=!0;const _=new Un("#model");e.setModelApi(_),i.on("page-loading",b=>{l.value=b}),e.modelApi.onProgress(b=>{s.value=Number((b/1024/1024).toFixed(2))}),await _.init()&&(l.value=!1,s.value=0),x(),document.addEventListener("fullscreenchange",E)}),Xn(()=>{e.modelApi.onClearModelData(),document.removeEventListener("fullscreenchange",E)}),(_,M)=>{const b=v("el-button"),g=v("el-icon"),I=v("el-dropdown-item"),P=v("el-dropdown-menu"),R=v("el-dropdown"),G=v("el-space"),F=v("Aim"),U=v("el-tooltip");return O(),Q("div",Pp,[r("header",kp,[r("div",Rp,[Vp,$p,r("span",null,"当前Three.js版本:"+ye(Ln),1)]),r("div",Dp,[a(G,null,{default:u(()=>[a(b,{type:"primary",icon:"Film",onClick:M[0]||(M[0]=k=>_.$router.push({path:"/modelBase"}))},{default:u(()=>[V(" 模型库 ")]),_:1}),h.value?(O(),ne(b,{key:0,type:"primary",icon:"Document",onClick:T},{default:u(()=>[V("保存数据")]),_:1})):ve("",!0),h.value?(O(),ne(b,{key:1,type:"primary",icon:"View",onClick:S},{default:u(()=>[V("效果预览")]),_:1})):ve("",!0),a(R,{trigger:"click"},{dropdown:u(()=>[a(P,null,{default:u(()=>[a(I,{onClick:A},{default:u(()=>[V("下载封面")]),_:1}),a(I,{onClick:M[1]||(M[1]=k=>y("glb"))},{default:u(()=>[V("导出模型(.glb)格式")]),_:1}),a(I,{onClick:M[2]||(M[2]=k=>y("gltf"))},{default:u(()=>[V("导出模型(.gltf)格式")]),_:1})]),_:1})]),default:u(()=>[a(b,{type:"primary",icon:"Download"},{default:u(()=>[V(" 下载/导出"),a(g,{class:"el-icon--right"})]),_:1})]),_:1}),h.value?(O(),ne(b,{key:2,type:"primary",icon:"HelpFilled",onClick:L},{default:u(()=>[V(" 嵌入代码 ")]),_:1})):ve("",!0),a(b,{type:"primary",icon:"FullScreen",onClick:C},{default:u(()=>[V(ye(m.value?"取消全屏":"全屏"),1)]),_:1})]),_:1})])]),r("div",Fp,[a(ce(cd),{ref_key:"choosePanel",ref:d},null,512),r("div",{id:"model",onDrop:f,ref:"model",onDragover:M[3]||(M[3]=Xe(()=>{},["prevent"]))},[r("div",Up,[a(U,{effect:"dark",content:"居中",placement:"top"},{default:u(()=>[a(g,{size:18,color:"#fff",onClick:w},{default:u(()=>[a(F)]),_:1})]),_:1})]),Op],544),r("div",zp,[ce(e).modelApi.model?(O(),ne(ce(Fc),{key:0,ref_key:"editPanel",ref:c},null,512)):ve("",!0)])]),Hp,a(Ip,{loading:l.value,percentage:s.value},null,8,["loading","percentage"]),a(ce(fd),{ref_key:"implantDialog",ref:p},null,512)])}}},Yp=Le(Np,[["__scopeId","data-v-09afa67d"]]);export{Yp as default};
